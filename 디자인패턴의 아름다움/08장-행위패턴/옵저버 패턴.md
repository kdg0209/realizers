# ì˜µì €ë²„ íŒ¨í„´

- ì˜µì €ë²„ íŒ¨í„´ì€ ë°œí–‰-êµ¬ë…(publisher-subscribe) íŒ¨í„´ì´ë¼ê³ ë„ í•©ë‹ˆë‹¤.
- ì¼ëŒ€ì¼ ë˜ëŠ” ì¼ëŒ€ë‹¤ ê´€ê³„ì—ì„œ ë°œí–‰ìì˜ ìƒíƒœê°€ ë³€ê²½ë˜ë©´ ë°œí–‰ìë¥¼ ì˜ì¡´í•˜ê³  ìˆëŠ” ëª¨ë“  ê°ì²´ì— ìƒíƒœ ë³€ê²½ ì•Œë¦¼ì„ ë³´ëƒ…ë‹ˆë‹¤.
- ì˜µì €ë²„ íŒ¨í„´ì€ ì´ë²¤íŠ¸ ë“œë¦¬ë¸ ì•„í‚¤í…ì²˜ì—ì„œ ì£¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.

### êµ¬ì¡° 

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-05-07 á„‹á…©á„’á…® 10 14 15](https://github.com/kdg0209/realizers/assets/80187200/ba13a06c-078a-49ed-8de1-5d5e57b8a222)

<br>

### ì˜ˆì œ

```java
public interface Publisher {

    void add(Consumer consumer);
    void delete(Consumer consumer);
    void order(Order order);
}

public class OrderPublisher implements Publisher {

    private List<Consumer> consumers = new ArrayList<>();

    @Override
    public void add(Consumer consumer) {
        this.consumers.add(consumer);
    }

    @Override
    public void delete(Consumer consumer) {
        this.consumers.removeIf(o -> o.equals(consumer));
    }

    @Override
    public void order(Order order) {
        this.consumers.forEach(o -> o.update(order));
    }
}

public class Order {

    private long id;

    public Order(long id) {
        this.id = id;
    }
}

public interface Consumer {

    void update(Order order);
}

public class RestaurantConsumer implements Consumer {

    @Override
    public void update(Order order) {
        System.out.println("ì£¼ë¬¸ì„ ë°›ì•„ ìš”ë¦¬ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.");
    }
}

public class RiderConsumer implements Consumer {

    @Override
    public void update(Order order) {
        System.out.println("ì£¼ë¬¸ê±´ì— ëŒ€í•œ ë¼ì´ë”ê°€ ë°°ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤.");
    }
}

public class Main {

    public static void main(String[] args) {
        Publisher publisher = new OrderPublisher();
        publisher.add(new RestaurantConsumer());
        publisher.add(new RiderConsumer());
        publisher.order(new Order(1L));
    }
}
// ê²°ê³¼
// ì£¼ë¬¸ì„ ë°›ì•„ ìš”ë¦¬ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.
// ì£¼ë¬¸ê±´ì— ëŒ€í•œ ë¼ì´ë”ê°€ ë°°ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤.
```
<br>

#### ğŸ‘ ì¥ì 

- Publisherì™€ ConsumerëŠ” ì§ì ‘ì ì¸ ì˜ì¡´ê´€ê³„ê°€ ì•„ë‹Œ ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ì˜ì¡´í•˜ê³  ìˆìœ¼ë¯€ë¡œ ëŠìŠ¨í•œ ê²°í•©ì„ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ OCP ì›ì¹™, ì¸í„°í˜ì´ìŠ¤ ë¶„ë¦¬ ì›ì¹™, ë‹¨ì¼ ì±…ì„ ì›ì¹™ì„ ì¤€ìˆ˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ë†’ì€ ì‘ì§‘ë„ì™€ ë‚®ì€ ê²°í•©ë„ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### ğŸ¤” ë‹¨ì 

- Publisher-Consumer íŒ¨í„´ì„ ì‚¬ìš©í•˜ë‹¤ ë³´ë©´ ì˜ˆì™¸ì²˜ë¦¬ ë° ë¡¤ë°±ì— ëŒ€í•œ ê¹Šì€ ê³ ë¯¼ì„ í•´ì•¼í•©ë‹ˆë‹¤.

---

### ì±…ì˜ ì˜ˆì œ

- ì•„ë˜ ì˜ˆì œë¥¼ ë³´ë©´ ì‹ ê·œ ì‚¬ìš©ìë¥¼ ë“±ë¡í•  ë•Œ ì‹ ê·œ ì‚¬ìš©ìì— ëŒ€í•œ í”„ë¡œëª¨ì…˜ ìºì‹œë¥¼ ì§€ê¸‰í•˜ê³  ìˆìŠµë‹ˆë‹¤.
- ë§Œì•½ ì¶”í›„ì— í”„ë¡œëª¨ì…˜ ìºì‹œ ì§€ê¸‰ ë¿ë§Œ ì•„ë‹ˆë¼ ì¿ í°ì„ ì§€ê¸‰í•˜ê±°ë‚˜ ê¸°íƒ€ ë‹¤ë¥¸ ìƒí’ˆì„ ì§€ê¸‰í•  ìˆ˜ë„ ìˆì„ ê²½ìš° register ë©”ì„œë“œëŠ” ë‹¤ì–‘í•œ ìš”êµ¬ ì‚¬í•­ë“¤ë¡œ ì¸í•´ OCP ì›ì¹™ì„ ìœ„ë°˜í•˜ê²Œ ë©ë‹ˆë‹¤.
- ê°œì¸ì ì¸ ìƒê°
  - ê¸°ë³¸ì ì¸ MVC ì•„í‚¤í…ì²˜ë¼ë©´ Service ë ˆì´ì–´ì—ì„œ Infrastructure ë ˆì´ì–´ë¥¼ ì°¸ì¡°í•  ë•Œ RegObserver ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ëŠìŠ¨í•œ ê²°í•©ì„ í†µí•´ DIP ì›ì¹™, OCP ì›ì¹™, ì¸í„°í˜ì´ìŠ¤ë¶„ë¦¬ ì›ì¹™, ë‹¨ì¼ ì±…ì„ ì›ì¹™ì„ ì§€í‚¬ ìˆ˜ ìˆìœ¼ë¦¬ë¼ ìƒê°í•©ë‹ˆë‹¤.

```java
public class UserController {
    
    // ì˜ì¡´ì„± ì£¼ì…
    private final UserService userService;
    private final PromotionService promotionService;
    
    public Long register(String phone, String password) {
        long userId = userService.register(phone, password); // ì‹ ê·œ ì‚¬ìš©ì ë“±ë¡
        promotionService.issueNewUserExperienceCash(userId); // ì‹ ê·œ ì‚¬ìš©ìì— ëŒ€í•œ í”„ë¡œëª¨ì…˜ ìºì‹œ ì§€ê¸‰
        
        return userId;
    }
}

// ì˜µì €ë²„ íŒ¨í„´ìœ¼ë¡œ í•´ë‹¹ ë¬¸ì œë¥¼ í•´ê²°
@FunctionalInterface
public interface RegObserver {
    
    void handleRegSuccess(long userId);
}

public class RegNotificationObserver implements RegObserver {

    @Override
    public void handleRegSuccess(long userId) {

    }
}

public class RegPromotionObserver implements RegObserver {

    @Override
    public void handleRegSuccess(long userId) {

    }
}

public class UserController {

    // ì˜ì¡´ì„± ì£¼ì…
    private final UserService userService;
    private final List<RegObserver> regObservers;

    public Long register(String phone, String password) {
        long userId = userService.register(phone, password);                 // ì‹ ê·œ ì‚¬ìš©ì ë“±ë¡
        regObservers.forEach(observer -> observer.handleRegSuccess(userId)); // ì‹ ê·œ ì‚¬ìš©ìì— ëŒ€í•œ í”„ë¡œëª¨ì…˜ ìºì‹œ ì§€ê¸‰

        return userId;
    }
}
```

<br>

### ë¹„ë™ê¸° ë¹„ì°¨ë‹¨ ì˜µì €ë²„ íŒ¨í„´

- ì•„ë˜ ì˜ˆì œì—ì„œ ë¹„ë™ê¸° ë¹„ì°¨ë‹¨ ë°©ì‹ì„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”ë° 2ê°€ì§€ ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤.
- ì²«ë²ˆì§¸ëŠ” handleRegSuccess() ë©”ì„œë“œ ë‚´ë¶€ì—ì„œ ìƒˆë¡œìš´ ìŠ¤ë ˆë“œë¥¼ ìƒì„±í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.
- ë‘ë²ˆì§¸ëŠ” UserController í´ë˜ìŠ¤ì˜ register() ë©”ì„œë“œ ë‚´ë¶€ì—ì„œ ìƒˆë¡œìš´ ìŠ¤ë ˆë“œë¥¼ ìƒì„±í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.

#### ì²«ë²ˆì§¸ ë°©ë²•

- handleRegSuccess() ë©”ì„œë“œ ë‚´ë¶€ì—ì„œ ìƒˆë¡œìš´ ìŠ¤ë ˆë“œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

```java
public interface RegObserver {
    
    void handleRegSuccess(long userId);
}

public class RegNotificationObserver implements RegObserver {

    @Override
    public void handleRegSuccess(long userId) {
        new Thread(() -> {
           // ë¡œì§ ìˆ˜í–‰ 
        }).start();
    }
}

public class RegPromotionObserver implements RegObserver {

    @Override
    public void handleRegSuccess(long userId) {
        new Thread(() -> {
           // ë¡œì§ ìˆ˜í–‰ 
        }).start();
    }
}

public class UserController {

    // ì˜ì¡´ì„± ì£¼ì…
    private final UserService userService;
    private final List<RegObserver> regObservers;

    public Long register(String phone, String password) {
        long userId = userService.register(phone, password);                 // ì‹ ê·œ ì‚¬ìš©ì ë“±ë¡
        regObservers.forEach(observer -> observer.handleRegSuccess(userId)); // ì‹ ê·œ ì‚¬ìš©ìì— ëŒ€í•œ í”„ë¡œëª¨ì…˜ ìºì‹œ ì§€ê¸‰

        return userId;
    }
}
```

<br>

#### ë‘ë²ˆì§¸ ë°©ë²•

- UserController í´ë˜ìŠ¤ì˜ register() ë©”ì„œë“œ ë‚´ë¶€ì—ì„œ ìŠ¤ë ˆë“œ í’€ì„ ì‚¬ìš©í•˜ì§€ë§Œ ì´ ë°©ë²•ì€ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì˜ ë³µì¡ì„±ì„ ë”í•˜ê³  ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ê³¼ ë¹„ë™ê¸° ë¡œì§ì´ í•©ì³ì € ìœ ì§€ë³´ìˆ˜ê°€ í˜ë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```java
public interface RegObserver {
    
    void handleRegSuccess(long userId);
}

public class RegNotificationObserver implements RegObserver {

    @Override
    public void handleRegSuccess(long userId) {

    }
}

public class RegPromotionObserver implements RegObserver {

    @Override
    public void handleRegSuccess(long userId) {

    }
}

public class UserController {

    private final ExecutorService executors = Executors.newFixedThreadPool(10);

    // ì˜ì¡´ì„± ì£¼ì…
    private final UserService userService;
    private final List<RegObserver> regObservers;

    public Long register(String phone, String password) {
        long userId = userService.register(phone, password);                 // ì‹ ê·œ ì‚¬ìš©ì ë“±ë¡

        // ìŠ¤ë ˆë“œ í’€ ì‚¬ìš©
        CompletableFuture.runAsync(() -> {
            regObservers.forEach(observer -> observer.handleRegSuccess(userId)); // ì‹ ê·œ ì‚¬ìš©ìì— ëŒ€í•œ í”„ë¡œëª¨ì…˜ ìºì‹œ ì§€ê¸‰
        }, executors);

        return userId;
    }
}
```

<br>

#### ì„¸ë²ˆì§¸ ë°©ë²•

- ì´ ë°©ë²•ì€ ì±…ì—ëŠ” ì—†ì§€ë§Œ ê°œì¸ì ì¸ ìƒê°ìœ¼ë¡œëŠ” ìŠ¤ë ˆë“œ í’€ì„ RegObserver í´ë˜ìŠ¤ì˜ ê° êµ¬í˜„ì²´ì—ì„œ ìŠ¤ë ˆë“œ í’€ì„ ë§Œë“¤ì–´ ì‚¬ìš©í•˜ëŠ”ê²Œ ê°€ì¥ ì¢‹ì€ ë°©ë²•ì´ì§€ ì•Šì„ê¹Œ ìƒê°í•©ë‹ˆë‹¤.

















