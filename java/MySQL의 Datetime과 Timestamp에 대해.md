# MySQL의 Datetime과 Timestamp에 대해

<br>

## 1. Datetime에 대해

#### 기본 설명

- Datetime은 날짜와 시간을 모두 지원하며, 'YYYY-MM-DD HH:MM:SS' 형식으로 표시됩니다. 지원되는 범위는 '1000-01-01 00:00:00'부터 '9999-12-31 23:59:59'까지 지원이 됩니다.
- 문자형으로 데이터가 저장됩니다.
- 날짜와 시간을 저장하는데 5바이트를 사용하지만 초를 얼마나 정확하게 저장하고 싶은지에 따라 추가로 3바이트(소숫점 6자리)를 사용하며 총 8바이트의 저장 공간을 사용하게 됩니다.

<br>

## 2. Timestamp에 대해

#### 기본 설명

- Timestamp는 UTC를 기반으로 동작하며, Timezone을 기반으로 하고 있습니다.
- Timestamp는 UNIX Timestamp를 사용하고 있으며, '1970-01-01 00:00:01' UTC부터 '2038-01-19 03:14:07' UTC까지 지원이 됩니다. (2038년 문제를 가지고 있습니다.)
- 숫자형으로 데이터를 저장합니다.
- 4 바이트의 저장 공간을 사용합니다.

<br>

## 3. 테스트

- mysql:8.0.30 버전을 사용하여 테스트를 진행하였습니다.

#### 1. 예제 테이블 생성

```mysql
CREATE TABLE date_demo ( 
  datetime DATETIME,
  timestamp TIMESTAMP
) ENGINE=INNODB DEFAULT CHARSET=utf8mb4;
```


#### 2. 데이터 저장 및 조회

- 현재 시간 09월 08일 19시 54분인데 기본 설정이 UTC로 설정이 되어있나...?

```mysql
> INSERT INTO date_demo VALUES (now(), now());
> SELECT * FROM date_demo;
+---------------------+---------------------+
| datetime            | timestamp           |
+---------------------+---------------------+
| 2024-09-08 10:54:32 | 2024-09-08 10:54:32 |
+---------------------+---------------------+
```

#### 3. TimeZone 확인

- time_zone이 UTC로 설정이 되어있어 2번 과정에서 9시간이 빨랐던것입니다.

```mysql
> SELECT @@GLOBAL.time_zone, @@SESSION.time_zone, @@system_time_zone;
+---------------------+----------------------+---------------------+
| @@GLOBAL.time_zone  | @@SESSION.time_zone  | @@SESSION.time_zone | 
+---------------------+----------------------+---------------------+
| SYSTEM              | SYSTEM               | UTC                 |   
+---------------------+----------------------+---------------------+
```

#### 4. TimeZone 변경 및 기존 데이터 확인

- 'Asia/Seoul'로 timeZone을 변경하기 위해 09시간을 추가하였습니다.
- 그리고 다시 조회를 해보면 timestamp로 설정해 놓은 컬럼은 timeZone을 설정해놓은 값으로 데이터가 출력되는 것을 학인해볼 수 있습니다.

```mysql
> SET time_zone = '+9:00';
+---------------------+----------------------+---------------------+
| @@GLOBAL.time_zone  | @@SESSION.time_zone  | @@SESSION.time_zone | 
+---------------------+----------------------+---------------------+
| SYSTEM              | +09:00               | UTC                 |   
+---------------------+----------------------+---------------------+

> SELECT * FROM date_demo;
+---------------------+---------------------+
| datetime            | timestamp           |
+---------------------+---------------------+
| 2024-09-08 10:54:32 | 2024-09-08 19:54:32 |
+---------------------+---------------------+
```

#### 5. 다시 데이터 저장 및 조회

- 다시 데이터를 저장하고 조회를 해보면 UTC 기반이 아닌 timeZone으로 설정해놓은 시간값으로 나타나는 것을 확인할 수 있습니다.

```mysql
> INSERT INTO date_demo VALUES (now(), now());
> SELECT * FROM date_demo;
+---------------------+---------------------+
| datetime            | timestamp           |
+---------------------+---------------------+
| 2024-09-08 10:54:32 | 2024-09-08 19:54:32 |
+---------------------+---------------------+
| 2024-09-08 20:15:08 | 2024-09-08 20:15:08 |
+---------------------+---------------------+
```

#### 6. 다른 세션을 통해 조회를 해보면? 

- [4]번 과정에서 time_zone을 설정할 때 GLOBAL이 아닌 SESSION으로 설정을 하였습니다.
- 그리고 이후 다른 세션에서 데이터를 조회 하자 timestamp의 값은 UTC기반으로 데이터가 출력되는 것을 알 수 있지만 왜 갑자기 datetime은 '20:15:08'로 출력이 되는걸까요?
- 그 이유는 모두가 알고 계시듯 datetime은 timeZone의 설정과는 무관하게 고정된 시간을 갖기 때문입니다. 따라서 글로벌 서비스를 해야한다면 datetime이 아닌 timestamp를 사용해야합니다.

```mysql
⭐️ 기존 세션에서 데이터 조회
> SELECT * FROM date_demo;
+---------------------+---------------------+
| datetime            | timestamp           |
+---------------------+---------------------+
| 2024-09-08 10:54:32 | 2024-09-08 19:54:32 |
+---------------------+---------------------+
| 2024-09-08 20:15:08 | 2024-09-08 20:15:08 |
+---------------------+---------------------+

⭐️ 다른 세션에서 데이터 조회
> SELECT * FROM date_demo;
+---------------------+---------------------+
| datetime            | timestamp           |
+---------------------+---------------------+
| 2024-09-08 10:54:32 | 2024-09-08 19:54:32 |
+---------------------+---------------------+
| 2024-09-08 20:15:08 | 2024-09-08 11:15:08 |
+---------------------+---------------------+
```













<br>

#### 참고

- https://dev.mysql.com/doc/refman/8.0/en/datetime.html
- https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_time_zone
- https://namu.wiki/w/2038%EB%85%84%20%EB%AC%B8%EC%A0%9C
- https://www.linkedin.com/pulse/datetime-vs-timestamp-datatype-databases-which-one-better-bhayani/ 
