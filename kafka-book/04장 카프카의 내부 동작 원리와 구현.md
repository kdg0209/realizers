# ì¹´í”„ì¹´ ë¦¬í”Œë¦¬ì¼€ì´ì…˜
<hr>

#### í† í”½ ìƒì„±

- ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ íŒŒí‹°ì…˜ 3ê°œ, ë¦¬í”Œë¦¬ì¼€ì´ì…˜ íŒ©í„° 3ê°œì˜ í† í”½ì„ ìƒì„±í•©ë‹ˆë‹¤.
```
kafka-topics --bootstrap-server localhost:9092 --create --topic topic-p3-r3 --partitions 3 --replication-factor 3
```

#### í† í”½ ì¡°íšŒ

- í† íŒì„ ì¡°íšŒí•˜ë©´ ì •ìƒì ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ ê²ƒì„ ì•Œ ìˆ˜ ìˆê³ , íŒŒí‹°ì…˜ì´ ë³µì œëœê²ƒë„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```
kafka-topics --bootstrap-server localhost:9092 --describe --topic topic-p3-r3
```

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-02-01 á„‹á…©á„’á…® 10 53 29](https://github.com/kdg0209/realizers/assets/80187200/8156a4be-e70d-4c76-be93-df6e52040318)

#### ê·¸ë¦¼ìœ¼ë¡œ ì´í•´í•˜ê¸°

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-02-01 á„‹á…©á„’á…® 10 57 52](https://github.com/kdg0209/realizers/assets/80187200/daf478b7-9bf6-4f3a-b24c-c4f0296394e4)

<br>

## Leader Partition

- Producerì™€ ConsumerëŠ” Leader Partitionì„ í†µí•´ ì½ê¸°ì™€ ì“°ê¸°ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.
- ì¦‰ ProducerëŠ” ë©”ì‹œì§€ ì „ì†¡ì‹œ ëª¨ë“  ë¦¬í”Œë¦¬ì¼€ì´ì…˜ì— ë©”ì‹œì§€ë¥¼ ì „ì†¡í•˜ëŠ”ê²Œ ì•„ë‹ˆë¼ Leader Partitionì—ê²Œë§Œ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤. 
ë˜í•œ Consumerë„ Leader Partitionìœ¼ë¡œë¶€í„° ë©”ì‹œì§€ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.

#### ğŸ’¡ Kafka 2.4 ì—…ë°ì´íŠ¸

- kafka 2.4 ë²„ì „ë¶€í„° ConsumerëŠ” Follower Partitionìœ¼ë¡œë¶€í„° ë©”ì‹œì§€ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.(Follower Fetching)
- https://www.conduktor.io/kafka/kafka-topic-replication/#acks-=-all-2
- https://developers.redhat.com/blog/2020/04/29/consuming-messages-from-closest-replicas-in-apache-kafka-2-4-0-and-amq-streams#

<br>

## Leaderì™€ Followerì˜ ë¦¬í”Œë¦¬ì¼€ì´ì…˜ ë™ì‘

- ì¹´í”„ì¹´ëŠ” ë¦¬í”Œë¦¬ì¼€ì´ì…˜ ê³¼ì •ì—ì„œ ACK í†µì‹  ë‹¨ê³„ë¥¼ ì œê±°í•¨ìœ¼ë¡œì¨ ì„±ëŠ¥ì„ ë†’ì˜€ìŠµë‹ˆë‹¤.
- ìš°ì„  ë¦¬í”Œë¦¬ì¼€ì´ì…˜ì˜ ë™ì‘ì„ ì›ë¦¬ë¥¼ íŒŒì•…í•˜ê¸° ìœ„í•´ì„œ ë‹¤ìŒê³¼ ê°™ì€ ì„¤ì •ì„ í•´ì•¼í•©ë‹ˆë‹¤.
- acks: all
- min.insync.replicas: 3 (ìµœì†Œ ë¦¬í”Œë¦¬ì¼€ì´ì…˜ ìˆ˜)

#### ê³¼ì •

1. Leader Partitionë§Œì´ 0ë²ˆ ì˜¤í”„ì…‹ì— ì´ˆë¡ìƒ‰ ìƒˆë¡œìš´ ë©”ì‹œì§€ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.
2. Follower Partitionë“¤ì€ Leaderì—ê²Œ 0ë²ˆ ì˜¤í”„ì…‹ì˜ ë©”ì‹œì§€ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ Fetch ìš”ì²­ì„ ë³´ë‚¸ í›„ ìƒˆë¡œìš´ ë©”ì‹œì§€(ì´ˆë¡ìƒ‰)ê°€ ìˆë‹¤ëŠ” ì‚¬ì‹¤ì„ ì¸ì§€í•˜ê³  ë¦¬í”Œë¦¬ì¼€ì´ì…˜í•˜ê²Œ ë©ë‹ˆë‹¤.
3. Leader Partitionì€ ëª¨ë“  Followerê°€ 0ë²ˆ ì˜¤í”„ì…‹ ë©”ì‹œì§€ì— ëŒ€í•´ Fetch ìš”ì²­ì„ ë³´ëƒˆë‹¤ëŠ” ì‚¬ì‹¤ì„ ì•Œê³  ìˆìŠµë‹ˆë‹¤.(í•˜ì§€ë§Œ LeaderëŠ” Followerê°€ ì„±ê³µì ìœ¼ë¡œ ë¦¬í”Œë¦¬ì¼€ì´ì…˜ í–ˆëŠ”ì§€ëŠ” ëª¨ë¦…ë‹ˆë‹¤.)

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-02-01 á„‹á…©á„’á…® 11 49 17](https://github.com/kdg0209/realizers/assets/80187200/247270aa-f086-4fb4-a7d9-a10d34db14bf)

4. 3ë²ˆì§¸ flowì—ì„œ Producerë¡œë¶€í„° ìƒˆë¡œìš´ ë©”ì‹œì§€ë¥¼ ë°›ê²Œë©ë‹ˆë‹¤.
5. 0ë²ˆ ì˜¤í”„ì…‹ì— ëŒ€í•œ ë¦¬í”Œë¦¬ì¼€ì´ì…˜ì„ ë§ˆì¹œ Followerë“¤ì€ Leaderì—ê²Œ ë‹¤ìŒ ì˜¤í”„ì…‹ì„ Fetchí•˜ê²Œ ë©ë‹ˆë‹¤.
6. Followerë“¤ë¡œë¶€í„° 1ë²ˆ ì˜¤í”„ì…‹ì— ëŒ€í•œ Fetch ìš”ì²­ì„ ë°›ì€ LeaderëŠ” 0ë²ˆ ì˜¤í”„ì…‹ì´ ì •ìƒì ìœ¼ë¡œ ë³µì œë˜ì—ˆìŒì„ ì¸ì§€í•˜ê³  ì˜¤í”„ì…‹ 0ë²ˆì„ ì»¤ë°‹í•˜ê²Œ ë©ë‹ˆë‹¤.
   - ë§Œì•½ Followerê°€ 0ë²ˆ ì˜¤í”„ì…‹ì„ ì •ìƒì ìœ¼ë¡œ ë³µì œí•˜ì§€ ëª»í•œë‹¤ë©´ FollowerëŠ” ë‹¤ì‹œ Fetch ìš”ì²­ì„ í–ˆì„ ë•Œ 1ë²ˆ ì˜¤í”„ì…‹ì´ ì•„ë‹Œ 0ë²ˆ ì˜¤í”„ì…‹ì— ëŒ€í•´ Fetch ìš”ì²­ì„ ë³´ë‚´ê°œ ë©ë‹ˆë‹¤. ë”°ë¼ì„œ LeaderëŠ” Followerê°€ ìš”ì²­í•œ ì˜¤í”„ì…‹ì„ ë³´ê³  ì„±ê³µí–ˆëŠ”ì§€ ì¸ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
7. Followerë“¤ë¡œë¶€í„° 1ë²ˆ ì˜¤í”„ì…‹ Fetchë¥¼ ë°›ì€ LeaderëŠ” ì‘ë‹µì— 0ë²ˆ ì˜¤í”„ì…‹ ë©”ì‹œì§€ê°€ ì»¤ë°‹ë˜ì—ˆë‹¤ëŠ” ë‚´ìš©ë„ í•¨ê»˜ ì „ë‹¬í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  Leaderì˜ ì‘ë‹µì„ ë°›ì€ ëª¨ë“  Followerë„ 0ë²ˆ ì˜¤í”„ì…‹ ë©”ì‹œì§€ê°€ ì»¤ë°‹ë˜ì—ˆë‹¤ëŠ” ê²ƒì„ ì•Œê²Œë˜ê³ , ì»¤ë°‹ì„ í‘œì‹œí•˜ê²Œ ë©ë‹ˆë‹¤.

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-02-01 á„‹á…©á„’á…® 11 56 28](https://github.com/kdg0209/realizers/assets/80187200/c5a4102e-4276-4100-baf6-6215d539c937)

<br>

## Isr(In-Sync-Replica)

- Leaderì™€ FollowerëŠ” Isrì´ë¼ëŠ” ë…¼ë¦¬ì  ê·¸ë£¹ìœ¼ë¡œ ë¬¶ì—¬ ìˆìŠµë‹ˆë‹¤. 
- ë…¼ë¦¬ì  ê·¸ë£¹ìœ¼ë¡œ ë‚˜ëˆ„ëŠ” ì´ìœ ëŠ” í•´ë‹¹ ê·¸ë£¹ì— ì†í•œ Followerë“¤ë§Œì´ Leaderê°€ ì£½ì€ ê²½ìš° ìƒˆë¡œìš´ Leaderì˜ ìê²©ì„ ê°€ì§ˆ ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ë‹¤ì‹œë§í•´ Isr ê·¸ë£¹ì— ì†í•˜ì§€ ëª»í•œ FollowerëŠ” ìƒˆë¡œìš´ Readerì˜ ìê²©ì´ ë  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
- ìœ„ ë¦¬í”Œë¦¬ì¼€ì´ì…˜ ë™ì‘ ê³¼ì •ì„ í†µí•´ Isrë‚´ì— ìˆëŠ” ëª¨ë“  Followerì—ê²Œ ë³µì œê°€ ì™„ë£Œë˜ë©´, LeaderëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ì»¤ë°‹ë˜ì—ˆë‹¤ëŠ” í‘œì‹œë¥¼ í•˜ê²Œëœë‹¤ëŠ” ê²ƒì„ ì•Œê²Œë˜ì—ˆìŠµë‹ˆë‹¤. ë§ˆì§€ë§‰ ì˜¤í”„ì…‹ ìœ„ì¹˜ëŠ” í•˜ì´ì›Œí„°ë§ˆí¬ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤.
- ì¦‰ ì»¤ë°‹ë˜ì—ˆë‹¤ëŠ” ê²ƒì€ ë¦¬í”Œë¦¬ì¼€ì´ì…˜ íŒ©í„° ìˆ˜ì˜ ëª¨ë“  ë¦¬í”Œë¦¬ì¼€ì´ì…˜ì´ ì „ë¶€ ë©”ì‹œì§€ë¥¼ ì €ì¥í–ˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì´ë ‡ê²Œ ì»¤ë°‹ëœ ë©”ì‹œì§€ë§Œ Consumerê°€ ì½ì–´ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<br>

## Leader Epochì™€ ë³µêµ¬

<br>

## ë¡œê·¸(ì„¸ê·¸ë¨¼íŠ¸)

- ì¹´í”„ì¹´ì˜ í† í”½ìœ¼ë¡œ ë“¤ì–´ì˜¤ëŠ” ë ˆì½”ë“œ(ë©”ì‹œì§€)ëŠ” segmentë¼ëŠ” íŒŒì¼ì— ì €ì¥ë©ë‹ˆë‹¤.
- segmentì—ëŠ” key, value, offset, payloadì™€ ê°™ì€ ì •ë³´ê°€ ë¸Œë¡œì»¤ì˜ ë¡œì»¬ ë””ìŠ¤í¬ì— ì €ì¥ë©ë‹ˆë‹¤.
- segmentì˜ ê¸°ë³¸ í¬ê¸°ëŠ” 1GBë¡œ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤. segmentì˜ í¬ê¸°ê°€ 1GBë³´ë‹¤ ì»¤ì§€ëŠ” ê²½ìš° í•´ë‹¹ segmentëŠ” closeë˜ê³ , ë¡¤ë§ ì „ëµì„ ì ìš©ë˜ê²Œ ë©ë‹ˆë‹¤.
- closeëœ segmentëŠ” ì½ê¸°ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.

<img width="960" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-02-03 á„‹á…©á„’á…® 1 13 28" src="https://github.com/kdg0209/realizers/assets/80187200/47c9a4fb-de48-416b-9af2-62cd6201cb32">

<br>


### rolling ë§¤ì»¤ë‹ˆì¦˜ í…ŒìŠ¤íŠ¸

#### segment.bytesë¥¼ 10KBë¡œ í•˜ì—¬ í…ŒìŠ¤íŠ¸ ì§„í–‰

```
1. ì˜ˆì œ í† í”½ ìƒì„±
kafka-topics --bootstrap-server localhost:9092 --create --topic segment-test-topic --partitions 3

2. ìƒì„±í•œ í† í”½ì˜ segment byte ìˆ˜ì •
kafka-configs --bootstrap-server localhost:9092 --entity-type topics --entity-name segment-test-topic --alter --add-config segment.bytes=10240

3. ë³€ê²½í•œ ë‚´ìš© í™•ì¸
kafka-configs --bootstrap-server localhost:9092 --entity-type topics --entity-name segment-test-topic --all --describe | grep segment.bytes

4. ì•„ë˜ì™€ ê°™ì´ ì¶œë ¥ë˜ë©´ ì •ìƒì ìœ¼ë¡œ ë³€ê²½ëœ ê²ƒ
segment.bytes=10240 sensitive=false synonyms={DYNAMIC_TOPIC_CONFIG:segment.bytes=10240, STATIC_BROKER_CONFIG:log.segment.bytes=1073741824, DEFAULT_CONFIG:log.segment.bytes=1073741824}

5. í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ íŒŒì¼ ì‘ì„±
for i in {1..2000}
do
echo "test message send test-i" >> message.log
done

6. íŒŒì¼ ê¸°ë°˜ìœ¼ë¡œ ë©”ì‹œì§€ ì „ì†¡
kafka-console-producer --bootstrap-server localhost:9092 --topic segment-test-topic < message.log
```

<img width="1038" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-02-03 á„‹á…©á„’á…® 1 46 50" src="https://github.com/kdg0209/realizers/assets/80187200/5cbdbfac-0c84-4888-b5a3-d3cba6a69c2b">

#### segment.msë¥¼ 60ì´ˆ í•˜ì—¬ í…ŒìŠ¤íŠ¸ ì§„í–‰

```
1. segment.byteë¥¼ ê¸°ë³¸ ì†ì„±ê°’ìœ¼ë¡œ ë˜ëŒë¦¼
kafka-configs --bootstrap-server localhost:9092 --entity-type topics --entity-name segment-test-topic --alter --delete-config segment.bytes

2. segment.msë¥¼ 60ì´ˆë¡œ ìˆ˜ì •
kafka-configs --bootstrap-server localhost:9092 --entity-type topics --entity-name segment-test-topic --alter --add-config segment.ms=60000

3. íŒŒì¼ ê¸°ë°˜ìœ¼ë¡œ ë©”ì‹œì§€ ì „ì†¡
kafka-console-producer --bootstrap-server localhost:9092 --topic segment-test-topic < message.log
```

<img width="997" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-02-03 á„‹á…©á„’á…® 2 02 38" src="https://github.com/kdg0209/realizers/assets/80187200/2ed997f7-fd56-46ec-b186-3268ad2fb62a">


#### ğŸ¤” index, timeindexëŠ” ë¬´ì—‡ì¼ê¹Œ?

- ìš°ì„  log.index.interval.bytesë¥¼ ì•Œì•„ì•¼ í•˜ëŠ”ë° í•´ë‹¹ ì†ì„±ì€ ìƒˆë¡œìš´ í•­ëª©ì´ offset indexì— ì¶”ê°€ë˜ëŠ” ì£¼ê¸°ì´ë‹¤.
- indexëŠ” ëª¨ë“  offsetì— ëŒ€í•œ byte positionì„ ê°€ì§€ê³  ìˆì§€ ì•Šìœ¼ë©°, log.index.interval.bytesì— ì„¤ì •ëœ ë§Œí¼ì˜ segment byteê°€ ë§Œë“¤ì–´ì§ˆë•Œë§ˆë‹¤ í•´ë‹¹ offesetì— ëŒ€í•œ byte position ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.
- timeindexëŠ” ë©”ì‹œì§€ì˜ ìƒì„± Unix ì‹œê°„ì„ ms ë‹¨ìœ„ë¡œ ê°€ì§€ê³  ìˆê³ , í•´ë‹¹ ìƒì„± ì‹œê°„ì— í•´ë‹¹í•˜ëŠ” offsetì •ë³´ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.
- ë”°ë¼ì„œ index, timeindexë¥¼ ê°€ì§€ê³  random accessì‹œ íŒŒì¼ì˜ ìš©ëŸ‰ë§Œí¼ ìˆ˜í–‰ ì‹œê°„(scan ì‹œê°„)ì´ ì†Œìš”ë˜ëŠ”ê²Œ ì•„ë‹ˆë¼ ì¡°ê¸ˆ ë” íš¨ìœ¨ì ìœ¼ë¡œ ì°¾ì„ ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.

```
1. log.index.interval.bytes í™•ì¸ (ê¸°ë³¸ 4KB)
kafka-configs --bootstrap-server localhost:9092 --entity-type topics --entity-name segment-test-topic --all --describe | grep log.index.interval.bytes
```

<img width="1041" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-02-03 á„‹á…©á„’á…® 2 31 49" src="https://github.com/kdg0209/realizers/assets/80187200/35b0cd81-5a85-47a9-ae0f-9aa953945285">

<br>

### Log Cleanup Policy 

#### delete

- deleteë¡œ ì„¤ì •í•˜ë©´ segmentë¥¼ log.retention.hoursë‚˜ log.retention.bytes ì„¤ì •ê°’ì— ë”°ë¼ ì‚­ì œí•©ë‹ˆë‹¤.

#### compact

- compactë¡œ ì„¤ì •í•˜ë©´ segmentë¥¼ key ê°’ ë ˆë²¨ë¡œ ê°€ì¥ ìµœì‹ ì˜ ë©”ì‹œì§€ë§Œ ìœ ì§€í•˜ë„ë¡ segmentë¥¼ ì¬êµ¬ì„± í•©ë‹ˆë‹¤.

#### delete, compact

- compactì™€ deleteë¥¼ í•¨ê»˜ ì ìš©í•©ë‹ˆë‹¤.

#### delete ì˜ˆì œ

- log.retention.hours: ê°œë³„ segmentì˜ ìœ ì§€ ì‹œê°„(ê¸°ë³¸ 7ì¼)
- log.retention.bytes: ì‚­ì œí•˜ê¸° ì „ì— ë³´ê´€í•  íŒŒí‹°ì…˜ ë‹¹ ë¡œê·¸ ìˆ˜. ê¸°ë³¸ê°’ì€ -1. í† í”½ë³„ë¡œ ì„¤ì •ì´ ê°€ëŠ¥í•˜ë©°, ë¡œê·¸ì˜ ì‹œê°„ì´ë‚˜ í¬ê¸°ì œí•œì— ë„ë‹¬í•˜ë©´ ì‚­ì œë©ë‹ˆë‹¤.
- log.retention.check.interval.ms: ë¸Œë¡œì»¤ê°€ ë°±ê·¸ë¼ìš´ë“œë¡œ ì‚­ì œí•  segmentë¥¼ ì°¾ëŠ” ì£¼ê¸°ì…ë‹ˆë‹¤.

```
1. ê¸°ë³¸ ì‚­ì œ ì •ì±… ì¡°íšŒ(ê¸°ë³¸: delete)
kafka-configs --bootstrap-server localhost:9092 --entity-type topics --entity-name segment-test-topic --all --describe | grep log.cleanup.policy

2. ë¸Œë¡œì»¤ì˜ segment ìœ ì§€ ì‹œê°„ ì¡°íšŒ(ê¸°ë³¸: 7ì¼)
kafka-configs --bootstrap-server localhost:9092 --entity-type brokers --entity-name 0 --all --describe | grep log.retention.hours

3. í† í”½ì˜ retention í™•ì¸(ê¸°ë³¸: retention.ms=604800000(7ì¼))
kafka-configs --bootstrap-server localhost:9092 --entity-type topics --entity-name segment-test-topic --all --describe | grep retention

4. í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ retention.bytesë¥¼ 10KBë¡œ ìˆ˜ì •
kafka-configs --bootstrap-server localhost:9092 --entity-type topics --entity-name segment-test-topic --alter --add-config retention.bytes=10240

5. í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ retention.msë¥¼ 3ë¶„ìœ¼ë¡œ ìˆ˜ì •
kafka-configs --bootstrap-server localhost:9092 --entity-type topics --entity-name segment-test-topic --alter --add-config retention.ms=180000
```

#### ğŸ’¡ ì°¸ê³ 

- Active Segmentì§€ë§Œ ì•„ë¬´ëŸ° ë©”ì‹œì§€ê°€ ì•ˆì˜¨ ìƒíƒœì—ì„œ log.retention.hoursì˜ ì‹œê°„ì´ ì§€ë‚˜ë©´ ì‚­ì œ ëŒ€ìƒì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<img width="1026" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-02-03 á„‹á…©á„’á…® 3 05 52" src="https://github.com/kdg0209/realizers/assets/80187200/7670d3bc-9c68-49cf-b439-b823ededc60c">

#### compact

- log.cleanup.policyë¥¼ compactë¡œ ì„¤ì •ì‹œ segmentì˜ key ê°’ì— ë”°ë¼ ê°€ì¥ ìµœì‹ ì˜ ë©”ì‹œì§€ë§Œ segmentë¥¼ ì¬êµ¬ì„±í•˜ê²Œ ë©ë‹ˆë‹¤.
- keyê°€ nullì¸ ë©”ì‹œì§€ëŠ” ì ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
- log cleanerê°€ ë°±ê·¸ë¼ìš´ë“œ ìŠ¤ë ˆë“œ ë°©ì‹ìœ¼ë¡œ ë³„ë„ì˜ I/O ì‘ì—…ì„ ìˆ˜í–‰í•˜ë¯€ë¡œ ì¶”ê°€ì ì¸ I/O ë¶€í•˜ê°€ ì†Œëª¨ë©ë‹ˆë‹¤.
- log compactionì„ ì‚¬ìš©í•˜ë©´ ë¹ ë¥¸ ì¥ì•  ë³µêµ¬ë¥¼ í• ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¥ì•  ë³µêµ¬ ì‹œ ì „ì²´ ë¡œê·¸ë¥¼ ë³µêµ¬í•˜ì§€ ì•Šê³ , ë©”ì‹œì§€ì˜ í‚¤ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìµœì‹  ìƒíƒœë§Œ ë³µêµ¬í•˜ë©°, ë”°ë¼ì„œ ì „ì²´ ë¡œê·¸ë¥¼ ë³µêµ¬í•  ë•Œë³´ë‹¤ ë³µêµ¬ ì‹œê°„ì„ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<img width="983" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-02-03 á„‹á…©á„’á…® 3 31 22" src="https://github.com/kdg0209/realizers/assets/80187200/ae2a8520-69f8-4275-aa2c-12d817b87e1f">

#### ì˜ˆì œ

```
1. ì˜ˆì œ í† í”½ ìƒì„±
kafka-topics --bootstrap-server localhost:9092 --create --topic compact-test-topic --partitions 3

2. í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ retention.bytesë¥¼ 10KBë¡œ ìˆ˜ì •
kafka-configs --bootstrap-server localhost:9092 --entity-type topics --entity-name compact-test-topic --alter --add-config retention.bytes=10240

3. í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ cleanup.policyë¥¼ compactë¡œ ìˆ˜ì •
kafka-configs --bootstrap-server localhost:9092 --entity-type topics --entity-name compact-test-topic --alter --add-config cleanup.policy=compact

4. log compaction ëª¨ë‹ˆí„°ë§
- compact-test-topicì˜ log ë””ë ‰í† ë¦¬ì—ì„œ ìˆ˜í–‰
while true
do
sleep 10
echo "######## `date` ########"
ls -li
done

5. key ë©”ì‹œì§€ 2000ê°œë¥¼ keyload.logì— ê¸°ë¡í•˜ê¸°. 
for i in {1..2000}
do
echo "$i:test message send i" >> key-message.log
done

6. íŒŒì¼ ê¸°ë°˜ìœ¼ë¡œ ë©”ì‹œì§€ ì „ì†¡
kafka-console-producer --bootstrap-server localhost:9092 --topic compact-test-topic < key-message.log --property key.separator=: --property parse.key=true
```









