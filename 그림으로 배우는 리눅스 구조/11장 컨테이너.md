# 컨테이너

<br>

## 1. 가상 머신과 차이점

- 가상 머신은 각 가상 머신 전용의 가상 하드웨어와 커널을 사용하는 반면 컨테이너는 컨테이너가 동작하는 호스트 OS와 모든 컨테이너가 하나의 커널을 공유합니다.
- 즉, 가상 머신은 윈도우에서 리눅스를 실행하는 등 완전히 다른 게스트 OS를 사용할 수 있지만 컨테이너는 호스트 OS와 게스트 OS가 동일합니다.

### 1.1 기동 순서

#### 가상 머신 기동 순서

```txt
▶ 사용자가 VM 실행 요청
  │
  ▼
① 하이퍼바이저 기동 (KVM)
  - QEMU가 가상 하드웨어 구성 (CPU, RAM, 디스크, NIC 등)
  - KVM이 커널 모듈로 CPU 가상화 지원
  │
  ▼
② 부트로더 실행 (ex. GRUB)
  - VM 디스크 이미지에서 커널을 로딩
  │
  ▼
③ 게스트 OS 커널 부팅
  - init → systemd → background services 시작
  │
  ▼
④ VM 안에서 사용자 애플리케이션 기동
```

<br>

#### 컨테이너 기동 순서

- 컨테이너는 이미 실행 중인 호스트 커널을 사용하므로 커널 부팅이 없을뿐만 아니라 init, systemd 등 부트 프로세스가 없고, 가상 하드웨어 필요 없고, 이미지 레이어 캐시 재사용을 하기 때문에 가상 머신보다 빠릅니다.

```txt
▶ 사용자가 컨테이너 실행 요청
  │
  ▼
① Docker 엔진 요청 수신
  - CLI or Docker API
  │
  ▼
② 컨테이너 이미지에서 레이어 조합
  - 이미지를 컨테이너 파일시스템으로 마운트
  │
  ▼
③ 네임스페이스 & cgroups 설정
  - PID, Mount, Network, UTS, IPC, User 등 격리 환경 생성
  │
  ▼
④ 컨테이너 프로세스 직접 실행
  - ENTRYPOINT 또는 CMD로 정의된 명령 실행
```

<br>

## 2. 네임스페이스

- 컨테이너는 리눅스 커널의 네임스페이스 기능을 활용하여 `프로세스와 자원을 격리` 함으로써 독립된 환경을 제공합니다.

#### 💡 네임스페이스란?

- 네임스페이스는 하나의 리눅스 커널 위에서 프로세스마다 격리된 자원 공간을 제공하는 기능입니다.
- 각 네임스페이스에 속한 프로세스는 마치 자신만의 시스템을 가진 것처럼 만들어 주는 기능입니다.

<br>

### 2-1. 네임스페이스의 종류

#### PID 네임스페이스

- PID 네임스페이스는 프로세스 ID 번호 공간을 격리하는 기능입니다.
- 각 네임스페이스는 자신만의 PID 1번부터 시작되는 프로세스 계층 구조를 가집니다.
- 격리된 PID 공간 덕분에 컨테이너 내부에서는 호스트의 프로세스를 볼 수 없고, 자기 자신만의 프로세스를 관리할 수 있습니다.


