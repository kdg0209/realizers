# ScopeÎûÄ Î¨¥ÏóáÏù∏Í∞Ä?

<br>

## 1. Í∏∞Î≥∏ Í∞úÎÖê

- ScopeÎûÄ Ïä§ÌîÑÎßÅ Ïª®ÌÖåÏù¥ÎÑàÏóêÏÑú ÎπàÏù¥ Í¥ÄÎ¶¨ÎêòÎäî Î≤îÏúÑÎ•º ÎßêÌï©ÎãàÎã§. Í∑∏Îüº Ïä§ÌîÑÎßÅ Î∞∞ÏπòÏóêÏÑú ÎßêÌïòÎäî ScopeÎäî Î¨¥ÏóáÏùºÍπåÏöî?

#### Ïä§ÌîÑÎßÅ Î∞∞ÏπòÏóêÏÑú ScopeÎûÄ?

- Ïä§ÌîÑÎßÅ Î∞∞ÏπòÏóêÏÑúÎäî @JobScope, @StepScope Ïñ¥ÎÖ∏ÌÖåÏù¥ÏÖòÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ ScopeÎ•º ÎßåÎì§ Ïàò ÏûàÏäµÎãàÎã§.
- @JobScope, @StepScope Ïñ¥ÎÖ∏ÌÖåÏù¥ÏÖòÏùÄ Í∏∞Î≥∏Ï†ÅÏúºÎ°ú ÌîÑÎ°ùÏãú Î™®ÎìúÎ°ú ÎèôÏûëÌïòÍ≤å Îê©ÎãàÎã§. Îî∞ÎùºÏÑú Îπà ÏÉùÏÑ±Ïù¥ Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò Íµ¨ÎèôÏãúÏ†êÏù¥ ÏïÑÎãå ÎπàÏùò Ïã§ÌñâÏãúÏ†êÏóê Ïù¥Î£®Ïñ¥ÏßÄÍ≤å Îê©ÎãàÎã§.

#### üßê ÌîÑÎ°ùÏãú Î™®ÎìúÎ°úÏù∏Ìïú Late BindingÏùÄ Î¨¥ÏóáÏù¥ Ïù¥Ï†êÏù∏Í∞Ä?

- ApplicationContextÍ∞Ä Ïã§ÌñâÎêòÎäî ÏãúÏ†êÏù¥ ÏïÑÎãå ServiceÏôÄ Í∞ôÏùÄ ÎπÑÏßÄÎãàÏä§ Î°úÏßÅ Ï≤òÎ¶¨ Îã®Í≥ÑÏóêÏÑú Job ParameterÎ•º Ìï†ÎãπÌï† Ïàò ÏûàÏäµÎãàÎã§.
- Î≥ëÎ†¨Ï≤òÎ¶¨Ïãú Í∞Å Ïä§Î†àÎìúÎßàÎã§ ÏÉùÏÑ±Îêú Scope ÎπàÏù¥ Ìï†ÎãπÎêòÍ∏∞ ÎïåÎ¨∏Ïóê Î©ÄÌã∞ Ïä§Î†àÎìúÏóê ÏïàÏ†ÑÌï©ÎãàÎã§.
  - StepÏïàÏóê TaskletÏù¥ ÏûàÍ≥†, TaskletÏóêÏÑú Î©§Î≤Ñ Î≥ÄÏàòÏóê Ï†ëÍ∑ºÌïòÏó¨ Ìï¥Îãπ Î≥ÄÏàòÎ•º ÏàòÏ†ïÌïòÎäî Î°úÏßÅÏù¥ ÏûàÎã§Í≥† Í∞ÄÏ†ïÌñàÏùÑ Í≤ΩÏö∞ ÏÑúÎ°ú Îã§Î•∏ StepÏóêÏÑú ÌïòÎÇòÏùò TaskletÏùÑ ÎëêÍ≥† Î©§Î≤Ñ Î≥ÄÏàò ÏÉÅÌÉúÎ•º Î≥ÄÍ≤ΩÌïúÎã§Î©¥ ÎèôÏãúÏÑ† Ïù¥ÏäàÍ∞Ä Î∞úÏÉùÌïòÍ≤å Îê©ÎãàÎã§. ÌïòÏßÄÎßå @StepScope ÎÇ¥Î∂ÄÏóê ÏûàÎã§Î©¥
Í∞ÅÍ∞ÅÏùò StepÏóêÏÑú Î≥ÑÎèÑÏùò TaskletÏùÑ ÏÉùÏÑ±ÌïòÍ≥† Ïã§ÌñâÌïòÍ∏∞ ÎïåÎ¨∏Ïóê ÎèôÏãúÏÑ± Ïù¥ÏäàÍ∞Ä Î∞úÏÉùÌïòÏßÄ ÏïäÍ≤å Îê©ÎãàÎã§.

#### Ï£ºÏùòÏÇ¨Ìï≠

- @Value Ïñ¥ÎÖ∏ÌÖåÏù¥ÏÖòÏùÑ ÏÇ¨Ïö©Ìï† Í≤ΩÏö∞ Îπà ÏÑ†Ïñ∏Î¨∏Ïóê @JobScope, @StepScopeÎ•º Ï†ïÏùòÌïòÏßÄ ÏïäÏúºÎ©¥ ÏòàÏô∏Í∞Ä Î∞úÏÉùÌïòÍ∏∞ ÎïåÎ¨∏Ïóê Î∞òÎìúÏãú ÏÑ†Ïñ∏Ìï¥Ïïº Ìï©ÎãàÎã§.

#### @JobScopeÎûÄ?

- Step ÏÑ†Ïñ∏Î¨∏Ïóê Ï†ïÏùòÌï©ÎãàÎã§.
- @Value: jobParameters, jobExecutionContextÎßå ÏÇ¨Ïö© Í∞ÄÎä•Ìï©ÎãàÎã§.

#### @StepScopeÎûÄ?

- TaskletÏù¥ÎÇò ItemReader, ItemProcessor, ItemWriter ÏÑ†Ïñ∏Î¨∏Ïóê Ï†ïÏùòÌï©ÎãàÎã§. 
- @Value: jobParameters, jobExecutionContext, stepExecutionContext ÏÇ¨Ïö© Í∞ÄÎä•Ìï©ÎãàÎã§.

#### ÏòàÏ†ú ÏΩîÎìú

```java
@Configuration
@RequiredArgsConstructor
public class FlowJobConfiguration {

    private final JobRepository jobRepository;
    private final PlatformTransactionManager manager;

    @Bean
    public Job job() {
        return new JobBuilder("job", jobRepository)
                .start(stepA(null))
                .next(stepB())
                .build();
    }

    @Bean
    @JobScope
    public Step stepA(@Value("#{jobParameters[message]}") String message) {
        return new StepBuilder("stepA", jobRepository)
                .tasklet((contribution, chunkContext) -> {
                    System.out.println("stepA execute and message = " + message);
                    return RepeatStatus.FINISHED;
                }, manager)
                .build();
    }

    @Bean
    public Step stepB() {
        return new StepBuilder("stepB", jobRepository)
                .tasklet(tasklet(null), manager)
                .build();
    }

    @Bean
    @StepScope
    public Tasklet tasklet(@Value("#{jobParameters[name]}") String name) {
        return (contribution, chunkContext) -> {
            System.out.println("stepA execute and name = " + name);
            return RepeatStatus.FINISHED;
        };
    }
}

@Component
@RequiredArgsConstructor
public class ProductScheduler {

    private final JobLauncher jobLauncher;
    private final JobRegistry jobRegistry;

    @Scheduled(cron = "0/5 * * * * *") // 5Ï¥àÎßàÎã§ Ïã§Ìñâ
    public void run() {
        try {
            var job = jobRegistry.getJob("job");
            var jobParam = new JobParametersBuilder()
                    .addString("message", "hello? spring batch 5!")
                    .addString("name", "KDG")
                    .addString("UUID", UUID.randomUUID().toString())
                    .toJobParameters();
            jobLauncher.run(job, jobParam);
        } catch (Exception e) {
            throw new RuntimeException(e);
        }
    }
}
```


<br>

#### Ï∞∏Í≥†

- https://jojoldu.tistory.com/330
- https://jojoldu.tistory.com/132
- https://gngsn.tistory.com/187


