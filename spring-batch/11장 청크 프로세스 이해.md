# 청크 프로세스 이해

<br>

## 1. 기본 개념

- 청크란 여러개의 데이터를 묶은 하나의 덩어리입니다.
- 일반적으로 대용량의 데이터를 한번에 처리하는게 아닌 청크 단위로 쪼개어 더 이상 처리할 데이터가 없을때까지 반복해서 작업합니다.

#### 과정

- ItemReader는 Chunk Size만큼 하나씩 데이터를 읽습니다.
- Chunk Size만큼 데이터가 다 차면 ItemProcessor로 데이터를 하나씩 보냅니다.
- ItemProcessor에서는 데이터를 하나씩 처리하게 되고, Chunk Size만큼 데이터가 다 가공되었다면 ItemWriter로 데이터를 한방에 보내게 됩니다.

![스크린샷 2024-09-11 오후 9 54 37](https://github.com/user-attachments/assets/4f57379e-9b67-4a9e-a31e-74af36335347)

<br>
<br>

## 2. ChunkOrientedTasklet란 무엇인가?

### 2-1. 기본 개념

- ChunkOrientedTasklet 클래스는 스프링 배치에서 제공하는 Tasklet의 구현체로서 Chunk 지향 프로세스를 담당하는 도메인 객체입니다.
- ItemReader, ItemProcessor, ItemWriter를 사용해 청크 기반 데이터 입출력 처리를 담당합니다.
- TaskletStep에 의해 반복적으로 수행되며, ChunkOrientedTasklet이 실행될 때마다 매번 새로운 트랜잭션이 생성되어 처리가 이루어 집니다.
- 트랜잭션 경계 내에서 예외가 발생할 경우 해당 청크는 롤백이 되고, 이전에 커밋한 청크는 커밋이 됩니다.

<br>

### 2-2. 실행 순서

1. Tasklet이 execute() 메서드를 통해 ChunkOrientedTasklet 클래스를 호출하게 됩니다.
2. ChunkOrientedTasklet 클래스는 provide() 메서드를 통해 ChunkProvider를 호출하게 됩니다.
3. ChunkProvider는 ItemReader에게 하나씩 데이터를 읽도록 지시합니다. 이 과정은 Chunk Size만큼 반복적으로 읽게 됩니다.
4. Chunk Size만큼 반복적으로 다 읽었다면 ChunkOrientedTasklet 클래스는 ChunkProcessor에게 읽어들인 데이터를 가공하라고 지시합니다.
5. ChunkProcessor 클래스는 ItemProcessor 클래스에게 읽어들인 데이터를 하나씩 가공하라고 지시합니다. ItemProcessor 클래스는 Chunk Size만큼 반복해서 데이터를 가공하게 됩니다.
6. ChunkProcessor 클래스는 가공한 데이터를 ItemWriter에게 Chunk Size만큼 가공된 데이터를 한번에 전달하게 됩니다.
7. ItemWriter 클래스는 전달받은 데이터로 쓰기 작업을 수행합니다.
8. 2 ~ 7번까지의 과정을 반복적으로 수행하게 되며, 해당 작업들은 트랜잭션의 경계 내에서 이루어지게 됩니다.

![스크린샷 2024-09-11 오후 10 12 12](https://github.com/user-attachments/assets/5a42a2ca-700c-48ed-8927-be332243bd60)



























<br>

#### 참고

- https://docs.spring.io/spring-batch/docs/5.0.x/reference/html/index-single.html#chunkOrientedProcessing


