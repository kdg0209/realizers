# ë°ì´í„° ë‹¤ë£¨ê¸°

<br>

## 1. ë‹¨ê±´ ë¬¸ì„œ API

### ìƒ‰ì¸ API

#### ì—¬ëŸ¬ ìƒ‰ì¸ APIë“¤

|ì¢…ë¥˜|ì„¤ëª…|
|------|------|
|PUT [ì¸ë±ìŠ¤ ì´ë¦„]/_doc/[_idê°’]|ê¸°ë³¸ì´ ë˜ëŠ” APIì…ë‹ˆë‹¤. ë§Œì•½ í•´ë‹¹ ì¸ë±ìŠ¤ì— ê°™ì€ idê°€ ìˆë‹¤ë©´ ìƒˆ ë¬¸ì„œë¡œ ë®ì–´ì”Œì›ë‹ˆë‹¤.|
|POST [ì¸ë±ìŠ¤ ì´ë¦„]/_doc|idê°’ì„ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ê°€ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.|
|PUT [ì¸ë±ìŠ¤ ì´ë¦„]/_create/[_idê°’]|í•­ìƒ ìƒˆ ë¬¸ì„œë¥¼ ìƒì„±í•˜ëŠ” ê²½ìš°ì—ë§Œ í—ˆìš©í•˜ê³ , ì´ë¯¸ ê°™ì€ idê°€ ìˆë‹¤ë©´ ì˜ˆì™¸ê°€ ë°œìƒí•©ë‹ˆë‹¤.|
|POST [ì¸ë±ìŠ¤ ì´ë¦„]/_create/[_idê°’]|í•­ìƒ ìƒˆ ë¬¸ì„œë¥¼ ìƒì„±í•˜ëŠ” ê²½ìš°ì—ë§Œ í—ˆìš©í•˜ê³ , ì´ë¯¸ ê°™ì€ idê°€ ìˆë‹¤ë©´ ì˜ˆì™¸ê°€ ë°œìƒí•©ë‹ˆë‹¤.|

#### ë¼ìš°íŒ…

- ìƒ‰ì¸ ì‹œ routing ë§¤ê°œë³€ìˆ˜ë¥¼ í†µí•´ ë¼ìš°íŒ… ê°’ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¼ìš°íŒ…ì„ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ _id ê°’ì˜ í•´ì‹œê°’ì„ ê¸°ë°˜ìœ¼ë¡œ ìƒ¤ë“œê°€ ë°°ì •ë©ë‹ˆë‹¤.

#### refresh

- ìƒ‰ì¸ ì‹œ refresh ë§¤ê°œë³€ìˆ˜ë¥¼ ì§€ì •í•˜ë©´ ë¬¸ì„œë¥¼ ìƒ‰ì¸í•œ ì§í›„ì— í•´ë‹¹ ìƒ¤ë“œë¥¼ refreshí•˜ê¸° ë•Œë¬¸ì— ì¦‰ì‹œ ê²€ìƒ‰ì´ ë˜ë„ë¡ í•©ë‹ˆë‹¤.
- trueë‚˜ wait_for ì„¤ì •ì€ ì„±ëŠ¥ì— ëŒ€í•œ ê³ ë ¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.(refresh ë¹„ìš©ì€ ë¹„ìŒ‰ë‹ˆë‹¤.)
- wait_forë¥¼ ì‚¬ìš©í•˜ë©´ index.refresh_interval ê°’ì˜ í¬ê¸°ë§Œí¼ ì‘ë‹µ ì‹œê°„ì´ ì§€ì—°ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ wait_forë¥¼ ì‚¬ìš©í•˜ë”ë¼ë„ ë„ˆë¬´ ë§ì€ ìš”ì²­ì´ ëŒ€ê¸° ì¤‘ì¸ ê²½ìš° ê°•ì œë¡œ refreshê°€ ìˆ˜í–‰ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. index.max_refresh_listeners ì„¤ì •ê°’ ì´ìƒì˜ ìš”ì²­ì´ refreshë¥¼ ëŒ€ê¸°í•˜ëŠ” ì¤‘ì´ë¼ë©´ ê°•ì œë¡œ refreshê°€ ìˆ˜í–‰ë©ë‹ˆë‹¤.
ê¸°ë³¸ê°’ì€ 1000ì¸ë° ì´ˆë‹¹ 1ì²œ ê°œ ì´ìƒì˜ ìƒ‰ì¸ ìš”ì²­ì´ wait_forë¡œ ë“¤ì–´ì˜¤ëŠ” ê²½ìš° ê°•ì œ refreshê°€ ìˆ˜í–‰ë©ë‹ˆë‹¤.

|refresh ê°’|ë™ì‘ ë°©ì‹|
|------|------|
|true|ìƒ‰ì¸ ì§í›„ ë¬¸ì„œê°€ ìƒ‰ì¸ëœ ìƒ¤ë“œë¥¼ refresh í•˜ê³  ì‘ë‹µì„ ë°˜í™˜í•©ë‹ˆë‹¤.|
|wait_for|ìƒ‰ì¸ ì´í›„ ë¬¸ì„œê°€ refreshë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦° í›„ ì‘ë‹µì„ ë°˜í™˜í•©ë‹ˆë‹¤.|
|false|ì•„ë¬´ ê°’ë„ ì§€ì •í•˜ì§€ ì•Šì•˜ì„ ë•Œì˜ ê¸°ë³¸ê°’ì…ë‹ˆë‹¤. refreshì™€ ê´€ë ¨ëœ ë™ì‘ì„ ìˆ˜í–‰í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.|

<br>

### ì¡°íšŒ API

- ì¡°íšŒ APIëŠ” ë¬¸ì„œ ë‹¨ê±´ì„ ì¡°íšŒí•©ë‹ˆë‹¤. ë˜í•œ ì¡°íšŒëŠ” ê²€ìƒ‰ê³¼ ë‹¤ë¥´ê²Œ ìƒ‰ì¸ì´ refresh ë˜ì§€ ì•Šì€ ìƒíƒœì—ì„œë„ ë³€ê²½ëœ ë‚´ìš©ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- _doc ëª…ë ¹ì–´ë¥¼ ì´ìš©í•˜ë©´ ê¸°ë³¸ì ì¸ ë©”íƒ€ë°ì´í„°ë¥¼ í•¨ê»˜ ì¡°íšŒí•  ìˆ˜ ìˆìœ¼ë©°, _source ëª…ë ¹ì–´ë¥¼ ì´ìš©í•˜ë©´ ë©”íƒ€ë°ì´í„° ì—†ì´ ë³¸ë¬¸ ë‚´ìš©ë§Œ ê²€ìƒ‰ë©ë‹ˆë‹¤.

```json
> _doc ëª…ë ¹ì–´ë¥¼ í†µí•´ ì¡°íšŒ
GET routing_test2/_doc/1?routing=my1
{
  "_index": "routing_test2",
  "_id": "1",
  "_version": 2,
  "_seq_no": 1,
  "_primary_term": 1,
  "_routing": "my1",
  "found": true,
  "_source": {
    "login_id": "myid 1",
    "comment": "hello1~",
    "created_date": "2024-07-26T15:25:30"
  }
}

> _source ëª…ë ¹ì–´ë¥¼ í†µí•´ ì¡°íšŒ
GET routing_test2/_source/1?routing=my1
{
  "login_id": "myid 1",
  "comment": "hello1~",
  "created_date": "2024-07-26T15:25:30"
}
```

<br>

### ì—…ë°ì´íŠ¸ API

#### docì— ë‚´ìš©ì„ ì§ì ‘ ê¸°ìˆ í•˜ì—¬ ì—…ë°ì´íŠ¸

- ì—…ë°ì´íŠ¸ í›„ ì¡°íšŒë¥¼ í•´ë³´ë©´ resultê°€ updatedì¸ ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œ ë˜‘ê°™ì€ ë‚´ìš©ìœ¼ë¡œ í•œë²ˆ ë” ì—…ë°ì´íŠ¸ë¥¼ í•˜ê²Œëœë‹¤ë©´ resultëŠ” noopì´ ë©ë‹ˆë‹¤.

```json
> _update ëª…ë ¹ì–´ë¥¼ í†µí•´ ì—…ë°ì´íŠ¸
POST routing_test2/_update/1?routing=my1
{
  "doc": {
    "login_id": "myid 3",
    "comment": "hello1~"
  }
}

> ì—…ë°ì´íŠ¸ ì‘ë‹µê°’
{
  "_index": "routing_test2",
  "_id": "1",
  "_version": 5,
  "result": "updated", // or noop
  "_shards": {
    "total": 2,
    "successful": 1,
    "failed": 0
  },
  "_seq_no": 4,
  "_primary_term": 1
}
```

#### ğŸ’¡ noopì€ ë¬´ì—‡ì„ ì˜ë¯¸í• ê¹Œ?

- noopì€ ë¬¸ì„œì˜ ë‚´ìš©ì„ ë³€ê²½í•˜ì§€ ì•ŠëŠ”ê²ƒì…ë‹ˆë‹¤.
- noopì„ ê²€ì‚¬í•˜ëŠ” ê²ƒì€ ë¶ˆí•„ìš”í•œ ë””ìŠ¤í¬ I/Oë¥¼ ì¤„ì¼ ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” ì„±ëŠ¥ì— í° ì˜í–¥ì„ ë¯¸ì¹˜ê³  ê¸°ë³¸ì ìœ¼ë¡œ noop ê²€ì‚¬ëŠ” í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

#### doc_as_upsert

- ì—…ë°ì´íŠ¸ APIëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ê¸°ì¡´ ë¬¸ì„œì˜ ë‚´ìš©ì„ ì½ì–´ë“¤ì¸ í›„ ì—…ë°ì´íŠ¸ë¥¼ ìˆ˜í–‰í•˜ëŠ”ë°, ë§Œì•½ ê¸°ì¡´ ë¬¸ì„œê°€ ì—†ë‹¤ë©´ ì˜ˆì™¸ê°€ ë°œìƒí•©ë‹ˆë‹¤. ë”°ë¼ì„œ ì˜µì…˜ì„ í†µí•´ ê¸°ì¡´ ë¬¸ì„œê°€ ì—†ë‹¤ë©´ insert ë˜ë„ë¡ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```json
POST routing_test2/_update/2?routing=my1
{
  "doc": {
    "login_id": "myid 4",
    "comment": "hello1~"
  },
  "doc_as_upsert": true
}
```

#### scriptë¥¼ ì´ìš©í•˜ì—¬ ì—…ë°ì´íŠ¸

- ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ì—ì„œ ìŠ¤í¬ë¦½íŠ¸ ì–¸ì–´ëŠ” painlessë¥¼ ì´ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.
- ctx._source ë³€ìˆ˜ë¥¼ í†µí•´ ë¬¸ì„œì˜ _sourceë¥¼ Map í˜•íƒœë¡œ ë°˜í™˜ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```json
> ë¬¸ì„œ ìƒ‰ì¸3
PUT update_script_test/_doc/1
{
  "title": "hello",
  "views": 1
}

> scriptë¥¼ ì‚¬ìš©í•˜ì—¬ ì—…ë°ì´íŠ¸
POST update_script_test/_update/1
{
  "script": {
    "source": "ctx._source.views += params.count",
    "lang": "painless",
    "params": {
      "count": 1
    }
  }, 
  "doc_as_upsert": false
}
```

<br>

### ì‚­ì œ API

- ì‚­ì œëŠ” ì•„ë˜ ëª…ë ¹ì–´ ê¸°ë°˜ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°, ë§Œì•½ ì¸ë±ìŠ¤ ì´ë¦„ë§Œ ì„ ì–¸í•˜ë©´ ì¸ë±ìŠ¤ ì „ì²´ê°€ ì‚­ì œë˜ë¯€ë¡œ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.

```text
DELETE [ì¸ë±ìŠ¤ ì´ë¦„]/_doc/[id ê°’] // ì¸ë±ìŠ¤ì˜ íŠ¹ì • ë¬¸ì„œ ì‚­ì œ
DELETE [ì¸ë±ìŠ¤ ì´ë¦„] // ì¸ë±ìŠ¤ ì‚­ì œ
```

<br>

## 2. ë³µìˆ˜ ë¬¸ì„œ API

### bulk API

- bulk APIëŠ” ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ì˜ ë‹¤ë¥¸ APIì™€ëŠ” ë‹¤ë¥´ê²Œ ìš”ì²­ ë³¸ë¬¸ ë‚´ìš©ì„ JSONì´ ì•„ë‹Œ NDJSON í˜•íƒœë¡œ ë§Œë“¤ì–´ ë³´ëƒ…ë‹ˆë‹¤.

#### bulk APIì˜ ì‘ì—… ìˆœì„œ

- bulk APIì— ê¸°ìˆ ëœ ì‘ì—…ì€ ë°˜ë“œì‹œ ê·¸ ìˆœì„œëŒ€ë¡œ ìˆ˜í–‰ëœë‹¤ëŠ” ë³´ì¥ì´ ì—†ìŠµë‹ˆë‹¤. ì¡°ì • ì—­í• ì„ í•˜ëŠ” ë…¸ë“œê°€ ìš”ì²­ì„ ìˆ˜ì‹ í•˜ë©´ ê° ìš”ì²­ì˜ ë‚´ìš©ì„ ë³´ê³  ì ì ˆí•œ ì£¼ ìƒ¤ë“œë¡œ ìš”ì²­ì„ ë„˜ê²¨ì¤ë‹ˆë‹¤.
- ì—¬ëŸ¬ ê°œì˜ ì£¼ ìƒ¤ë“œì— ë„˜ì–´ê°„ ê° ìš”ì²­ì€ ê°ì ë…ìì ìœ¼ë¡œ ìˆ˜í–‰ë©ë‹ˆë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ê° ìˆœì„œëŠ” ë³´ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- ê·¸ëŸ¬ë‚˜ ë™ì¼í•œ ì¸ë±ìŠ¤, _id, ë¼ìš°íŒ… ì¡°í•©ì„ ê°€ì§„ ìš”ì²­ì€ ë°˜ë“œì‹œ ë™ì¼í•œ ì£¼ ìƒ¤ë“œë¡œ ë„˜ì–´ê°€ê¸° ë•Œë¬¸ì— ë™ì¼í•œ ë¬¸ì„œì— ëŒ€í•œ ìš”ì²­ì€ ìˆœì„œëŒ€ë¡œ ë™ì‘í•˜ê²Œ ë©ë‹ˆë‹¤.

<br>

### multi get API

- multi get APIëŠ” _idë¥¼ ì—¬ëŸ¿ ì§€ì •í•˜ì—¬ í•´ë‹¹ ë¬¸ì„œë¥¼ í•œ ë²ˆì— ì¡°íšŒí•˜ëŠ” APIì…ë‹ˆë‹¤.

```json
> _mget ëª…ë ¹ì–´ë¥¼ í†µí•´ ì—¬ëŸ¬ ê±´ ì¡°íšŒ
GET _mget
{
  "docs": [
    {
      "_index": "movie",
      "_id": 1
    },
    {
      "_index": "movie",
      "_id": 4
    },
    {
      "_index": "movie",
      "_id": 5,
      "_source": {
        "include": ["title", "views"]
      }
    }
  ]
}

> ì‘ë‹µê°’
{
  "docs": [
    {
      "_index": "movie",
      "_id": "1",
      "_version": 2,
      "_seq_no": 3,
      "_primary_term": 1,
      "found": true,
      "_source": {
        "title": "test",
        "views": 1234,
        "public": true,
        "created": "2024-07-24T16:26:30"
      }
    },
    {
      "_index": "movie",
      "_id": "4",
      "_version": 1,
      "_seq_no": 8,
      "_primary_term": 2,
      "found": true,
      "_source": {
        "title": "ì§‘ê°€ê³  ì‹¶ì–´",
        "views": 20,
        "public": true,
        "created": "2024-07-25T16:27:30"
      }
    },
    {
      "_index": "movie",
      "_id": "5",
      "_version": 1,
      "_seq_no": 9,
      "_primary_term": 2,
      "found": true,
      "_source": {
        "title": "ì§‘ì— ì–¸ì œê°ˆê¹Œ?f=",
        "views": 25
      }
    }
  ]
}
```

<br>

### update by query

- ê²€ìƒ‰ ì¿¼ë¦¬ë¥¼ í†µí•´ ì£¼ì–´ì§„ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ë¬¸ì„œë¥¼ ì°¾ì€ ë’¤ ê·¸ ë¬¸ì„œë¥¼ ëŒ€ìƒìœ¼ë¡œ ì—…ë°ì´íŠ¸ë‚˜ ì‚­ì œ ì‘ì—…ì„ ì‹¤ì‹œí•˜ëŠ” APIì…ë‹ˆë‹¤.
- ì—¬ëŸ¬ ë¬¸ì„œì˜ ì—…ë°ì´íŠ¸ê°€ ìˆœì°¨ì ìœ¼ë¡œ ì§„í–‰ë˜ëŠ” ë„ì¤‘ ë‹¤ë¥¸ ì‘ì—…ìœ¼ë¡œ ì¸í•´ ë¬¸ì„œì— ë³€ê²½ì´ ìƒê¸¸ ìˆ˜ ìˆëŠ”ë°, ì´ë•Œ update by queryëŠ” ìŠ¤ëƒ…ìƒ·ì„ ì°ì–´ ë’€ë˜ ë¬¸ì„œì— ë³€í™”ê°€ ìƒê¸´ ë¬¸ì„œë¥¼ ë°œê²¬í•˜ë©´ ì—…ë°ì´íŠ¸í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- ë³€í™”ëœ ë¬¸ì„œë¥¼ ë°œê²¬í•˜ë©´ ì „ì²´ ì‘ì—…ì„ í•´ë‹¹ ì§€ì ì—ì„œ ê·¸ë§Œë‘˜ ìˆ˜ë„ ìˆê³  ë‹¤ìŒ ì‘ì—…ìœ¼ë¡œ ë„˜ì–´ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.(abort: ì¶©ëŒì‹œ ì‘ì—… ì¤‘ë‹¨, proceed: ë‹¤ìŒ ì‘ì—…ìœ¼ë¡œ ë„˜ê¹€), ì•„ë¬´íŠ¼ ì¶©ëŒì´ ë°œìƒí•´ì„œ ì‘ì—…ì´ ì¤‘ë‹¨ë˜ë©´ ê·¸ë•Œê¹Œì§€ ë³€ê²½ëœ ë‚´ìš©ì€ ë¡¤ë°±ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

#### ìŠ¤ë¡œí‹€ë§

- update by queryëŠ” ê´€ë¦¬ì ì¸ ëª©ì ìœ¼ë¡œ ìˆ˜í–‰ë˜ëŠ” ê²½ìš°ê°€ ë§ì€ë°, ë¬¸ì œê°€ ìƒê¸´ ë°ì´í„°ë¥¼ ì¼ê´„ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê±°ë‚˜ ë³€ê²½ëœ ë¹„ì§€ë‹ˆìŠ¤ ìš”ê±´ì— ë§ê²Œ ë°ì´í„°ë¥¼ ì¼ê´„ ìˆ˜ì •í•˜ëŠ” ì‘ì—… ë“±ì— ë§ì´ í™œìš©ë©ë‹ˆë‹¤. ì´ë•Œ ëŒ€ëŸ‰ì˜ ì‘ì—…ì„ ìš´ì˜ì¤‘ì¸ ì„œë¹„ìŠ¤ì— í•˜ê²Œë˜ë©´ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ìŠ¤ë¡œí‹€ë§ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- update by queryëŠ” ì—…ë°ì´íŠ¸ ì „ ë¨¼ì € ê²€ìƒ‰ì„ ìˆ˜í–‰í•˜ëŠ”ë°, ê²€ìƒ‰ ê°¯ìˆ˜ëŠ” scroll_sizeë¡œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.(1000ê±´ì”© ê²€ìƒ‰ í›„ ì—…ë°ì´íŠ¸)
- update by queryëŠ” ì²˜ìŒ ê²€ìƒ‰ì„ ìˆ˜í–‰í•˜ë©´ ìŠ¤ëƒ…ìƒ·ì„ ì°ëŠ”ë°, ìŠ¤ëƒ…ìƒ·ì„ search contextì— ë³´ì¡´í•˜ëŠ” ì‹œê°„ì…ë‹ˆë‹¤. 1mì€ 1ë¶„ì´ë©° ì´ ì‹œê°„ì€ ëª¨ë“  ë°°ì¹˜ ì‘ì—…ì´ ëë‚˜ëŠ” ì‹œê°„ì´ ì•„ë‹ˆë¼ í•˜ë‚˜ì˜ ë°°ì¹˜ ì‘ì—…ì— í•„ìš”í•œ ì‹œê°„ì„ ì§€ì •í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
- requests_per_secondsëŠ” í‰ê· ì ìœ¼ë¡œ ì´ˆë‹¹ ëª‡ ê°œê¹Œì§€ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•  ê²ƒì¸ì§€ ì§€ì •í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

```text
POST [ì¸ë±ìŠ¤ ì´ë¦„]/_update_by_query?scroll_size=1000&scroll=1m&requests_per_seconds=500
{
   // ...
}
```

<br>

### delete by query

- delete by query ë˜í•œ ê²€ìƒ‰ ì¿¼ë¦¬ë¥¼ í†µí•´ ì‚­ì œí•  ëŒ€ìƒì„ ì§€ì •í•œ ë’¤ì— ì‚­ì œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
- delete by queryëŠ” ì˜¤ë˜ëœ ë°ì´í„° ë“± ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ë°ì´í„°ë¥¼ ì‚­ì œí•˜ëŠ” ê²½ìš°ì— ë§ì´ ì‚¬ìš©ë©ë‹ˆë‹¤.

<br>

## 3. ê²€ìƒ‰ API

#### í…ŒìŠ¤íŠ¸ ë°ì´í„° ì„¤ì •

- ì•„ë˜ëŠ” ê²€ìƒ‰ì„ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•œ ê°„ë‹¨í•œ ë°ì´í„°ì…ë‹ˆë‹¤.

```json
PUT /movie
{
  "settings": {
    "number_of_shards": 1,
    "number_of_replicas": 1
  },
  "mappings": {
    "properties": {
      "titleText": {
        "type": "text"
      },
      "titleKeyword": {
        "type": "keyword"
      },
      "views": {
        "type": "integer"
      },
      "public": {
        "type": "boolean"
      },
      "created": {
        "type": "date"
      }
    }
  }
}

POST movie/_doc/1
{
  "titleText": "íˆ¬ì¸í”Œë ˆì´ìŠ¤ í…ìŠ¤íŠ¸",
  "titleKeyword": "íˆ¬ì¸í”Œë ˆì´ìŠ¤ í‚¤ì›Œë“œ",
  "views": 11,
  "public": true,
  "created": "2024-07-27T16:27:30"
}

POST movie/_doc/2
{
  "titleText": "ìŠ¤íƒ€ë²…ìŠ¤ í…ìŠ¤íŠ¸",
  "titleKeyword": "ìŠ¤íƒ€ë²…ìŠ¤ í‚¤ì›Œë“œ",
  "views": 25,
  "public": true,
  "created": "2024-07-28T16:27:30"
}

POST movie/_doc/3
{
  "titleText": "ì´ë””ì•„ í…ìŠ¤íŠ¸",
  "titleKeyword": "ì´ë””ì•„ í‚¤ì›Œë“œ",
  "views": 35,
  "public": false,
  "created": "2024-07-29T16:27:30"
}
```

#### match_all query

- match_all ì¿¼ë¦¬ëŠ” ëª¨ë“  ë¬¸ì„œë¥¼ ë§¤ì¹˜í•˜ëŠ” ì¿¼ë¦¬ì…ë‹ˆë‹¤.

#### match query

- match ì¿¼ë¦¬ëŠ” ì§€ì •í•œ í•„ë“œì˜ ë‚´ìš©ì´ ì§ˆì˜ì–´ì™€ ë§¤ì¹˜ë˜ëŠ” ë¬¸ì„œë¥¼ ì°¾ìŠµë‹ˆë‹¤. í•„ë“œê°€ text íƒ€ì…ì´ë¼ë©´ í•„ë“œì˜ ê°’ë„ ì§ˆì˜ì–´ë„ ëª¨ë‘ ì• ë„ë¼ì´ì €ë¡œ ë¶„ì„ë©ë‹ˆë‹¤.
- ê¸°ë³¸ì ìœ¼ë¡œ OR ì¡°ê±´ìœ¼ë¡œ ê²€ìƒ‰ë˜ë©°, operatorë¥¼ andë¡œ ì§€ì •í•˜ë©´ ëª¨ë“  í…€ì´ ë§¤ì¹˜ëœ ë¬¸ì„œë§Œ ê²€ìƒ‰ê°€ëŠ¥í•©ë‹ˆë‹¤.

```json
> ê²€ìƒ‰ 1 [ê²€ìƒ‰ ê²°ê³¼ 3ê°œ]
GET movie/_search
{
  "query": {
    "match": {
      "titleText": {
        "query": "í…ìŠ¤íŠ¸",
      }
    }
  }
}

> ê²€ìƒ‰ 2 [ê²€ìƒ‰ ê²°ê³¼ 1ê°œ]
GET movie/_search
{
  "query": {
    "match": {
      "titleText": {
        "query": "íˆ¬ì¸í”Œë ˆì´ìŠ¤ í…ìŠ¤íŠ¸",
        "operator": "and"
      }
    }
  }
}
```

#### term query

- term ì¿¼ë¦¬ëŠ” ì§€ì •í•œ í•„ë“œì˜ ê°’ì´ ì§ˆì˜ì–´ì™€ ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ë¬¸ì„œë¥¼ ì°¾ëŠ” ì¿¼ë¦¬ì…ë‹ˆë‹¤.
- ëŒ€ìƒ í•„ë“œì— ë…¸ë©€ë¼ì´ì €ê°€ ì§€ì •ë¼ ìˆë‹¤ë©´ ì§ˆì˜ì–´ë„ ë…¸ë©€ë¼ì´ì € ì²˜ë¦¬ë¥¼ ê±°ì¹©ë‹ˆë‹¤. keyword íƒ€ì…ê³¼ ì˜ ë§ìŠµë‹ˆë‹¤.
- text íƒ€ì…ì— term ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ ì§ˆì˜ì–´ëŠ” ë…¸ë©€ë¼ì´ì € ì²˜ë¦¬ë¥¼ ê±°ì¹˜ì§€ë§Œ í•„ë“œì˜ ê°’ì€ ì• ë„ë¼ì´ì €ë¡œ ë¶„ì„í•œ ë’¤ ìƒì„±ëœ ì—­ìƒ‰ì¸ì„ ì´ìš©ë©ë‹ˆë‹¤.

#### terms query

- terms ì¿¼ë¦¬ëŠ” term ì¿¼ë¦¬ì™€ ë§¤ìš° ìœ ì‚¬í•©ë‹ˆë‹¤. ì§€ì •í•  í•„ë“œì˜ ê°’ì´ ì§ˆì˜ì–´ì™€ ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ë¬¸ì„œë¥¼ ì°¾ëŠ” ì¿¼ë¦¬ì…ë‹ˆë‹¤. ëŒ€ì‹  ì§ˆì˜ì–´ë¥¼ ì—¬ëŸ¬ê°œ ì§€ì •í•  ìˆ˜ ìˆìœ¼ë©°, í•˜ë‚˜ ì´ìƒì˜ ì§ˆì˜ì–´ê°€ ì¼ì¹˜í•œë‹¤ë©´ ê²€ìƒ‰ ê²°ê³¼ì— í¬í•¨ë©ë‹ˆë‹¤.

```json
GET movie/_search
{
  "query": {
    "terms": {
      "titleKeyword": ["í…ìŠ¤íŠ¸", "íˆ¬ì¸í”Œë ˆì´ìŠ¤"]
    }
  }
}

> ì‘ë‹µê°’
"hits": [
  {
    "_index": "movie",
    "_id": "1",
    "_score": 1,
    "_source": {
      "titleText": "íˆ¬ì¸í”Œë ˆì´ìŠ¤ í…ìŠ¤íŠ¸",
      "titleKeyword": "íˆ¬ì¸í”Œë ˆì´ìŠ¤ í‚¤ì›Œë“œ",
      "views": 11,
      "public": true,
      "created": "2024-07-27T16:27:30"
    }
  }
]
```

<br>

#### range query

- range ì¿¼ë¦¬ëŠ” í•„ë“œ ê°’ì´ íŠ¹ì • ë²”ìœ„ ë‚´ì— ìˆëŠ” ë¬¸ì„œë¥¼ ì°¾ëŠ” ì¿¼ë¦¬ì…ë‹ˆë‹¤.

#### prefix query

- prefix ì¿¼ë¦¬ëŠ” í•„ë“œì˜ ê°’ì´ ì§€ì •í•œ ì§ˆì˜ì–´ë¡œ ì‹œì‘í•˜ëŠ” ë¬¸ì„œë¥¼ ì°¾ëŠ” ì¿¼ë¦¬ì…ë‹ˆë‹¤.
- prefix ì¿¼ë¦¬ëŠ” ë¬´ê±°ìš´ ì¿¼ë¦¬ë¡œ ë¶„ë¥˜ë˜ê¸° ë•Œë¬¸ì— ìì œí•´ì•¼ í•©ë‹ˆë‹¤.

#### exists query

- exists ì¿¼ë¦¬ëŠ” ì§€ì •í•œ í•„ë“œë¥¼ í¬í•¨í•˜ëŠ” ë¬¸ì„œë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤.

#### bool query

- bool ì¿¼ë¦¬ëŠ” ì—¬ëŸ¬ ì¿¼ë¦¬ë¥¼ ì¡°í•©í•´ì„œ ê²€ìƒ‰í•˜ëŠ” ì¿¼ë¦¬ì…ë‹ˆë‹¤.
- must, must_not, filter, shouldì˜ 4ê°€ì§€ ì¢…ë¥˜ì˜ ì¡°ê±´ì ˆì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### ğŸ’¡ ì¿¼ë¦¬ ë¬¸ë§¥ê³¼ í•„í„° ë¬¸ë§¥

- mustì™€ filterëŠ” ëª¨ë‘ AND ì¡°ê±´ì„ ìˆ˜í–‰í•˜ì§€ë§Œ ì ìˆ˜ë¥¼ ê³„ì‚°í•˜ëŠëƒ ì—¬ë¶€ê°€ ë‹¤ë¦…ë‹ˆë‹¤. filter ì¡°ê±´ì€ ë‹¨ìˆœíˆ ë¬¸ì„œì˜ ë§¤ì¹˜ ì—¬ë¶€ë§Œì„ íŒë‹¨í•˜ê³  ë­í‚¹ì— ì‚¬ìš©í•  ì ìˆ˜ë¥¼ ë§¤ê¸°ì§€ ì•ŠìŠµë‹ˆë‹¤. must_notë„ ì ìˆ˜ë¥¼ ë§¤ê°œì§€ ì•ŠìŠµë‹ˆë‹¤.
- ë¬¸ì„œê°€ ì£¼ì–´ì§„ ê²€ìƒ‰ ì¡°ê±´ì„ ì–¼ë§ˆë‚˜ ë” ì˜ ë§Œì¡±í•˜ëŠ”ì§€ì™€ ìœ ì‚¬ë„ ì ìˆ˜ë¥¼ ë§¤ê¸°ëŠ” ê²€ìƒ‰ ê³¼ì •ì€ ì¿¼ë¦¬ ë¬¸ë§¥ì´ë¼ í•©ë‹ˆë‹¤.

||ì¿¼ë¦¬ ë¬¸ë§¥|í•„í„° ë¬¸ë§¥|
|------|------|------|
|ì§ˆì˜ ê°œë…|ë¬¸ì„œê°€ ì§ˆì˜ì–´ì™€ ì–¼ë§ˆë‚˜ ì˜ ë§¤ì¹˜ë˜ëŠ”ê°€|ì§ˆì˜ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ”ê°€|
|ì ìˆ˜|ê³„ì‚°í•¨|ê³„ì‚°í•˜ì§€ ì•ŠìŒ|
|ì„±ëŠ¥|ìƒëŒ€ì ìœ¼ë¡œ ëŠë¦¼|ìƒëŒ€ì ìœ¼ë¡œ ë¹ ë¦„|
|ìºì‹œ|ì¿¼ë¦¬ ìºì‹œ ì‚¬ìš©ë¶ˆê°€|ì¿¼ë¦¬ ìºì‹œ í™œìš© ê°€ëŠ¥|
|ì¢…ë¥˜|boolì˜ (must, should), match, term ë“±|boolì˜ (filter, must_not), exists, range, constant_score ë“±|

<br>

#### ğŸ’¡ ì¿¼ë¦¬ ì‹¤í–‰ ìˆœì„œ

- bool ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´ must, filter, should, must_notì„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”ë° ë­ê°€ ë¨¼ì € ìˆ˜í–‰ë ê¹Œ?
- ë¨¼ì € ìˆ˜í–‰ëœë‹¤ëŠ” ê·œì¹™ì€ ì—†ìœ¼ë©°, ìš”ì²­ì˜ ìœ„ ìª½ì— ì„ ì–¸í•˜ë”ëŸ¬ë„ ìˆœì„œëŒ€ë¡œ ìˆ˜í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ëŠ” ê²€ìƒ‰ ìš”ì²­ì„ ë°›ìœ¼ë©´ ë‚´ë¶€ì ìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ë£¨ì”¬ì˜ ì—¬ëŸ¬ ì¿¼ë¦¬ë¡œ ìª¼ê°  ë’¤ ì¡°í•©í•´ì„œ ì¬ì‘ì„±í•©ë‹ˆë‹¤. ê·¸ ë’¤ì— ìª¼ê°œì§„ ê° ì¿¼ë¦¬ë¥¼ ìˆ˜í–‰í•  ê²½ìš° ë¹„ìš©ì´ ì–¼ë§ˆë‚˜ ì†Œëª¨ë˜ëŠ”ì§€ ë‚´ë¶€ì ìœ¼ë¡œ ì¶”ì •í•˜ë©°, ì´ ë¹„ìš© ì¶”ì ì—ëŠ” ì—­ìƒ‰ì¸ì— ì €ì¥í•´ë‘” ì •ë³´ë‚˜ í†µê³„ ì •ë³´ë¥¼ í™œìš©í•©ë‹ˆë‹¤.

#### constant_score query

- constant_score ì¿¼ë¦¬ëŠ” í•˜ìœ„ í•„í„° ë¶€ë¶„ì— ì§€ì •í•œ ì¿¼ë¦¬ë¥¼ í•„í„° ë¬¸ë§¥ì—ì„œ ê²€ìƒ‰í•˜ëŠ” ì¿¼ë¦¬ì…ë‹ˆë‹¤.

#### explain query

- explain ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´ ê²€ìƒ‰ì„ ìˆ˜í–‰í•˜ëŠ” ë™ì•ˆ ì¿¼ë¦¬ì˜ ê° í•˜ìœ„ ë¶€ë¶„ì—ì„œ ì ìˆ˜ê°€ ì–´ë–»ê²Œ ê³„ì‚°ë˜ëŠ”ì§€ ì„¤ëª…í•´ì¤ë‹ˆë‹¤.

#### ê²€ìƒ‰ ê²°ê³¼ ì •ë ¬ 

- ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ì˜ í•„ë“œ íƒ€ì… ì¤‘ì—ëŠ” ì •ë ¬í•  ìˆ˜ ìˆëŠ” íƒ€ì…ê³¼ ë¶ˆê°€ëŠ¥í•œ íƒ€ì…ì´ ìˆìŠµë‹ˆë‹¤.
- ìˆ«ì, ë‚ ì§œ, boolean, keyword íƒ€ì…ì€ ì •ë ¬ì˜ ëŒ€ìƒì´ ë  ìˆ˜ ìˆì§€ë§Œ text íƒ€ì…ì€ ì •ë ¬ ëŒ€ìƒì´ ë  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
- _scoreë¡œë„ ì •ë ¬í•  ìˆ˜ ìˆëŠ”ë° _scoreëŠ” ê²€ìƒ‰ì„ í†µí•´ ê³„ì‚°ëœ ìœ ì‚¬ë„ ì ìˆ˜ë¡œ ì •ë ¬í•©ë‹ˆë‹¤.
- _docì€ ë¬¸ì„œ ë²ˆí˜¸ë¡œ ì •ë ¬í•©ë‹ˆë‹¤. ê²€ìƒ‰ ê²°ê³¼ê°€ ì–´ë–¤ ìˆœì„œë¡œ ì •ë ¬ë˜ì–´ë„ ìƒê´€ì—†ë‹¤ë©´ _doc ë‹¨ë… ì •ë ¬ì´ ì„±ëŠ¥ìƒ ì¢‹ìŠµë‹ˆë‹¤.

#### í˜ì´ì§€ë„¤ì´ì…˜

fromê³¼ size

- fromê³¼ sizeëŠ” ê¸°ë³¸ì ì¸ ë°©ë²•ì´ì§€ë§Œ mysqlì˜ offset, limitì™€ ê°™ì´ í˜ì´ì§€ ë’¤ë¡œê°ˆìˆ˜ë¡ ì„±ëŠ¥ ë¬¸ì œê°€ ë°œìƒí•©ë‹ˆë‹¤. ê·¸ ì´ìœ ëŠ” ë’¤ë¡œê°ˆìˆ˜ë¡ ì•ì—ê¹Œì§€ ì¡°íšŒí•œ ë°ì´í„°ëŠ” ì‚¬ì‹¤ìƒ í•„ìš”ì—†ëŠ” ë°ì´í„°ì´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì´ë•Œ CPUì™€ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ì¦ê°€í•˜ê²Œ ë©ë‹ˆë‹¤.

scroll

- scrollì€ ê²€ìƒ‰ ì¡°ê±´ì— ë§¤ì¹­ë˜ëŠ” ì „ì²´ ë¬¸ì„œë¥¼ ëª¨ë‘ ìˆœíšŒí•´ì•¼í•  ë•Œ ì í•©í•œ ë°©ë²•ì…ë‹ˆë‹¤.
- ìŠ¤í¬ë¡¤ì„ ìˆœíšŒí•˜ëŠ” ë™ì•ˆ ìµœì´ˆ ê²€ìƒ‰ ì‹œì˜ ë¬¸ë§¥ì´ ìœ ì§€ë©ë‹ˆë‹¤. ê·¸ë˜ì„œ ë„ì¤‘ì— ë¬¸ì„œê°€ ì‚½ì…ë˜ì–´ë„ ìˆœì„œê°€ ë’¤í‹€ë¦¬ì§€ ì•ŠìŠµë‹ˆë‹¤.

search_after

- í˜ì´ì§€ë„¤ì´ì…˜ì„ ì œê³µí•˜ëŠ” ìš©ë„ë¼ë©´ search_afterë¥¼ ì‚¬ìš©í•˜ëŠ”ê²Œ ì í•©í•©ë‹ˆë‹¤. search_afterì—ëŠ” sortë¥¼ ì§€ì •í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤.
- search_afterëŠ” ì´ì „ ê²€ìƒ‰ ìš”ì²­ì˜ ë§ˆì§€ë§‰ hitì—ì„œ tie-breakerë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
- ì•„ë˜ _idê°€ 2ì¸ ë¬¸ì„œì˜ sort ê°’ìœ¼ë¡œ search_afterë¥¼ ì‚¬ìš©í–ˆëŠ”ë°, ì´ë•Œ createdê°€ ì˜¤ë¦„ì°¨ìˆœìœ¼ë¡œ ê²€ìƒ‰ì„ ìš”ì²­í•˜ì˜€ìŠµë‹ˆë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— _idê°€ 3ì¸ ë¬¸ì„œê°€ ê²€ìƒ‰ëœ ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ë˜í•œ í˜„ì¬ì‹œê°„ì„ íƒ€ì„ìŠ¤íƒ¬í”„ë¡œ ë³€í™˜í•˜ì—¬ ë°”ë¡œ ë„˜ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```json
> ê²€ìƒ‰ ìš”ì²­ê°’
GET movie/_search
{
  "query": {
    "match": {
      "titleText": {
        "query": "í…ìŠ¤íŠ¸",
        "operator": "and"
      }
    }
  },
  "sort": [
    {
      "created": {
        "order": "desc"
      }
    }
  ]
}

> ê²€ìƒ‰ ì‘ë‹µê°’
{
  "took": 1,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 3,
      "relation": "eq"
    },
    "max_score": null,
    "hits": [
      {
        "_index": "movie",
        "_id": "3",
        "_score": null,
        "_source": {
          "titleText": "ì´ë””ì•„ í…ìŠ¤íŠ¸",
          "titleKeyword": "ì´ë””ì•„ í‚¤ì›Œë“œ",
          "prefixField": "ë‚˜ëŠ” ê¹€ë™ê· ",
          "views": 35,
          "public": false,
          "created": "2024-07-29T16:27:30"
        },
        "sort": [
          1722270450000 // ì£¼ëª©
        ]
      },
      {
        "_index": "movie",
        "_id": "2",
        "_score": null,
        "_source": {
          "titleText": "ìŠ¤íƒ€ë²…ìŠ¤ í…ìŠ¤íŠ¸",
          "titleKeyword": "ìŠ¤íƒ€ë²…ìŠ¤ í‚¤ì›Œë“œ",
          "prefixField": "ë‚˜ëŠ” ì´ìˆœì‹ ",
          "views": 25,
          "public": true,
          "created": "2024-07-28T16:27:30"
        },
        "sort": [ 
          1722184050000 // ì£¼ëª©
        ]
      },
      {
        "_index": "movie",
        "_id": "1",
        "_score": null,
        "_source": {
          "titleText": "íˆ¬ì¸í”Œë ˆì´ìŠ¤ í…ìŠ¤íŠ¸",
          "titleKeyword": "íˆ¬ì¸í”Œë ˆì´ìŠ¤ í‚¤ì›Œë“œ",
          "views": 11,
          "public": true,
          "created": "2024-07-27T16:27:30"
        },
        "sort": [
          1722097650000 // ì£¼ëª©
        ]
      }
    ]
  }
}

> sort ê°’ìœ¼ë¡œ search_after ìš”ì²­
GET movie/_search
{
  "query": {
    "match": {
      "titleText": {
        "query": "í…ìŠ¤íŠ¸",
        "operator": "and"
      }
    }
  },
  "sort": [
    {
      "created": {
        "order": "asc"
      }
    }
  ],
  "search_after": ["1722184050000"] // _idê°€ 2ì¸ ë¬¸ì„œì˜ sort ê°’
}

> ì‘ë‹µê°’
{
  "took": 2,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 3,
      "relation": "eq"
    },
    "max_score": null,
    "hits": [
      {
        "_index": "movie",
        "_id": "3",
        "_score": null,
        "_source": {
          "titleText": "ì´ë””ì•„ í…ìŠ¤íŠ¸",
          "titleKeyword": "ì´ë””ì•„ í‚¤ì›Œë“œ",
          "prefixField": "ë‚˜ëŠ” ê¹€ë™ê· ",
          "views": 35,
          "public": false,
          "created": "2024-07-29T16:27:30"
        },
        "sort": [
          1722270450000
        ]
      }
    ]
  }
}
```

<br>

## 4. ì§‘ê³„

- ì§‘ê³„ë¥¼ ì‚¬ìš©í•˜ë©´ í‚¤ë°”ë‚˜ ëŒ€ì‹œë³´ë“œë¥¼ ë§Œë“¤ ë•Œ ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤. ì§‘ê³„ì— ëŒ€í•œ ìê°ì—†ì´ êµ‰ì¥íˆ ë¬´ê±°ìš´ ê·¸ë˜í”„ë¥¼ ë§Œë“¤ë‹¤ë³´ë©´ í‚¤ë°”ë‚˜ ëŒ€ì‹œë³´ë“œë¥¼ ì—´ ë•Œë§ˆë‹¤ ë¶€í•˜ë¥¼ ì¤„ ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

#### ì§‘ê³„ ê¸°ë³¸

- aggsë¥¼ í†µí•´ ì§‘ê³„ë¥¼ í•  ìˆ˜ ìˆìœ¼ë©° ì´ë•Œ sizeë¥¼ 0ìœ¼ë¡œ ì„¤ì •í•˜ì˜€ìŠµë‹ˆë‹¤. sizeë¥¼ 0ìœ¼ë¡œ ì„¤ì •í•¨ìœ¼ë¡œì„œ ê° ìƒ¤ë“œì—ì„œ ìˆ˜í–‰í•œ ê²€ìƒ‰ ê²°ê³¼ì—ì„œ ìƒìœ„ ë¬¸ì„œì˜ ë‚´ìš©ì„ ìˆ˜ì§‘í•´ ëª¨ì„ í•„ìš”ê°€ ì—†ê³  ì ìˆ˜ë¥¼ ê³„ì‚°í•˜ëŠ” ê³¼ì •ë„ ìˆ˜í–‰í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ë¡œ ì¸í•´ ì„±ëŠ¥ ì´ë“ê³¼ ìºì‹œì˜ ë„ì›€ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```json
> aggsë¥¼ í†µí•´ ì§‘ê³„
GET kibana_sample_data_ecommerce/_search
{
  "query": {
    "term": {
      "currency": {
        "value": "EUR"
      }
    }
  },
  "aggs": {
    "sum_aggs": {
      "sum": {
        "field": "taxless_total_price"
      }
    }
  },
  "size": 0
}

> ì‘ë‹µê°’
{
  "took": 3,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 4675,
      "relation": "eq"
    },
    "max_score": null,
    "hits": []
  },
  "aggregations": {
    "sum_aggs": {
      "value": 350884.12890625
    }
  }
}
```

<br>

#### stats ì§‘ê³„

- stats ì§‘ê³„ëŠ” ì§€ì •í•œ í•„ë“œì˜ í‰ê· , ìµœëŒ“ê°’, ìµœì†Ÿê°’, í•©, ê°œìˆ˜ë¥¼ ëª¨ë‘ ê³„ì‚°í•˜ì—¬ ë°˜í™˜í•©ë‹ˆë‹¤.

```json
> ìš”ì²­ê°’
GET kibana_sample_data_ecommerce/_search
{
  "query": {
    "term": {
      "currency": {
        "value": "EUR"
      }
    }
  },
  "aggs": {
    "stats_aggs": {
      "stats": {
        "field": "taxless_total_price"
      }
    }
  },
  "size": 0
}

> ì‘ë‹µê°’
{
  "took": 17,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 4675,
      "relation": "eq"
    },
    "max_score": null,
    "hits": []
  },
  "aggregations": {
    "stats_aggs": {
      "count": 4675,
      "min": 6.98828125,
      "max": 2250,
      "avg": 75.05542864304813,
      "sum": 350884.12890625
    }
  }
}
```
<br>

#### cardinality ì§‘ê³„

- cardinality ì§‘ê³„ëŠ” ì§€ì •í•œ í•„ë“œê°€ ê°€ì§„ ê³ ìœ í•œ ê°’ì˜ ê°œìˆ˜ë¥¼ ê³„ì‚°í•´ ë°˜í™˜í•´ì¤ë‹ˆë‹¤.
- ì´ ê°’ì€ HyperLogLog++ ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•´ ì¶”ì •í•œ ê·¼ì‚¬ê°’ì…ë‹ˆë‹¤.
- precision_threshold ì˜µì…˜ì€ ì •í™•ë„ë¥¼ ì¡°ì ˆí•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ë©°, ì´ ê°’ì„ ë†’ì´ë©´ ì •í™•ë„ê°€ ì˜¬ë¼ê°€ì§€ë§Œ ê·¸ ë§Œí¼ ë©”ëª¨ë¦¬ë¥¼ ë” ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ë¬´ì‘ì • ëŠ˜ë¦´ í•„ìš”ê°€ ì—†ëŠ”ê²Œ precision_thresholdê°€ ìµœì¢… cardinality ë³´ë‹¤ ë†’ë‹¤ë©´ ì •í™•ë„ê°€ ì¶©ë¶„íˆ ë†’ì€ ê²ƒì…ë‹ˆë‹¤. (precision_thresholdì˜ ìµœëŒ“ê°’ì€ 40000)

```json
> ìš”ì²­ê°’
GET kibana_sample_data_ecommerce/_search
{
  "query": {
    "term": {
      "currency": {
        "value": "EUR"
      }
    }
  },
  "aggs": {
    "cardinality_aggs": {
      "cardinality": {
        "field": "customer_id",
        "precision_threshold": 3000
      }
    }
  },
  "size": 0
}

> ì‘ë‹µê°’
{
  "took": 6,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 4675,
      "relation": "eq"
    },
    "max_score": null,
    "hits": []
  },
  "aggregations": {
    "cardinality_aggs": {
      "value": 46
    }
  }
}
```

<br>

### ë²„í‚· ì§‘ê³„

- ë²„í‚· ì§‘ê³„ëŠ” ë¬¸ì„œë¥¼ íŠ¹ì • ê¸°ì¤€ìœ¼ë¡œ ìª¼ê°œì–´ ì—¬ëŸ¬ ë¶€ë¶„ ì§‘í•©ìœ¼ë¡œ ë‚˜ëˆ•ë‹ˆë‹¤. ë‚˜ë‰œ ì§‘í•©ì„ ë²„í‚·ì´ë¼ í•©ë‹ˆë‹¤.

#### date_range ì§‘ê³„

- date_range ì§‘ê³„ëŠ” ì§€ì •í•œ í•„ë“œê°’ì„ ê¸°ì¤€ìœ¼ë¡œ ë¬¸ì„œë¥¼ ì›í•˜ëŠ” ë²„í‚· êµ¬ê°„ìœ¼ë¡œ ìª¼ê°­ë‹ˆë‹¤.

```json
> ìš”ì²­ê°’
GET kibana_sample_data_ecommerce/_search
{
  "aggs": {
    "date_range_aggs": {
      "date_range": {
        "field": "order_date",
        "ranges": [
          {
            "from": "2024-07-01",
            "to": "2024-07-31"
          },
          {
            "from": "2024-08-01",
            "to": "2024-08-31"
          }
        ]
      },
      "aggs": {
        "average-ticket-price": {
          "avg": {
            "field": "taxless_total_price"
          }
        }
      }
    }
  },
  "size": 0
}

> ì‘ë‹µê°’
{
  "took": 3,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 4675,
      "relation": "eq"
    },
    "max_score": null,
    "hits": []
  },
  "aggregations": {
    "date_range_aggs": {
      "buckets": [
        {
          "key": "2024-07-01T00:00:00.000Z-2024-07-31T00:00:00.000Z",
          "from": 1719792000000,
          "from_as_string": "2024-07-01T00:00:00.000Z",
          "to": 1722384000000,
          "to_as_string": "2024-07-31T00:00:00.000Z",
          "doc_count": 2973,
          "average-ticket-price": {
            "value": 74.5792378805079
          }
        },
        {
          "key": "2024-08-01T00:00:00.000Z-2024-08-31T00:00:00.000Z",
          "from": 1722470400000,
          "from_as_string": "2024-08-01T00:00:00.000Z",
          "to": 1725062400000,
          "to_as_string": "2024-08-31T00:00:00.000Z",
          "doc_count": 1557,
          "average-ticket-price": {
            "value": 76.19093709858703
          }
        }
      ]
    }
  }
}
```

<br>

#### terms ì§‘ê³„

- terms ì§‘ê³„ëŠ” ì§€ì •í•œ í•„ë“œì— ëŒ€í•´ ê°€ì¥ ë¹ˆë„ìˆ˜ê°€ ë†’ì€ term ìˆœì„œëŒ€ë¡œ ë²„í‚·ì„ ìƒì„±í•©ë‹ˆë‹¤. ë²„í‚·ì„ ìµœëŒ€ ëª‡ ê°œê¹Œì§€ ìƒì„±í•  ê²ƒì¸ì§€ë¥¼ sizeë¡œ ì§€ì •í•©ë‹ˆë‹¤.
- terms ì§‘ê³„ëŠ” ê° ìƒ¤ë“œì—ì„œ size ê°œìˆ˜ë§Œí¼ termì„ ë½‘ì•„ ë¹ˆë„ìˆ˜ë¥¼ ì…‰ë‹ˆë‹¤. ê·¸ë¦¬ê³  ê° ìƒ¤ë“œì—ì„œ ìˆ˜í–‰ëœ ê³„ì‚°ì„ í•œ ê³³ìœ¼ë¡œ ëª¨ì•„ í•©ì¹œ í›„ size ë§Œí¼ ë²„í‚·ì„ ë½‘ìŠµë‹ˆë‹¤.

```json
> ìš”ì²­ê°’
GET kibana_sample_data_logs/_search
{
  "size": 0,
  "aggs": {
    "term-aggs": {
      "terms": {
        "field": "host.keyword",
        "size": 10
      }
    }
  }
}

> ì‘ë‹µê°’
{
  "took": 9,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 10000,
      "relation": "gte"
    },
    "max_score": null,
    "hits": []
  },
  "aggregations": {
    "term-aggs": {
      "doc_count_error_upper_bound": 0,
      "sum_other_doc_count": 0,
      "buckets": [
        {
          "key": "artifacts.elastic.co",
          "doc_count": 6488
        },
        {
          "key": "www.elastic.co",
          "doc_count": 4779
        },
        {
          "key": "cdn.elastic-elastic-elastic.org",
          "doc_count": 2255
        },
        {
          "key": "elastic-elastic-elastic.org",
          "doc_count": 552
        }
      ]
    }
  }
}
```
<br>

### íŒŒì´í”„ë¼ì¸ ì§‘ê³„

- íŒŒì´í”„ë¼ì¸ ì§‘ê³„ëŠ” ë¬¸ì„œë‚˜ í•„ë“œì˜ ë‚´ìš©ì´ ì•„ë‹ˆë¼ ë‹¤ë¥¸ ì§‘ê³„ ê²°ê³¼ë¥¼ ì§‘ê³„ ëŒ€ìƒìœ¼ë¡œ í•©ë‹ˆë‹¤.

#### cumulative_sum ì§‘ê³„

- cumulative_sum ì§‘ê³„ëŠ” ë‹¤ë¥¸ ì§‘ê³„ì˜ ê°’ì„ ëˆ„ì í•˜ì—¬ í•©ì‚°í•©ë‹ˆë‹¤. buckets_pathë¡œ ëˆ„ì  í•©ì‚°í•  ì§‘ê³„ì˜ ì´ë¦„ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```json
> ìš”ì²­ê°’
GET kibana_sample_data_ecommerce/_search
{
  "size": 0,
  "aggs": {
    "daily-timestamp-bucket": {
      "date_histogram": {
        "field": "order_date",
        "calendar_interval": "day"
      },
      "aggs": {
        "daily-total-quantity-avg": {
          "avg": {
            "field": "total_quantity"
          }
        },
        "pipeline-sum": {
          "cumulative_sum": {
            "buckets_path": "daily-total-quantity-avg"
          }
        }
      }
    }
  }
}

> ì‘ë‹µê°’
{
  "took": 88,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 4675,
      "relation": "eq"
    },
    "max_score": null,
    "hits": []
  },
  "aggregations": {
    "daily-timestamp-bucket": {
      "buckets": [
        {
          "key_as_string": "2024-07-11T00:00:00.000Z",
          "key": 1720656000000,
          "doc_count": 146,
          "daily-total-quantity-avg": {
            "value": 2.1780821917808217
          },
          "pipeline-sum": {
            "value": 2.1780821917808217
          }
        },
        {
          "key_as_string": "2024-07-12T00:00:00.000Z",
          "key": 1720742400000,
          "doc_count": 153,
          "daily-total-quantity-avg": {
            "value": 2.183006535947712
          },
          "pipeline-sum": {
            "value": 4.361088727728534
          }
        }
      ]
    }
  }
}
```

<br>

#### max_bucket ì§‘ê³„

- max_bucket ì§‘ê³„ëŠ” ë‹¤ë¥¸ ì§‘ê³„ì˜ ê²°ê³¼ë¥¼ ë°›ì•„ì„œ ê·¸ ê²°ê³¼ê°€ ê°€ì¥ í° ë²„í‚·ì˜ keyì™€ ê²°ê³¼ê°’ì„ êµ¬í•˜ëŠ” ì§‘ê³„ì…ë‹ˆë‹¤.

```json
> ìš”ì²­ê°’
GET kibana_sample_data_ecommerce/_search
{
  "size": 0,
  "aggs": {
    "daily-timestamp-bucket": {
      "date_histogram": {
        "field": "order_date",
        "calendar_interval": "day"
      },
      "aggs": {
        "daily-total-quantity-avg": {
          "avg": {
            "field": "total_quantity"
          }
        }
      }
    },
    "max-total-quantity": {
      "max_bucket": {
        "buckets_path": "daily-timestamp-bucket>daily-total-quantity-avg"
      }
    }
  }
}

> ì‘ë‹µê°’
{
  "took": 5,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 4675,
      "relation": "eq"
    },
    "max_score": null,
    "hits": []
  },
  "aggregations": {
    "daily-timestamp-bucket": {
      "buckets": [
        {
          "key_as_string": "2024-07-11T00:00:00.000Z",
          "key": 1720656000000,
          "doc_count": 146,
          "daily-total-quantity-avg": {
            "value": 2.1780821917808217
          }
        },
        {
          "key_as_string": "2024-07-12T00:00:00.000Z",
          "key": 1720742400000,
          "doc_count": 153,
          "daily-total-quantity-avg": {
            "value": 2.183006535947712
          }
        },
        {
          "key_as_string": "2024-07-13T00:00:00.000Z",
          "key": 1720828800000,
          "doc_count": 143,
          "daily-total-quantity-avg": {
            "value": 2.111888111888112
          }
        },
        {
          "key_as_string": "2024-08-09T00:00:00.000Z",
          "key": 1723161600000,
          "doc_count": 152,
          "daily-total-quantity-avg": {
            "value": 2.289473684210526
          }
        },
      ]
    },
    "max-total-quantity": {
      "value": 2.289473684210526,
      "keys": [
        "2024-08-09T00:00:00.000Z"
      ]
    }
  }
}
```


