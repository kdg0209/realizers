# CAS(Compare and Swap)에 대해

<br>

### CAS란?

- 멀티 스레드 환경이나 멀티 코어 환경에서 각 CPU는 메인 메모리를 참조하는게 아닌 우선적으로 CPU 캐시를 참조하게 됩니다. 근데 멀티 스레드 환경에서 CPU 캐시를 우선적으로 참조하게 되면 메인 메모리에 저장된 값과 CPU 캐시에 저장된 값이 다른 경우가 발생할 수 있습니다. 이를 가시성 문제라 합니다.
- CAS 알고리즘은 현재 스레드가 가진 값을 CPU캐시와 메인 메모리의 두 값과 비교하고, 그 값이 모두 동일한 경우에만 메인 메모리에 새로운 값을 저장하고, 일치 하지 않으면 재시도를 합니다.
- CAS는 락 기반의 동기화보다 경량화되어 있으며 락을 사용하지 않기 때문에 대기하지 않는 Non-Blocking 실행이 가능하며, 데드락을 피할 수 있습니다.
- CAS는 메인 메모리에 값을 저장할때 실패후 재시도할 수 있으므로 동시적으로 접근하는 스레드가 많다면 효율성이 저하될 수 있습니다.
- CAS는 하드웨어 수준에서 지원되는 단일 연산입니다.

<br>

### 🧨 문제점

- ABA Problem이라는 문제가 등장할 수 있습니다.
- CAS 연산에서 공유 객체에 대한 변화 감지를 해야하는데, 변화에 대해 감지를 못할 때 발생하는 현상입니다.

<br>

### Atomic Variables

- 단일연산변수는 락을 사용하지 않고도 여러 스레드 간에 안전하게 값을 공유하고 동기화하는데 사용하며, 기본적으로 volatile 속성을 가지고 있어서 가시성을 확보할 수 있습니다.
- 단일연산변수는 하드웨어에서 원자적으로 연산을 지원하여 내부적으로 CAS 연산을 통해 데이터의 일관성을 유지합니다.
- 단일연산변수는 간단한 연산의 경우 락을 사용하는것보다 효율적이지만 연산이 복잡하거나 시간이 오래 걸리는 작업은 락을 사용하는 것보다 오버헤드가 더 커질 수 있습니다. 그 이유는 CAS 연산시 재시도를 하면서 CPU 사용량이 증가하기 때문입니다.





