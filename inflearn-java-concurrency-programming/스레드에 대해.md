# 스레드에 대해

### 스레드란?

- 자바 스레드는 JVM에서 사용자 모드 스레드를 생성할 때 system call을 통해서 커널에서 생성된 커널 스레드와 1:1 매핑되어 최종적으로 커널에서 관리됩니다.
- JVM에서 스레드를 생성할 때마다 커널에서 자바 스레드와 대응되는 커널 스레드를 생성하게 됩니다.
- 자바에서는 Platform Thread로 정의되어 있으며, OS 플랫폼에 따라 JVM이 사용자 모드 스레드를 커널 스레드와 매핑하게 됩니다.

![스크린샷 2024-02-29 오후 10 02 02](https://github.com/kdg0209/realizers/assets/80187200/6edfce9e-16c8-4ea2-9c91-ec0b41a85397)

<br>

### 스레드의 실행

- start() 메서드는 스레드를 실행시키는 메서드이며, system call을 통해서 커널에 커널 스레드 생성을 요청합니다.
- 자바 스레드는 OS 스케줄러에 의해 실행 순서가 결정되며, 스레드 실행 시점을 JVM에서 제어할 수 없습니다.
- 스레드는 현제 스레드와 독립적으로 실행되거, 최대 한번만 시작할 수 있으며 종료 후에는 재사용할 수 없습니다.

![스크린샷 2024-02-29 오후 10 23 32](https://github.com/kdg0209/realizers/assets/80187200/d284344b-380e-41b6-8b6d-aaee1c4d8b96)

#### 과정

1. main thread가 새로운 스레드를 생성합니다.
2. main thread가 start 메서드를 호출하여 스레드를 실행시킵니다.
3. start 메서드를 호출하면 내부적으로 native 메서드인 start0() 메서드를 호출하여 커널에게 커널 스레드를 생성해달라고 system call을 요청하게 됩니다.
4. 커널은 system call 요청을 받아 커널 스레드를 생성하게 되고, 커널 스레드는 자바 스레드와 1:1 매핑이 이루어집니다.
5. 커널 스레드는 OS Scheduler로부터 CPU를 할당받기 전까지는 실행대기 상태로 머물게 됩니다.
6. 커널 스레드가 OS Scheduler에 의해 CPU를 할당받아 실행 상태가 되면 JVM에서 매핑된 자바 스레드의 run 메서드를 호출하게 됩니다.

#### 🧨 주의점

- 자바에서 스레드를 생성하고 실행할때 아래와 같은 코드를 작성하여 run 메서드를 호출한다면 이는 새로운 스레드를 생성하는게 아니라 직접 호출한 스레드의 stack에서 단지 run 메서드가 실행될 뿐입니다. 따라서 새로운 스레드를 생성하고 반드시 start 메서드를 호출해야 합니다.
run 메서드는 위에서 언급했던 거처럼 CPU를 할당받아 실행 상태가 된 자바 스레드가 알아서 내부적으로 run 메서드를 호출하게 됩니다.

```java
Thread thread = new Thread();
thread.run(); // 이는 잘못된 방법입니다.

// 옳바른 사용 방법
thread.start();
```

<br>

### 스레드의 종료

- 스레드는 run 메서드의 코드가 모두 실행되면 스레드는 자동으로 종료합니다.
- 스레드는 예외가 발생한 경우 종료되며, 다른 스레드에게 영향을 미치지 않습니다.
- 우리가 만드는 애플리케이션이 싱글 스레드인 경우와 멀티 스레드인 경우에 따라 종료 기준이 다릅니다.
















