# 오류

- 오류가 없는 시스템은 없을 수 없습니다. 오류를 어떻게 처리할 것인가를 신중하게 생각하지 않는다면 견고하고 신뢰성 높은 소프트웨어를 만들 수 없습니다.
- 이번장에서는 복구 가능성이 있는 오류가 복구 가능성이 없는 오류가 어떤게 있는지 그리고 어떻게 처리해야하는지에 대해 살펴봅니다.

<br>

## 1. 복구 가능성

#### 1.1 복구 가능한 오류

- 복구 가능한 오류의 대표적인 예는 네트워크 오류나 사용자의 입력값에 대한 오류입니다. 이러한 오류가 발생하면 재시도를 하게끔할 유도할 수 있습니다.

#### 1-2. 복구 불가능한 오류

- 사전에 초기화가 되어 있지 않거나 특정 요구사항을 만족 못하는 경우(충전이 되어 있어야지 사용할 수 있는)에 대한 오류입니다.

#### 1-3. 오류 처리

- 가령 아래와 같은 코드가 있다고 가정을 해봅시다. getNumber() 메서드를 호출하는 클라이이언트가 -1을 매개변수로 전달했다면 예외가 발생할 것입니다. 만약 특정 입력이 유효하지 않다라는 사실이 코드 계약의 세부 사항에 깊숙히 숨겨져 있다면 다른 개발자가 이를 놓칠 가능성이 있습니다.

```java
private int[] numbers;

public int getNumber(int index) {
    if (index < 0 || numbers.length <= 0) {
        throw new IllegalStateException("...");
    }
    
    return this.numbers[index];
}
```

<br>

## 2. 견고성 Vs 실패

- 오류가 있더라도 내부적으로 처리하고 계속 진행하면 견고성이 있는 코드라고 볼 수 있지만 오류가 감지되지 않고 이상한 일이 발생하기 시작한다는 의미로도 볼 수 있습니다.
- 여기서는 견고성보다 실패가 많은 경우에 최선인 이유를 알아봅니다.

#### 2-1. 신속하게 실패하라.

- "신속하게 실패하기"는 가능한 한 문제의 발생 지점으로부터 가까운 곳에서 오류를 나타내는 것입니다. 복구할 수 있는 오류의 경우 호출하는 쪽에서 오류로부터 휼륭하고 안전하게 복구할 수 있는 기회를 제공하고, 복구할 수 없는 오류의 경우 개발자가 문제를 신속히 알 수 있게끔 기회를 제공해줍니다.
- 아래 그림에서 "케이스 1"과 "케이스 2"가 있는데, 케이스 1의 경우 잘못된 데이터를 전달했는데, 오류는 실제 위치에서 동떨어진 코드에서 발생할 수 있는 상황이고, "케이스 2"는 잘못된 데이터로 인해 신속히 오류 위치를 알 수 있는 상황입니다.

<img width="1032" alt="스크린샷 2024-12-22 오후 3 38 20" src="https://github.com/user-attachments/assets/bdead727-4951-45f8-bc82-6d29c8ddb7e6" />

<br>

#### 2-2. 요란하게 실패하라.

- 요라한 실패는 오류가 발생하는데도 불구하고 아무도 모르는 상황을 막고자 하는 것입니다. 가장 명백한 방법은 예외가 발생하면 프로그램이 중단되게 하는 것인데 이는 현실적인 상황에서는 사용할 수 없다고 생각을 하고 있습니다. 다른 대안으로는 로그를 남겨 확인하는 것인데, 이는 부지런해야하므로 바쁜 상황이라면 충분히 놓칠 가능성이 있습니다. 그래서 예기치 않은 오류가 발생하면 슬랙이나 메일로 알 수 있게끔 요란하게 알려야하지 않을까 생각합니다.

#### 2-4. 오류를 숨기지 않음

- 복구 가능성이 있는 오류를 숨기면 복구할 수 있는 기회가 있음에도 불구하고 그 기회를 없애는 것이며, 복구 가능성이 없는 오류를 숨기는 것은 개발팀이 알아야만 고칠 수 것을 숨기는 것입니다.

1. 기본값 반환
    - 오류가 발생하면 예외를 던지는 대신 기본값을 반환하는 것이 간단하고 쉬운 해결책처럼 보일 수 있습니다. 이것이 도움이 될때도 있지만 오류가 발생했다는 사실을 숨기는 것이기 때문에 버그가 발생할 수 있습니다.

2. 널 객체 반환
    - 널 객체는 기본값과 비슷하지만 더 다양하게 사용될 수 있습니다. 만약 리스트를 조회할 때 오류가 발생하면 빈 리스트를 반환하는 경우에도 버그를 유발할 수 있는 행위입니다.

3. 아무것도 하지 않음
    - 오류가 발생했을 때 코드가 무엇갈 반환하지 않고 어떤 작업을 수행하는 경우 호출하는 쪽에서는 작업이 의도한대로 완료되었다고 가정하기 때문에 바람직하지 않습니다. 이는 개발자에게 인지부조화를 가져올 수 있고 명확하지 않다고 생각합니다.

<br>

## 3. 오류 전달 방법

- 오류가 발생하면 일반적으로 더 높은 계층으로 오류를 알려야합니다. 오류로부터 복구할 수 없는 경우 프로그램의 훨씬 더 높은 계층에서 실행을 중지하고, 오류를 기록하거나 인지할 수 있게끔 해야합니다.

#### 💡 명시적 방법

- 코드를 직접 호출한 쪽에서 오류가 발생할 수 있다는 것을 인지할 수 있도록 하는 것입니다.
- 호출자 입장에서 강제적으로 오류를 핸들링해야 합니다. (Checked Exception)

#### 💡 암시적 방법

- 코드를 호출하는 쪽에 오류를 알리지만 호출자 입장에서 오류를 비강제적으로 핸들링할 수 있습니다. (UnChecked Exception)
- 다른 개발자는 특정 함수를 호출할 때 오류가 발생할 것이라는 인지를 못할 수도 있습니다. 문서화를 해놓을 수 있지만 이는 코드 계약의 세부 조항입니다.

#### 3-1. NULL값 반환

- 호출자가 특정 함수를 호출한 뒤 오류가 발생하면 NULL을 반환받는 것입니다. 개인적으로 오류가 발행했을 경우 NULL을 반환하는 행위는 지양해야 한다고 생각합니다. 호출자가 NULL처리를 하지 않을 수도 있을뿐만 아니라 NULL의 모호함 때문이라고 생각합니다.
코드를 작성한 개발자는 배경지식이 있기 때문에 NULL을 반환해도 무방하다고 생각하지만 그것을 읽는 타 개발자는 배경지식이 없을 수 밖에 없기 때문에 NULL 반환는 주의가 필요하다고 생각홥니다.

#### 3-2. 아웃컴 반환 

- 어떤 함수들은 값을 반환하기보다는 단지 무엇가를 수행하고 값을 반환하지 않을 수 있습니다. 아래 예제에서 sendMessage() 메서드는 열려있는 채널에 메시지를 보내고 성공하면 TRUE, 실패하면 FALSE를 반환하는 메서드입니다. sendMessage() 메서드를 사용하는 호출자는 반환값에 따라 로직을 처리할 수도 있고, 처리하지 않을 수도 있기 때문에 해당 메서드가 제대로 사용되도록 보장할 수 없습니다.

```java
public boolean sendMessage(String message) {
    if (this.channel.isOpen()) {
        this.channel.send(message);
        return true;
    }
    return false;
}

// 사용법 1
public void client() {
    if (sendMessage("hello")) {
        // 성공 로직 ...
    }
    
    // 실패 로직
}

// 사용법 2
public void client() {
    sendMessage("hello");
}
```

#### 3-3. 매직 넘버 반환

- 특정 메서드에 오류가 있으면 -1을 반환하는 것입니다. 개인적으로 해당 방법은 사용해서는 안된다고 생각합니다. 그 이유는 -1이 무엇을 의미하는지 유추할 수 없을 뿐만 아니라 시간이 지남에 따라 히스토리를 더욱 알 수 없기 때문에 유지보수하기가 굉장히 힘들다고 생각합니다.

<br>

## 4. 오류에 대한 주장

- 오류 처리에 있어서 최악의 상황은 팀의 절반은 오류 전달 및 관행에 한쪽의 관행을 따르는 코드를 작성하고, 나머지 절반은 완전히 다른 관행을 따르는 것입니다.

#### 4-1. 비검사 예외를 사용해야 한다는 주장

- 비검사 예외를 사용함으로써 오류 핸들링의 강제성이 없기 때문에 코드 구조가 간결해질 수 있습니다.

#### 4-2. 검사 예외를 사용해야 한다는 주장

- 실수로 오류를 무시할 수 없기 때문에 모든 과정을 꼼꼼히 처리할 수 있다고 생각합니다.

#### 4-3. 나의 주장

- 개인적으로는 비검사 예외를 더 선호하고 있습니다. 그 이유는 코드 구조가 간결해진다라는 점에 동의를 하며, 만약 검사 예외가 발생하는 곳이라면 비검사 예외로 래핑하여 조금 더 사용자 친화적인 오류로 변경해야 하지 않을까 생각합니다.

<br>

#### 정리

- 오류가 발생하면 신속하게 실패하는 것이 좋고, 오류가 복구 불가능하다면 요란하게 실패하여 모두가 알 수 있도록 처리해야 합니다.
- 오류를 숨기는 것은 옳은 행위가 아니며 즉시 알 수 있도록 처리해야 합니다.
- 오류 전달 기법에는 명시적 방법과 암시적 방법이 있으며 이는 개발하는 과정에서 어떤 방법을 사용할지 고민할 필요가 있습니다.


