# 검색어 자동완성 시스템

## 1단계. 문제 이해 및 설계 범위 확정

- 사용자가 검색어를 입력함에 따라 자동완성 검색어도 빨리 노출이 되어야 합니다.
- 자동완성되어 출력되는 검색어는 사용자가 입력한 단어와 연관되어 있어야 합니다.
- 출력되는 검색어는 인기도 등의 순위 모델에 의해 정렬되어야 합니다.
- 시스템은 많은 트래픽을 감당할 수 있도록 확장 및 가용성이 있어야 합니다.

#### 개략적 규모 추정

- 일간 능동 사용자: 천만명
- 초당 대략 24,000 건의 QPS 발생
- 최대 QPS는 48,000

<br>

## 2단계. 개략적 설계안 제시 및 동의 구하기

#### 질의 서비스

- query: 질의문을 저장하는 필드
- freuqency: 질의문이 사용된 빈도를 저장하는 필드
- 아래와 같은 데이터가 있을 경우 사용자가 'tw'를 입력하면 top5를 twitter, twitch, twilight, twin peak, twitch prime만 노출이 되어야합니다.
- 엘라스틱 서치의 인덱스에

|query|freuqency|
|------|------|
|twitter|35|
|twitch|29|
|twilight|25|
|twin peak|21|
|twitch prime|18|
|twitter search|14|
|twillo|10|
|twin peak sf|8|

<br>

## 3단계. 상세 설계

### 트라이 자료구조

- 트라이는 트리 자료 구조입니다.
- 사용자가 한글로 "가상 면접 사례" 이라고 검색을 한다고 가정을 해봅시다.
- 아래 예제를 보면 알고리즘을 정말 못하는 내가 보기에도 데이터가 많으면 느려질 수 밖에 없겠구나 생각이 듭니다.

#### 트라이 자료구조에 단어 저장

- 사용자로부터 "가상 면접 사례"를 입력 받습니다.
- 앞글자인 "가" 부터 저장을 시작합니다. 이때 자식 노드에 "가"가 있다면 다음 글자로 넘어가게 됩니다. 만약 "가" 노드가 없다면 "가" 노드를 만들게 됩니다.
- 다음에 "가상" 이라는 단어를 "가"의 자식 노드에 추가됩니다.
- 또 다음에 "가상 " 이라는 단어를 "가상"의 자식 노드에 추가됩니다.
- 또 다음에 "가상 면" 이라는 단어를 "가상 "의 자식 노드에 추가됩니다. (단어가 종료될 때까지 반복됩니다.)
- 우리는 정렬까지 해야하므로 각 노드에 빈도에 대한 정보도 저장합니다.

#### 트라이 자료구조에 단어 검색

- 사용자가 "가상 면접 사례"를 검색합니다.
- 루트 노드의 자식 노드에서 "가"로 시작하는 자식 노드가 있는지 탐색합니다.
- 이또한 저장하는 방식과 유사하게 탐색하여 원하는 단어를 찾게 됩니다.

![스크린샷 2024-07-01 오후 10 02 47](https://github.com/kdg0209/realizers/assets/80187200/564e7fe3-e264-46ab-8b52-b25977e86b79)

<br><br>

#### 트라이 자료구조의 문제점

- 매일 수천만 건의 질의가 입력된다면 그때마다 트라이 자료구조를 갱신하게 된다면 검색어 자동완성 서비스에 엄청난 부하가 발생합니다.
- 만약 자주 갱신되지 않는 서비스라면 갱신이 자주 발생하지 않기 때문에 부하가 상대적으로 덜 발생합니다.

<br>

#### 노드에 인기 검색어 캐시

- 각 노드에 k개의 인기 검색어를 저장해두면 탐색의 범위를 줄일 수 있기 때문에 효율적일 수 있습니다.





















