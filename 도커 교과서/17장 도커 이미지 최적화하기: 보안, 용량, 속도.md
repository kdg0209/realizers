# ë„ì»¤ ì´ë¯¸ì§€ ìµœì í™”í•˜ê¸°: ë³´ì•ˆ, ìš©ëŸ‰, ì†ë„

<br>

## 1. ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ìµœì í™”í•˜ëŠ” ë°©ë²•

#### 1-1. ê¼­ í•„ìš”í•œ íŒŒì¼ë§Œ ì´ë¯¸ì§€ì— í¬í•¨í•´ì•¼ í•œë‹¤.

- ë‹¹ì—°í•œ ì†Œë¦¬ì§€ë§Œ Dockerfileì„ ì‘ì„±í•˜ë‹¤ë³´ë©´ ì‚¬ìš©ë˜ì§€ ì•Šì„ ì´ë¯¸ì§€ íŒŒì¼ì´ë‚˜ ë¬¸ì„œ íŒŒì¼ê¹Œì§€ í•œêº¼ë²ˆì— ì´ë¯¸ì§€ì— í¬í•¨ì‹œí‚¤ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.
- ê¼­ í•„ìš”í•œ íŒŒì¼ë§Œ ì´ë¯¸ì§€ì— í¬í•¨ì‹œí‚¤ëŠ” ê²ƒì´ ìš©ëŸ‰ ì ˆì•½ì˜ ì²«ê±¸ìŒì…ë‹ˆë‹¤.

#### ì˜ˆì œ íŒŒì¼

- ì•„ë˜ëŠ” ë©€í‹° ìŠ¤í…Œì´ì§€ ë¹Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ê³  ìˆìŠµë‹ˆë‹¤. ì´ë•Œ ë‘ë²ˆì§¸ ë¹Œë“œì—ì„œ "RUN rm -rf /app/build/tmp && rm -rf /app/src" ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì„ ì •ì˜í•˜ì˜€ëŠ”ë°, ì‚¬ì‹¤ í•´ë‹¹ ë””ë ‰í† ë¦¬ê°€ ì‚­ì œë˜ì§€ ì•Šê³  ê·¸ëŒ€ë¡œ ë‚¨ì•„ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì˜ˆì œë¥¼ ìœ„í•´ ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì„ ì •ì˜í•¨)
- ê·¸ ì´ìœ ëŠ” íŒŒì¼ ì‚­ì œëŠ” ì‚­ì œ ë ˆì´ì–´ë¡œ í‘œì‹œë˜ì§€ë§Œ, ì´ì „ ë ˆì´ì–´ì— í¬í•¨ëœ ë°ì´í„°ëŠ” ì—¬ì „íˆ ì´ë¯¸ì§€ ë‚´ì— ì¡´ì¬í•˜ê²Œ ë©ë‹ˆë‹¤. ì¦‰, ì‚­ì œëœ íŒŒì¼ì´ ì‹¤ì œë¡œ ì‚¬ë¼ì§€ì§€ ì•Šê³  ê·¸ëŒ€ë¡œ ì´ë¯¸ì§€ ìš©ëŸ‰ì— í¬í•¨ëœ ìƒíƒœë¡œ ë‚¨ì•„ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ë°°í¬ ë‹¨ê³„ì—ì„œëŠ” app.jar íŒŒì¼ë§Œ ìˆìœ¼ë©´ ë˜ë¯€ë¡œ ì†ŒìŠ¤ ì½”ë“œë¥¼ ì´ë¯¸ì§€ì— í¬í•¨í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.

ğŸ’¡ ì£¼ì˜

- Dockerfile ìŠ¤í¬ë¦½íŠ¸ì˜ ì¸ìŠ¤íŠ¸ëŸ­ì…˜ í•˜ë‚˜ë§ˆë‹¤ ì´ë¯¸ì§€ ë ˆì´ì–´ê°€ ìƒê¸°ê²Œ ë©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì´ ì´ë¯¸ì§€ ë ˆì´ì–´ê°€ ëª¨ë‘ í•©ì³ì ¸ ì „ì²´ ì´ë¯¸ì§€ê°€ ë©ë‹ˆë‹¤. í•œ ë²ˆ ì´ë¯¸ì§€ì— ë³µì‚¬ëœ íŒŒì¼ì€ ì´ë¯¸ì§€ì—ì„œ ë”°ë¡œ ëº„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ë‹¤ìŒ ë¹Œë“œì˜ ì´ë¯¸ì§€ì—ì„œ íŒŒì¼ì„ ì§€ìš°ë”ë¼ë„ íŒŒì¼ ì‹œìŠ¤í…œì—ì„œ ìˆ¨ê²¨ì§ˆ ë¿ íŒŒì¼ì´ ì‚­ì œë˜ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤.
- ë§Œì•½ í•„ìš”í•œ íŒŒì¼ì´ ìˆë‹¤ë©´ ì „ì²´ ë””ë ‰í† ë¦¬ë¥¼ ë³µì‚¬í•˜ì§€ ë§ê³  í•„ìš”í•œ íŒŒì¼ë§Œ ë‹¤ìŒ ë¹Œë“œë¡œ ë³µì‚¬í•˜ì—¬ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ì€ ë°©ë²•ì…ë‹ˆë‹¤.

```Dockerfile
FROM openjdk:17-jdk-slim AS build
WORKDIR /app
COPY . .
RUN ./gradlew build --no-daemon

FROM openjdk:17-jdk-slim AS deploy
WORKDIR /app
COPY --from=build /app/build/libs/*.jar app.jar
RUN rm -rf /app/build/tmp && rm -rf /app/src # ì£¼ì˜ ì‚¬í•­
EXPOSE 8080

CMD ["java", "-jar", "app.jar"]
```

<br>

## 2. ì¢‹ì€ ê¸°ë°˜ ì´ë¯¸ì§€ë¥¼ ê³ ë¥´ëŠ” ë²•

- ê¸°ë°˜ ì´ë¯¸ì§€ì˜ í¬ê¸°ëŠ” ë””ìŠ¤í¬ ìš©ëŸ‰ì´ë‚˜ ë„¤íŠ¸ì›Œí¬ ì „ì†¡ ì‹œê°„ë¿ë§Œ ì•„ë‹ˆë¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ë³´ì•ˆê³¼ë„ ê´€ê³„ê°€ ë§ìŠµë‹ˆë‹¤.
- ìµœì†Œí•œì˜ í¬ê¸°ì™€ ë³´ì•ˆì„±ì„ ê°–ì¶˜ ê¸°ë°˜ ì´ë¯¸ì§€ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ë¯¸ì§€ ìµœì í™”ì˜ ì „ì œ ì¡°ê±´ì…ë‹ˆë‹¤.

<br>

## 3. ì´ë¯¸ì§€ ë ˆì´ì–´ ìˆ˜ì™€ ì´ë¯¸ì§€ í¬ê¸°ëŠ” ìµœì†Œí•œìœ¼ë¡œ 

#### 3-1. ìµœì í™”í•˜ì§€ ì•Šì€ Dockerfile

- ì•„ë˜ëŠ” ìµœì í™”í•˜ì§€ ì•Šì€ Dockerfileì…ë‹ˆë‹¤. ê·¸ ì´ìœ ëŠ” RUN ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì„ ì—¬ëŸ¬ë²ˆ ì •ì˜í•˜ì—¬ ì´ë¯¸ì§€ ë ˆì´ì–´ê°€ ì—¬ëŸ¬ê°œ ë§Œë“¤ì–´ì§€ê²Œ ë©ë‹ˆë‹¤. ì•„ë˜ Dockerfileì˜ ë ˆì´ì–´ëŠ” 7ê°œê°€ ìƒì„±ë©ë‹ˆë‹¤.
- ì•„ë˜ Dockerfileì„ ì´ë¯¸ì§€ë¡œ ë¹Œë“œí•˜ë©´ 22ì´ˆê°€ ê±¸ë¦¬ë©°, ì´ë¯¸ì§€ ì‚¬ì´ì§€ëŠ” 102MBê°€ ë©ë‹ˆë‹¤.

```Dockerfile
FROM ubuntu:20.04
ENV TZ Asia/Seoul
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone
RUN mkdir /home/test
WORKDIR /home/test
RUN apt-get update -y
RUN apt-get upgrade -y
CMD ["date"]
```

<br>

```bash
> docker image build . -t test-default
[+] Building 22.1s (11/11) FINISHED

> docker images
REPOSITORY                                      TAG       IMAGE ID       CREATED         SIZE
test-default                                    latest    74958c2021a5   9 seconds ago   102MB

> docker history test-default
IMAGE          CREATED          CREATED BY                                       SIZE      COMMENT
74958c2021a5   38 seconds ago   CMD ["date"]                                     0B        buildkit.dockerfile.v0
<missing>      38 seconds ago   RUN /bin/sh -c apt-get upgrade -y # buildkit     0B        buildkit.dockerfile.v0
<missing>      39 seconds ago   RUN /bin/sh -c apt-get update -y # buildkit      36.4MB    buildkit.dockerfile.v0
<missing>      52 seconds ago   WORKDIR /home/test                               0B        buildkit.dockerfile.v0
<missing>      52 seconds ago   RUN /bin/sh -c mkdir /home/test # buildkit       0B        buildkit.dockerfile.v0
<missing>      52 seconds ago   RUN /bin/sh -c ln -snf /usr/share/zoneinfo/$â€¦   11B       buildkit.dockerfile.v0
<missing>      52 seconds ago   ENV TZ=Asia/Seoul                                0B        buildkit.dockerfile.v0
<missing>      7 weeks ago      /bin/sh -c #(nop)  CMD ["/bin/bash"]             0B
<missing>      7 weeks ago      /bin/sh -c #(nop) ADD file:8537b4db344382b39â€¦   65.7MB
<missing>      7 weeks ago      /bin/sh -c #(nop)  LABEL org.opencontainers.â€¦   0B
<missing>      7 weeks ago      /bin/sh -c #(nop)  LABEL org.opencontainers.â€¦   0B
<missing>      7 weeks ago      /bin/sh -c #(nop)  ARG LAUNCHPAD_BUILD_ARCH      0B
<missing>      7 weeks ago      /bin/sh -c #(nop)  ARG RELEASE                   0B
```

<br>

#### 3-2. ìµœì í™”í•œ Dockerfile

- ì•„ë˜ëŠ” ìµœì í™”í•œ Dockerfileì…ë‹ˆë‹¤. ê·¸ ì´ìœ ëŠ” RUN ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì„ í•œë²ˆë§Œ ì •ì˜í•˜ì—¬ ë ˆì´ì–´ê°€ ìµœì†Œí•œìœ¼ë¡œ ìƒì„±í•˜ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤. ì•„ë˜ Dockerfileì˜ ë ˆì´ì–´ëŠ” 4ê°œê°€ ìƒì„±ë©ë‹ˆë‹¤.
- ì•„ë˜ Dockerfileì„ ì´ë¯¸ì§€ë¡œ ë¹Œë“œí•˜ë©´ 1.4ì´ˆê°€ ê±¸ë¦¬ë©°, ì´ë¯¸ì§€ ì‚¬ì´ì§€ëŠ” 65.7MBê°€ ë©ë‹ˆë‹¤.

```Dockerfile
FROM ubuntu:20.04

CMD ["date"]

ENV TZ Asia/Seoul

RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone \
    mkdir /home/test \
    apt-get update \
    apt-get upgrade -y --no-install-recommends

WORKDIR /home/test
```

```bash
> docker image build . -t test-clean
[+] Building 1.4s (7/7) FINISHED

> docker images
REPOSITORY                                      TAG       IMAGE ID       CREATED         SIZE
test-clean                                      latest    b25b3c08ba1d   6 seconds ago   65.7MB

> docker history test-clean
IMAGE          CREATED          CREATED BY                                       SIZE      COMMENT
b25b3c08ba1d   25 seconds ago   WORKDIR /home/test                               0B        buildkit.dockerfile.v0
<missing>      25 seconds ago   RUN /bin/sh -c ln -snf /usr/share/zoneinfo/$â€¦   86B       buildkit.dockerfile.v0
<missing>      25 seconds ago   ENV TZ=Asia/Seoul                                0B        buildkit.dockerfile.v0
<missing>      25 seconds ago   CMD ["date"]                                     0B        buildkit.dockerfile.v0
<missing>      7 weeks ago      /bin/sh -c #(nop)  CMD ["/bin/bash"]             0B
<missing>      7 weeks ago      /bin/sh -c #(nop) ADD file:8537b4db344382b39â€¦   65.7MB
<missing>      7 weeks ago      /bin/sh -c #(nop)  LABEL org.opencontainers.â€¦   0B
<missing>      7 weeks ago      /bin/sh -c #(nop)  LABEL org.opencontainers.â€¦   0B
<missing>      7 weeks ago      /bin/sh -c #(nop)  ARG LAUNCHPAD_BUILD_ARCH      0B
<missing>      7 weeks ago      /bin/sh -c #(nop)  ARG RELEASE                   0B
```

<br>

## 4. ë©€í‹° ìŠ¤í…Œì´ì§€ ë¹Œë“œë¥¼ í•œ ë‹¨ê³„ ì—…ê·¸ë ˆì´ë“œí•˜ê¸°

<br>

## 5. ìµœì í™”ê°€ ì¤‘ìš”í•œ ì´ìœ 







