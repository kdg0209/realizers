# 섹션 1. 프로세스와 스레드 소개

<br>

## 1. 멀티 태스킹과 멀티 프로세싱

### 단일 프로세스 시스템이란?

- 단일 프로세스 시스템은 한 번에 하나의 프로그램만 실행할 수 있습니다. 여러개의 프로그램을 실행하려면 순차적으로 하나씩 실행됩니다. 

### 멀티 태스킹이란?

- 소프트웨어 관점입니다.
- 프로세스의 작업을 시분할 기법을 통해서 번갈아가면서 작업을 수행하는 것입니다. 이러한 방식은 CPU 코어가 하나만 있어도 동시에 실행되는 것처럼 느끼게 해줄 수 있습니다

### 멀티 프로세싱이란?

- 하드웨어 관점입니다.
- 컴퓨터 시스템에서 둘 이상의 프로세서(CPU 코어)를 사용하여 여러 작업을 동시에 처리하는 기술을 의미합니다.
- 멀티 프로세싱은 여러 CPU를 사용하여 동시에 여러 작업을 수행하는 것입니다.

#### 💡 멀티 프로세싱 Vs 멀티 태스킹

- 멀티 프로세싱은 하드웨어 관점이고, 멀티 태스킹은 소프트웨어 관점입니다.
- 멀티 프로세싱은 CPU를 여러개 둠으로써(하드웨어 기반) 성능을 향상 시키고, 멀티 태스킹은 하나의 CPU가 시분할 기법을 통해 동시에 실행되는 것처럼 느끼게 하는 것을 의미합니다.

<br>

## 2. 프로세스와 스레드

### 프로세스

- 운영체제 안에서 실행중인 프로그램을 프로세스라 합니다.
- 프로세스는 실행중인 프로그램의 인스턴스입니다.
- 프로세스는 독립적인 메모리 공간을 가지고 있으며, 운영체제에서 별도의 작업 단위로 분리해서 관리되고, 각 프로세스는 별도의 메모리 공간을 가지고 서로 간섭하지 않습니다. 즉 서로의 메모리에 직접 접근할 수 없습니다.

#### 💡 프로세스의 메모리 구성

- 코드 영역: 실행할 프로그램의 코드가 저장되는 부분
- 데이터 영역: 전역 변수 및 정적 변수가 저장되는 부분
- 스택 영역: 스레드가 메서드 호출 시 생성되는 매개변수, 지역변수, 반환 주소가 저장되는 부분
- 힙 영역: 동적으로 할당되는 메모리 영역

### 스레드

- 프로세스 내에서 실행되는 작업의 단위이고, 프로세스가 제공하는 동일한 메모리 공간을 공유하며 스레드는 프로세스보다 단순하므로 생성 및 관리가 단순하고 쉽습니다.

#### 💡 스레드의 메모리 구성

- 프로세스의 코드 영역, 데이터 영역, 힙 영역을 공유하고, 스레드마다 별도의 스택 영역을 가집니다.

<br>

## 3. 스레드와 스케줄링

### 단일 코어 스케줄링

- 운영체제는 내부에 큐를 가지고 있고, 각각의 스레드는 큐에 집입한 후 스케줄링이 CPU 자원을 줄 때까지 대기하게 됩니다.

### 멀티 코어 스케줄링

- CPU 코어가 2개 이상이면 한 번에 더 많은 스레드를 물리적으로 동시에 실행시킬 수 있습니다.

<br>

## 4. 컨텍스트 스위칭

- 컨텍스트 스위칭이란 스레드가 멈추는 시점에 스레드의 정보를 메모리에 저장해둬야합니다. 그리고 새로운 스레드를 동작시키고 해당 스레드가 멈추면 기존 스레드를 실행할 때 메모리에 저장시켜뒀던 정보를 불러와야 합니다. 이러한 과정에서 CPU를 추가적으로 소요되고, 오버헤드가 발생합니다.

<br>

## 5. 실무 이야기

#### CPU 4개, 스레드 2개

- 스레드 숫자가 너무 적으면 CPU를 100% 활용할 수는 없지만 스레드수가 CPU 수보다 적어서 컨텍스트 스위치 비용이 줄어듭니다.

#### CPU 4개, 스레드 100개

- 스레드 숫자가 많으면 CPU를 100% 활용할 수는 있지만 컨텍스트 스위치 비용이 많이 발생합니다.

#### CPU 4개, 스레드 4개

- 스레드의 숫자를 CPU 숫자와 맞춘다면 CPU를 100% 활용할 수 있고, 컨텍스트 스위치 비용도 많이 발생하지 않아 최적의 상태가 됩니다.
- 이상적으로는 CPU 코어수 + 1개 정도로 스레드 수를 맞추면 스레드가 블록킹 됐을 때 남은 스레드를 효과적으로 사용할 수 있습니다.

<br>

### CPU 바운드 작업 Vs I/O 바운드 작업

#### CPU 바운드 작업

- CPU 연산 능력을 많이 요구하는 작업에 해당됩니다. (수학 연산, 데이터 분석, 비디오 인코딩 등)

#### I/O 바운드 작업

- 디스크, 네트워크, 파일 시스템과 같은 I/O 작업을 많이 요구하는 작업에 해당됩니다. (데이터 베이스 쿼리 처리, 파일 읽기/쓰기, 네트워크 통신 등)

<br>

### 🧐 적절한 스레드의 수

#### CPU 바운드 작업

- CPU 코어수 + 1개의 스레드 수로 설정
- CPU를 거의 100% 사용하는 작업이므로 스레드를 CPU 숫자에 최적화합니다.

#### I/O 바운드 작업

- CPU 코어 수 보다 많은 스레드를 생성합니다. 성능 테스트를 통해 CPU를 최대한 사용할 수 있는 숫자까지 스레드를 생성합니다.
- 너무 많은 스레드를 생성하면 컨텍스트 스위치 비용이 증가하게 됩니다.(성능 테스트 필요)


