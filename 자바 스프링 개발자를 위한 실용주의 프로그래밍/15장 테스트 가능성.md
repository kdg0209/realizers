# í…ŒìŠ¤íŠ¸ ê°€ëŠ¥ì„±

- í…ŒìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ëª©ì ì„ 'íšŒê·€ ë²„ê·¸ ë°©ì§€'ì—ë§Œ ë‘ëŠ”ê²Œ ì•„ë‹ˆë¼ í…ŒìŠ¤íŠ¸ë¥¼ í•˜ë©´ì„œ ì¢‹ì€ ì„¤ê³„ë¥¼ ì–»ê¸° ìœ„í•œ ìˆ˜ë‹¨ìœ¼ë¡œë„ ë´ì•¼í•©ë‹ˆë‹¤.

#### Testability(í…ŒìŠ¤íŠ¸ ê°€ëŠ¥ì„±)

- í…ŒìŠ¤íŠ¸í•˜ê¸° ì‰¬ìš´ ì½”ë“œì¼ìˆ˜ë¡ Testabilityê°€ ë†’ìŠµë‹ˆë‹¤.
- í…ŒìŠ¤íŠ¸í•˜ê¸° ì‰¬ìš´ ì½”ë“œì¼ìˆ˜ë¡ ì¢‹ì€ ì„¤ê³„ì¼ í™•ë¥ ì´ ë†’ìŠµë‹ˆë‹¤.

<br>

## 1. í…ŒìŠ¤íŠ¸ë¥¼ ì–´ë µê²Œ ë§Œë“œëŠ” ìš”ì†Œ

- ì–´ë µê²Œ ë§Œë“œëŠ” ìš”ì¸ì€ ìˆ¨ê²¨ì§„ ì…ë ¥ì´ë‚˜ ìˆ¨ê²¨ì§„ ì¶œë ¥ì´ ìˆëŠ” ê²½ìš°ì— í…ŒìŠ¤íŠ¸ë¥¼ ê²€ì¦í•˜ê¸° ì–´ë ¤ì›Œì§‘ë‹ˆë‹¤.

### 1-1. ìˆ¨ê²¨ì§„ ì…ë ¥

#### ì˜ˆì œ ì½”ë“œ

- ì•„ë˜ ì˜ˆì œëŠ” ì‚¬ìš©ìì˜ ë§ˆì§€ë§‰ ë¡œê·¸ì¸ ì‹œê°„ì„ ê°±ì‹ í•˜ëŠ” ì˜ˆì œ ì½”ë“œì…ë‹ˆë‹¤.

```java
@Getter
public class User {

    private String id;
    private String password;
    private String name;
    private long lastLoginTimestamp;

    public User(String id, String password, String name) {
        this.id = id;
        this.password = password;
        this.name = name;
    }

    public void login() {
        /// .. ì¶”ê°€ì ì¸ ë¡œì§ ìƒëµ
        this.lastLoginTimestamp = Clock.systemUTC().millis(); // ìˆ¨ê²¨ì§„ ì…ë ¥, ë¹„ê²°ì •ì  í…ŒìŠ¤íŠ¸ì˜ ì›ì¸
    }
}

class UserTest {

    @Test
    void ìœ ì €ì˜_ë¡œê·¸ì¸_ë©”ì„œë“œë¥¼_í˜¸ì¶œí• _ê²½ìš°_ìœ ì €ì˜_ë§ˆì§€ë§‰_ë¡œê·¸ì¸_ì‹œê°„ì´_ê°±ì‹œë©ë‹ˆë‹¤() {

        // given
        String id = "test";
        String password = "12345";
        String name = "í™ê¸¸ë™";

        // when
        User user = new User(id, password, name);
        user.login();

        // then
        long lastLoginTimestamp = Clock.systemUTC().millis();
        assertThat(user.getLastLoginTimestamp()).isEqualTo(expected);
    }
}
```

#### ğŸ§ ë¬´ì—‡ì´ ë¬¸ì œì¼ê¹Œ?

- Clock.systemUTC()ëŠ” ìˆ¨ê²¨ì§„ ì…ë ¥ì…ë‹ˆë‹¤.
- ìš°ì„  ìœ„ í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” ë¹„ê²°ì •ì  í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤. ê·¸ ì´ìœ ëŠ” login() ë©”ì„œë“œë‚´ì—ì„œ Clock.systemUTC().millis() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ê³  ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.(í˜¸ì¶œ ì‹œë§ˆë‹¤ í˜„ì¬ ì‹œê°„ì„ ë°˜í™˜í•©ë‹ˆë‹¤.)

#### ğŸ’¡ ì–´ë–»ê²Œ ê°œì„ í•  ìˆ˜ ìˆì„ê¹Œ?

- login() ë©”ì„œë“œì˜ ë§¤ê°œë³€ìˆ˜ë¥¼ í†µí•´ ìˆ¨ê²¨ì§„ ì…ë ¥ì„ ì—†ì•¨ìˆ˜ ìˆê³ , ê²°ì •ì ì¸ í…ŒìŠ¤íŠ¸ë¡œ ê°œì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```java
@Getter
public class User {

    // ... ì½”ë“œ ìƒëµ

    public void login(long lastLoginTimestamp) {
        /// .. ì¶”ê°€ì ì¸ ë¡œì§ ìƒëµ
        this.lastLoginTimestamp = lastLoginTimestamp;
    }
}

class UserTest {

    @Test
    void ìœ ì €ì˜_ë¡œê·¸ì¸_ë©”ì„œë“œë¥¼_í˜¸ì¶œí• _ê²½ìš°_ìœ ì €ì˜_ë§ˆì§€ë§‰_ë¡œê·¸ì¸_ì‹œê°„ì´_ê°±ì‹œë©ë‹ˆë‹¤() {

        // given
        String id = "test";
        String password = "12345";
        String name = "í™ê¸¸ë™";
        long lastLoginTimestamp = Clock.systemUTC().millis();

        // when
        User user = new User(id, password, name);
        user.login(lastLoginTimestamp);

        // then
        assertThat(user.getLastLoginTimestamp()).isEqualTo(lastLoginTimestamp);
    }
}
```

<br>

#### â“ ì§„ì§œ ê°œì„ ëœê²Œ ë§ì„ê¹Œ?

- User í´ë˜ìŠ¤ë¥¼ í…ŒìŠ¤íŠ¸í•˜ê¸°ì—ëŠ” ê°œì„ ì´ ë˜ì—ˆì§€ë§Œ, UserService í´ë˜ìŠ¤ë¥¼ í…ŒìŠ¤íŠ¸í•  ë•Œ ê²°êµ­ Clock.systemUTC().millis()) ë©”ì„œë“œë¡œ ì¸í•´ ìˆ¨ê²¨ì§„ ì…ë ¥ê³¼ ë¹„ê²°ì •ì  í…ŒìŠ¤íŠ¸ì˜ ìš”ì¸ì´ ìƒê¸´ê±° ì•„ë‹Œê°€? ë‹¨ê³„ê°€ ë°€ë¦°ê±°ë¿ ì•„ë‹Œê°€? ë¼ëŠ” ìƒê°ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì•„ë˜ëŠ” UserService í´ë˜ìŠ¤ì˜ í…ŒìŠ¤íŠ¸ ì½”ë“œì…ë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ë³´ë©´ ê¸°ëŒ€ê°’ì— ë¬´ìŠ¨ ê°’ì„ ë„£ì–´ì•¼í• ê¹Œìš”?

```java
@Service
@RequiredArgsConstructor
public class UserService {

    public User login(String id, String password) {
        User user = ìœ ì € ì¡°íšŒ ë¡œì§

        long lastLoginTimestamp = Clock.systemUTC().millis();
        user.login(lastLoginTimestamp);

        // ... ì½”ë“œ ìƒëµ
        return user;
    }
}

class UserServiceTest {

    @Test
    void ìœ ì €ì˜_ë¡œê·¸ì¸_ë©”ì„œë“œë¥¼_í˜¸ì¶œí• _ê²½ìš°_ìœ ì €ì˜_ë§ˆì§€ë§‰_ë¡œê·¸ì¸_ì‹œê°„ì´_ê°±ì‹œë©ë‹ˆë‹¤() {

        // given
        String id = "test";
        String password = "12345";

        // when
        UserService userService = new UserService();
        User user = userService.login(id, password);

        // then
        long expected = ??? ;
        assertThat(user.getLastLoginTimestamp()).isEqualTo(expected);
    }

}
```

<br>

#### ğŸ’¡ ì§„ì§œ ê°œì„ í•´ë´…ì‹œë‹¤.

- ì˜ì¡´ì„± ì£¼ì…ê³¼ ì˜ì¡´ì„± ì—­ì „ ì›ì¹™ì„ ì‚¬ìš©í•˜ì—¬ ìœ ì—°í•˜ê²Œ ëŒ€ì²˜í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

```java
@Service
@RequiredArgsConstructor
public class UserService {

    // ì˜ì¡´ì„± ì£¼ì…
    private final ClockHolder clockHolder;

    public User login(String id, String password) {
        User user = ìœ ì € ì¡°íšŒ ë¡œì§

        long lastLoginTimestamp = clockHolder.now();
        user.login(lastLoginTimestamp);

        // ... ì½”ë“œ ìƒëµ
        return user;
    }
}

public interface ClockHolder {

    long now();
}

@Component
public class SystemClockHolder implements ClockHolder {

    @Override
    public long now() {
        return Clock.systemUTC().millis();
    }
}

public class StubClockHolder implements ClockHolder {

    @Override
    public long now() {
        return 1234567890L;
    }
}

class UserServiceTest {

    @Test
    void ìœ ì €ì˜_ë¡œê·¸ì¸_ë©”ì„œë“œë¥¼_í˜¸ì¶œí• _ê²½ìš°_ìœ ì €ì˜_ë§ˆì§€ë§‰_ë¡œê·¸ì¸_ì‹œê°„ì´_ê°±ì‹œë©ë‹ˆë‹¤() {

        // given
        String id = "test";
        String password = "12345";

        // when
        StubClockHolder stubClockHolder = new StubClockHolder();
        UserService userService = new UserService(stubClockHolder);
        User user = userService.login(id, password);

        // then
        long expected = stubClockHolder.now();
        assertThat(user.getLastLoginTimestamp()).isEqualTo(expected);
    }
}
```

<br>

### 1-2. ìˆ¨ê²¨ì§„ ì¶œë ¥

- ìˆ¨ê²¨ì§„ ì¶œë ¥ì´ë€ í˜¸ì¶œ ê²°ê³¼ê°€ ë°˜í™˜ê°’ì´ ì•„ë‹Œ ê²½ìš°ë¥¼ ë§í•©ë‹ˆë‹¤.
- ì¦‰, ë°˜í™˜ê°’ ì™¸ì— ì¡´ì¬í•˜ëŠ” ëª¨ë“  ë¶€ìˆ˜ì ì¸ ì¶œë ¥ì„ ìˆ¨ê²¨ì§„ ì¶œë ¥ì´ë¼ í•©ë‹ˆë‹¤.

#### ì˜ˆì œ ì½”ë“œ

- ì•„ë˜ ì½”ë“œëŠ” ìœ ì €ê°€ ë¡œê·¸ì¸í•  ë•Œë§ˆë‹¤ ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ë•Œ ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” í–‰ìœ„ëŠ” ìˆ¨ê²¨ì§„ ì¶œë ¥ì— í•´ë‹¹ë©ë‹ˆë‹¤.

```java
@Service
@RequiredArgsConstructor
public class UserService {

    private final ClockHolder clockHolder;

    public void login(String id, String password) {
        User user = ìœ ì € ì¡°íšŒ ë¡œì§

        long lastLoginTimestamp = clockHolder.now();
        user.login(lastLoginTimestamp);
        
        // ìˆ¨ê²¨ì§„ ì¶œë ¥
        System.out.println(user.getName() +"ì´ ë¡œê·¸ì¸ì„ í•˜ì˜€ìŠµë‹ˆë‹¤.");
    }
}
```

#### ğŸ§ ìˆ¨ê²¨ì§„ ì¶œë ¥ì´ ì™œ ì•ˆì¢‹ì€ê°€?

- ìœ„ ì˜ˆì œë§Œ ë³´ê³ ëŠ” ì™œ ì•ˆì¢‹ì€ì§€ ê°ì´ ì•ˆì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ ì´ìœ ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.
  - íŠ¹ì • ë©”ì„œë“œê°€ ì‹œìŠ¤í…œì— ì˜í–¥ì„ ì£¼ëŠ” ì „ì—­ ë³€ìˆ˜ì˜ ê°’ì„ ë³€ê²½í•˜ì§€ ì•ŠëŠ”ì§€
  - ê°ì²´ì˜ ë‚´ë¶€ ìƒíƒœë¥¼ ë³€ê²½í•˜ì§€ ì•ŠëŠ”ì§€
  - ë¶€ë‹´ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ í˜¸ì¶œì´ë‚˜ ë””ìŠ¤í¬ I/Oê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ì§€

#### ğŸ’¡ ì§„ì§œ ê°œì„ í•´ë´…ì‹œë‹¤.

- ì˜ˆì œ ì½”ë“œëŠ” ë”°ë¡œ ì—†ê³ , í•´ë‹¹ ë¡œì§ì„ ì´ë²¤íŠ¸ë¡œ ë°œì†¡í•˜ê±°ë‚˜, ê¸°ì¡´ DTOì— íŠ¹ì • ê°’ì„ ë„£ì–´ í…ŒìŠ¤íŠ¸í•˜ê³  ê°œì„ í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

<br>

## 2. í…ŒìŠ¤íŠ¸ê°€ ë³´ë‚´ëŠ” ì‹ í˜¸

#### í…ŒìŠ¤íŠ¸ê°€ ë³´ë‚´ëŠ” ì‹ í˜¸ë“¤

- Q1. í…ŒìŠ¤íŠ¸ì˜ ì…ì¶œë ¥ì„ í™•ì¸í•  ìˆ˜ ì—†ëŠ”ë°? ì´ëŸ° ê²½ìš°ì—ëŠ” ì–´ë–»ê²Œ í•´ì•¼í–ì§€?
- Q2. private ë©”ì„œë“œëŠ” ì–´ë–»ê²Œ í…ŒìŠ¤íŠ¸í•´ì•¼í•˜ì§€?
- Q3. ì„œë¹„ìŠ¤ ì»´í¬ë„ŒíŠ¸ì˜ ê°„ë‹¨í•œ ë©”ì„œë“œë¥¼ í…ŒìŠ¤íŠ¸í•˜ê³  ì‹¶ì€ë°, í•„ìš”ì—†ëŠ” ì˜ì¡´ì„± ì£¼ì…ì´ ë§ì„ ê²½ìš°ì— ì–´ë–»ê²Œ í•´ì•¼í•˜ì§€?

#### Q1ì˜ ë‹µë³€

- í…ŒìŠ¤íŠ¸ì˜ ì…ì¶œë ¥ì„ í™•ì¸í•  ìˆ˜ ìˆëŠ” êµ¬ì¡°ë¡œ ê°œì„ í•´ì•¼ í•©ë‹ˆë‹¤. ìˆ¨ê²¨ì§„ ì…ë ¥ì´ ìˆìœ¼ë©´ ì™¸ë¶€ë¡œ ë“œëŸ¬ë‚´ê³ , ìˆ¨ê²¨ì§„ ì¶œë ¥ì´ ìˆìœ¼ë©´ ë°˜í™˜ê°’ì„ ì‚¬ìš©í•´ì„œ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### Q2ì˜ ë‹µë³€

- private ë©”ì„œë“œëŠ” í…ŒìŠ¤íŠ¸í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤. private ë©”ì„œë“œë¥¼ í…ŒìŠ¤íŠ¸í•˜ëŠ” ê²ƒì€ ë‚´ë¶€ êµ¬í˜„ì„ í…ŒìŠ¤íŠ¸í•˜ê² ë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì±…ì„ì„ ì˜ëª» í• ë‹¹í•œ ê²½ìš°ì…ë‹ˆë‹¤. ì¦‰ public ë©”ì„œë“œì˜€ì–´ì•¼í•  í™•ë¥ ì´ ë†’ìŠµë‹ˆë‹¤.
- private ë©”ì„œë“œë¥¼ í´ë˜ìŠ¤ ì¶”ì¶œ ê¸°ë²•ì„ ì‚¬ìš©í•˜ì—¬ ë¶„ë¦¬ì‹œì¼œ í…ŒìŠ¤íŠ¸í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

#### Q3ì˜ ë‹µë³€

- ì„œë¹„ìŠ¤ ì»´í¬ë„ŒíŠ¸ë¥¼ ë” ì‘ê²Œ ë‚˜ëˆ ë¼ëŠ” ì˜ë¯¸ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì„œë¹„ìŠ¤ë„ ë‹¨ì¼ ì±…ì„ ì›ì¹™ì„ ì¤€ìˆ˜í•´ì•¼í•˜ëŠ”ë°, ê·¸ëŸ¬ì§€ ëª»í•œ ìƒí™©ì¼ ê±° ê°™ìŠµë‹ˆë‹¤.

<br>

#### ê°œì¸ì ì¸ ìƒê°

- ìˆ¨ê²¨ì§„ ì…ë ¥ì´ë¼ëŠ” ê²ƒì€ ì–¼í• ì•Œê³ ìˆì—ˆì§€ë§Œ í•œë²ˆ ë” ì œëŒ€ë¡œ ì•Œê²Œë˜ì–´ ì¢‹ê³ , ìˆ¨ê²¨ì§„ ì¶œë ¥ì´ë¼ëŠ” ê°œë…ì„ ì¶”ê°€ì ìœ¼ë¡œ ì•Œê²Œë˜ì–´ì„œ ì¢‹ë‹¤.
- í…ŒìŠ¤íŠ¸ê°€ ë³´ë‚´ëŠ” ì‹ í˜¸ë¥¼ ì˜ ì•Œì•„ì°¨ë¦´ ìˆ˜ ìˆë„ë¡ í•˜ì!



