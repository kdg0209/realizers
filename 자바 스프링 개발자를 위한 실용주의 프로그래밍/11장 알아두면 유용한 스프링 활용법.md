# ì•Œì•„ë‘ë©´ ìœ ìš©í•œ ìŠ¤í”„ë§ í™œìš©ë²•

<br>

## 1. íƒ€ì… ê¸°ë°˜ ì£¼ì…

### ìƒí™©

- êµ¬ë…ìëŠ” ìì‹ ì´ êµ¬ë…í•˜ê³  ìˆëŠ” ì•Œë¦¼ ì±„ë„ì„ í†µí•´ì„œ ë‰´ìŠ¤ë ˆí„°ë¥¼ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### ì˜ˆì œ ì½”ë“œ

- ì•„ë˜ëŠ” ì•Œë¦¼ì„ ë³´ë‚´ëŠ” ê°„ë‹¨í•œ ì„œë¹„ìŠ¤ ì½”ë“œì…ë‹ˆë‹¤. NotificationService í´ë˜ìŠ¤ë¥¼ ë³´ë©´ ì´ë©”ì¼ê³¼ FCMì„ ì‚¬ìš©í•´ì„œ ë‰´ìŠ¤ë ˆí„°ë¥¼ ë°›ì•„ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```java
@Service
public class NotificationService {

    private final NotificationChannel emailNotification;
    private final NotificationChannel fcmNotification;

    public NotificationService(@Qualifier("emailNotification") NotificationChannel emailNotification, @Qualifier("fcmNotification") NotificationChannel fcmNotification) {
        this.emailNotification = emailNotification;
        this.fcmNotification = fcmNotification;
    }

    public void notification() {

        String email = "test@naver.com";
        Set<NotificationType> types = Set.of(EMAIL, FCM);
        Account account = new Account(email, types);

        for (NotificationType type : account.getTypes()) {
            if (type == EMAIL) {
                emailNotification.notification("ë³¸ë¬¸ ë‚´ìš©");
            }
            if (type == FCM) {
                fcmNotification.notification("ë³¸ë¬¸ ë‚´ìš©");
            }
        }
    }
}

public interface NotificationChannel {

    void notification(String message);
}

@Component
public class EmailNotification implements NotificationChannel {

    @Override
    public void notification(String message) {
        System.out.println("ì´ë©”ì¼ì„ í†µí•´ ë°œì†¡");
    }
}

@Component
public class FcmNotification implements NotificationChannel {

    @Override
    public void notification(String message) {
        System.out.println("FCMì„ í†µí•´ ë°œì†¡");
    }
}
```

<br>

#### ë¬´ì—‡ì´ ë¬¸ì œì¼ê¹Œ?

- ì¶”ê°€ ìš”êµ¬ì‚¬í•­ì´ ë“¤ì–´ì™€ì„œ ìŠ¬ë™ìœ¼ë¡œ ì•Œë¦¼ì„ ë°›ê±°ë‚˜, ë¬¸ìë¡œ ì•Œë¦¼ì„ ë°›ê²Œëœë‹¤ë©´ ì–´ë–»ê²Œ ë ê¹Œìš”?
- ì•„ë˜ ì½”ë“œë¥¼ ë³´ë©´ NotificationServiceì˜ í´ë˜ìŠ¤ê°€ ëš±ëš±í•´ì§„ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  OCPì˜ ì›ì¹™ì´ ì œëŒ€ë¡œ ì§€ì¼œì§€ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

```java
@Component
public class SmsNotification implements NotificationChannel {

    @Override
    public void notification(String message) {
        System.out.println("ë¬¸ìë¥¼ í†µí•´ ë°œì†¡");
    }
}

@Component
public class SlackNotification implements NotificationChannel {

    @Override
    public void notification(String message) {
        System.out.println("ìŠ¬ë™ì„ í†µí•´ ë°œì†¡");
    }
}

@Service
public class NotificationService {

    private final NotificationChannel emailNotification;
    private final NotificationChannel fcmNotification;
    private final NotificationChannel smsNotification;
    private final NotificationChannel slackNotification;

    public NotificationService(@Qualifier("emailNotification") NotificationChannel emailNotification,
                               @Qualifier("fcmNotification") NotificationChannel fcmNotification,
                               @Qualifier("smsNotification") NotificationChannel smsNotification,
                               @Qualifier("slackNotification") NotificationChannel slackNotification) {
        this.emailNotification = emailNotification;
        this.fcmNotification = fcmNotification;
        this.smsNotification = smsNotification;
        this.slackNotification = slackNotification;
    }

    public void notification() {

        String email = "test@naver.com";
        Set<NotificationType> types = Set.of(EMAIL, FCM);
        Account account = new Account(email, types);

        for (NotificationType type : account.getTypes()) {
            if (type == EMAIL) {
                emailNotification.notification("ë³¸ë¬¸ ë‚´ìš©");
            }
            if (type == FCM) {
                fcmNotification.notification("ë³¸ë¬¸ ë‚´ìš©");
            }
            if (type == SMS) {
                smsNotification.notification("ë³¸ë¬¸ ë‚´ìš©");
            }
            if (type == SLACK) {
                slackNotification.notification("ë³¸ë¬¸ ë‚´ìš©");
            }
        }
    }
}
```

<br>

#### ğŸ§ ì–´ë–»ê²Œ ê²Œì„ ì‹œí‚¬ ìˆ˜ ìˆì„ê¹Œ?

- ì•„ë˜ NotificationService í´ë˜ìŠ¤ë¥¼ ë³´ë©´ ë¶„ê¸°ë¬¸ì´ ì—†ì–´ì§„ ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ ìŠ¤í”„ë§ íƒ€ì… ê¸°ë°˜ ì£¼ì…ì„ ì‚¬ìš©í•´ì„œ OCP ì›ì¹™ì„ ì¤€ìˆ˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```java
@Service
@RequiredArgsConstructor
public class NotificationService {

    private final List<NotificationChannel> notificationChannels;

    public void notification() {

        String email = "test@naver.com";
        Set<NotificationType> types = Set.of(EMAIL, FCM);
        Account account = new Account(email, types);

        for (NotificationChannel notificationChannel : notificationChannels) {
            boolean support = notificationChannel.support(account.getTypes());
            if (support) {
                notificationChannel.notification("ë³¸ë¬¸ ë‚´ìš©");
            }
        }
    }
}

public interface NotificationChannel {

    boolean support(Set<NotificationType> types);
    void notification(String message);
}

@Component
public class EmailNotification implements NotificationChannel {

    @Override
    public boolean support(Set<NotificationType> types) {
        return types.contains(NotificationType.EMAIL);
    }

    @Override
    public void notification(String message) {
        System.out.println("ì´ë©”ì¼ì„ í†µí•´ ë°œì†¡");
    }
}

@Component
public class FcmNotification implements NotificationChannel {

    @Override
    public boolean support(Set<NotificationType> types) {
        return types.contains(NotificationType.FCM);
    }

    @Override
    public void notification(String message) {
        System.out.println("FCMì„ í†µí•´ ë°œì†¡");
    }
}

@Component
public class SlackNotification implements NotificationChannel {

    @Override
    public boolean support(Set<NotificationType> types) {
        return types.contains(NotificationType.SLACK);
    }

    @Override
    public void notification(String message) {
        System.out.println("ìŠ¬ë™ì„ í†µí•´ ë°œì†¡");
    }
}

@Component
public class SmsNotification implements NotificationChannel {

    @Override
    public boolean support(Set<NotificationType> types) {
        return types.contains(NotificationType.SMS);
    }

    @Override
    public void notification(String message) {
        System.out.println("ë¬¸ìë¥¼ í†µí•´ ë°œì†¡");
    }
}
```

<br>

## 2. ìê°€ í˜¸ì¶œ

- ìê°€ í˜¸ì¶œ(self invocation)ì€ ì–´ë–¤ ê°ì²´ê°€ ë©”ì„œë“œë¥¼ ì²˜ë¦¬í•˜ëŠ” ì™€ì¤‘ì— ìì‹ ì´ ê°–ê³  ìˆëŠ” ë‹¤ë¥¸ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” ìƒí™©ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
- ì•„ë˜ ì½”ë“œê°€ ìê°€ í˜¸ì¶œ ì½”ë“œì…ë‹ˆë‹¤. ê·¸ëƒ¥ ë´ì„œëŠ” ë¬´ì—‡ì´ ë¬¸ì œì¸ì§€ íŒŒì•…í•˜ê¸° í˜ë“­ë‹ˆë‹¤.

```java
public class Something {
    
    public void somethingA() {
        somethingB();
    }

    public void somethingB() {

    }
}
```

<br>

#### ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì½”ë“œ

- ì•„ë˜ëŠ” ì½”ë“œëŠ” SomethingController í´ë˜ìŠ¤ì˜ something() ë©”ì„œë“œì—ì„œ SomethingService í´ë˜ìŠ¤ì˜ somethingA() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ê³  ìˆê³ , ë‚´ë¶€ì—ì„œ somethingB() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ê³  ìˆëŠ”ë°,
ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ê²ƒì€ somethingB() ë©”ì„œë“œì— @Transactional ì–´ë…¸í…Œì´ì…˜ì´ ì„ ì–¸ë˜ì–´ ìˆë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.

```java
@RestController
@RequiredArgsConstructor
public class SomethingController {
    
    private final SomethingService somethingService;
    
    @PostMapping
    public void something() {
        somethingService.somethingA();
    }
}

@Service
@RequiredArgsConstructor
public class SomethingService {

    public void somethingA() {
        somethingB();
    }

    @Transactional
    public void somethingB() {

    }
}
```

<br>

#### ë¬´ì—‡ì´ ë¬¸ì œì¼ê¹Œ?

- ì´ ë¡œì§ì—ì„œ somethingB() ë©”ì„œë“œëŠ” íŠ¸ëœì­ì…˜ ìƒíƒœë¡œ ë™ì‘í• ê¹Œìš”?
- somethingB() ë©”ì„œë“œëŠ” íŠ¸ëœì­ì…˜ì´ ì œëŒ€ë¡œ ë™ì‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì˜ˆê¸°ì¹˜ ëª»í•œ ìƒí™©ì—ì„œ ë¡¤ë°±ë„ ëª»í•˜ê²Œ ë˜ê³ , ì œëŒ€ë¡œ ì¸ì§€í•˜ì§€ ëª»í•œ ê°œë°œìëŠ” ë¬´ì—‡ì´ ë¬¸ì œì¸ì§€ ëª¨ë¥´ê²Œ ë˜ëŠ”ê²ƒì…ë‹ˆë‹¤.
- ì™œëƒí•˜ë©´ ìê°€ í˜¸ì¶œì´ ë°œìƒí•˜ë©´ í˜¸ì¶œëœ ë©”ì„œë“œì— ì ìš©ëœ AOP ì–´ë…¸í…Œì´ì…˜ì´ ì œëŒ€ë¡œ ë™ì‘í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

<br>

#### ì™œ ì´ë ‡ê²Œ ë™ì‘í•˜ëŠ”ê±¸ê¹Œ?

- @Transactional ì–´ë…¸í…Œì´ì…˜ì€ ìŠ¤í”„ë§ì˜ AOPê°€ í”„ë¡ì‹œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
- ìŠ¤í”„ë§ AOPëŠ” í”„ë¡ì‹œ ê°ì²´ë¥¼ ë§Œë“¤ì–´ ì¶”ê°€ ë™ì‘ì„ ì‚½ì…í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ AOPì˜ ë¶€ê°€ ê¸°ëŠ¥ì´ ë™ì‘í•˜ê²Œ ë©ë‹ˆë‹¤. ê·¸ë˜ì„œ ë©”ì„œë“œì— ì§€ì •ëœ AOP ì• ë„ˆí…Œì´ì…˜ì´ ìˆ˜í–‰ë˜ë ¤ë©´ ë°˜ë“œì‹œ ì´ í”„ë¡ì‹œ ê°ì²´ë¥¼ í†µí•´ ë©”ì„œë“œê°€ ì‹¤í–‰ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
- ìê°€ í˜¸ì¶œí•˜ëŠ” ìƒí™©ì—ì„œ í”„ë¡ì‹œì˜ ë¶€ê°€ ê¸°ëŠ¥ì´ ì‹¤í–‰ë˜ì§€ ì•Šê³ , í”„ë¡ì‹œë¥¼ ê±°ì¹˜ì§€ ì•Šê³  í´ë˜ìŠ¤ì— ì •ì˜ëœ ë©”ì„œë“œë¥¼ ê³§ë°”ë¡œ ì‹¤í–‰ì‹œí‚¤ê²Œ ë©ë‹ˆë‹¤.

<br>

#### ğŸ§ ì–´ë–»ê²Œ ê²Œì„ ì‹œí‚¬ ìˆ˜ ìˆì„ê¹Œ?

- @Transactional ì–´ë…¸í…Œì´ì…˜ì„ í´ë˜ìŠ¤ ë ˆë²¨ì— ì„ ì–¸í•˜ê±°ë‚˜, ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë°”ë¡œ í˜¸ì¶œë˜ëŠ” ë©”ì„œë“œ ë ˆë²¨ì— ì„ ì–¸í•˜ì—¬ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```java
@Service
@RequiredArgsConstructor
@Transactional // 1. í´ë˜ìŠ¤ ë ˆë²¨ì— ì„ ì–¸
public class SomethingService {

    // 2. ë©”ì„œë“œ ë ˆë²¨ì— ì„ ì–¸
    @Transactional
    public void somethingA() {
        somethingB();
    }

    public void somethingB() {

    }
}
```

<br>

#### ê°œì¸ì ì¸ ìƒê°

- AOPì˜ í•œ ê¸°ëŠ¥ì¸ @Transactional ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ë©´ì„œ self-invocation ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ë„ ìˆë‹¤ëŠ” ê²ƒì„ ìì„¸íˆ ì•Œë ¤ì£¼ì–´ì„œ ì¢‹ìŠµë‹ˆë‹¤.

