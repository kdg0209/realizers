# 네트워크 장비에 관한 이야기

<br>

## 1. 랜카드도 세팅해야 하나요?

#### 랜카드란?

- 사용자의 데이터를 케이블에 실어서 허브나 스위치 혹은 라우터 등으로 전달해주고 이를 받은 다른 랜카드들은 해당 프레임을 CPU에게 전달해주는 역할을 합니다.

#### 랜카드의 흐름

- 다른 사용자의 데이터 프레임으로부터 랜카드는 해당 프레임의 MAC 주소와 자신의 MAC 주소를 비교하게 됩니다. 이때 서로 MAC 주소가 다르다면 랜카드는 해당 프레임을 버리게 됩니다. 그러나 MAC 주소가 같다면 랜카드는 CPU에게 자기가 가지고 있던 IRQ(인터럽트 요청)를 이용하여 인터럽트를 걸게 됩니다. 

<br>

## 2. 허브

#### 허브란?

- 허브는 여러개의 포트를 가지고 있으며, 랜카드가 설치된 PC들의 케이블을 허브의 포트에 연결하면 허브에 연결된 PC들끼리 서로 통신이 가능합니다.

#### 허브의 역할

- 허브는 `멀티포트 리피터`라고 말할 수 있습니다. 리피터는 들어온 데이터를 그대로 전송한다라는 의미를 가지고 있습니다.
- 즉, 허브는 여러개의 포트를 가지고 있으며, 하나의 포트로 들어온 데이터를 나머지 포트로 뿌려준다는 것입니다.
- Host A가 데이터를 허브에게 전달하면 허브는 데이터가 들어온 Host A의 포트를 제외하고 나머지 모든 포트에게 데이터를 전달하게 됩니다. 그럼 나머지 Host들의 랜카드는 들어온 프레임의 목적지 MAC 주소와 자신의 MAC 주소를 비교하고 다를 경우 버리고 같은 경우 CPU에게 전달하게 됩니다.
- 이더넷 허브는 `CSMA/CD`의 적용을 받기 때문에 하나의 PC가 허브에 데이터를 보내고 있을 때 다른 PC들은 데이터를 보내려고 하면 충돌이 발생합니다.
- 같은 허브에 연결되어 있는 모든 PC들은 모두 콜리전 도메인에 있다라고 말합니다. 즉, 그 허브에 붙어있는 하나의 PC가 통신을 하게 되면 다른 모든 PC들은 통신을 할 수 없게됩니다.

![스크린샷 2025-02-22 오후 10 42 02](https://github.com/user-attachments/assets/d0dd1b77-1a49-42c4-a9c6-812f327eb17d)

<br>

#### 허브의 한계

- 콜리전 도메인 내부에서 한 번의 콜리전이 발생하면 그 허브에 붙어있는 모든 PC들이 영향을 받습니다. 따라서 허브가 더 많이 연결되어 있을수록 콜리전 도메인이 더 커지게 됩니다.

<br>

## 3. 허브의 끝과 스위치의 시작

- 허브를 사용하면 허브에 연결되어 있는 모든 PC들에서 콜리전이 발생할 수 있습니다. 그리고 허브를 여러대 연결하여 사용하는 경우 콜리전 도메인이 커지고 안전성이 떨어지게 되는데, 이러한 문제를 해결하기 위해서 콜리전 도메인을 나누어 줄 수 있는 장비가 나왔는데, 이 장비를 `브리지` 또는 `스위치`라 합니다.
- 스위치가 나오기 전까지 브리지가 이 역할을 수행했습니다. 따라서 스위치의 모든 기능은 브리지에서 출발하였습니다.

#### 브리지란?

- 브리지는 허브로 만들어진 콜리전 도메인 사이를 반으로 나누고 중간에 다리를 놓는 것입니다.
- 반으로 나눠진 각 영역 내부에서는 각각 통신이 가능합니다.
- 즉, HostA와 HostB가 통신을 하는 중에도 HostC와 HostD가 통신을 할 수 있습니다.

![스크린샷 2025-02-22 오후 11 23 52](https://github.com/user-attachments/assets/31c6a225-3ae9-4285-85ed-bdd565e1dd33)

#### 스위치란?

- 1번 포트에 연결된 PC가 2번 포트에 연결된 PC와 데이터를 주고받는 동안 3번 포트에 연결된 PC가 4번 포트에 연결된 PC와 데이터를 주고받을 수 있도록 해주는 장비입니다.
- 허브는 1번 PC와 2번 PC 사이에서 통신이 발생하면 나머지 모든 PC들은 기다려야 했지만 스위치는 이와달리 통신이 가능하다는 것입니다.

#### 허브 Vs 스위치

- 허브는 마치 1차선 도로와 같습니다. 어느 한순간에 한 대의 차량밖에 달릴 수 없지만 스위치는 포트별로 차선이 만들어지게 됩니다. 즉 8개의 포트라면 8차선 도로가 되는 것입니다.

#### 브리지/스위치의 기능

1. Learning: 배운다

- 브리지나 스위치는 자신의 포트에 연결된 HostA PC가 통신을 위해 프레임을 내보내면 HostA PC의 MAC 주소를 자신의 `브리지 테이블`에 저장해놓습니다. 그리고 나중에 어떤 PC가 Host A에게 통신을 하는 경우 자신의 `브리지 테이블`을 참고하여 다리를 건널지 안건널지 결정하게 됩니다.

![스크린샷 2025-02-22 오후 11 32 49](https://github.com/user-attachments/assets/58a827fe-fcc9-4a7c-a82d-b949b7b03051)

2. Flooding

- 들어온 포트를 제외한 나머지 모든 포트로 뿌리는 것입니다.
- 브리지는 자신의 `브리지 테이블`을 참고하여 다리를 열어줄 것인가 아니면 못 건너가게 막을 것인가를 결정하게 됩니다. 하지만 특정 주소가 `브리지 테이블`에 없는 경우 브로드캐스트처럼 우선 모든 포트로 뿌려주어 특정 포트의 MAC 주소를 찾게됩니다. 그리고 새롭게 알게된 MAC 주소를 자신의 브리지 테이블에 저장해놓습니다.

3. Forwarding

- 포워딩은 브리지가 목적지의 MAC 주소를 가지고 있고, 이 목적지가 출발지의 MAC 주소와 다른 세그먼트에 위치하는 경우 발생합니다.
- 즉, 브리지는 목적지가 어디 있는지 알고 있는데 그 목적지가 다리를 건너가야 하는 경우에 발생합니다.
- 포워딩은 Flooding와 다르게 오직 해당 포트쪽으로만 프레임을 뿌려줍니다.

![스크린샷 2025-02-22 오후 11 42 40](https://github.com/user-attachments/assets/6a0b4e92-58b1-4228-9806-41ab374753a6)

4. Filtering

- 필터링은 브리지를 못 넘어가게 막는다는 것을 뜻합니다.
- 필터링은 브리지가 목적지의 MAC 주소를 알고 있고, 출발지와 목적지가 같은 세그먼트에 속하는 경우에 발생합니다.
- 필터링을 통해서 동일한 세그먼트에 속한 PC들끼리 통신을 주고받더라도 다른 세그먼트에 영향을 미치지 않으니 콜리전 도메인을 나눠줄 수 있는 것입니다.

5. Aging

- 브리지의 `브리지 테이블` 공간은 한정적이기 떄문에 Aging을 사용하여 데이터의 유효 기간을 설정합니다.
- 즉, 어떤 MAC 주소를 브리지 테이블에 저장하면 그때부터 Aging이 가동되어 저장한 후 300초가 지나도록 더 이상 그 출발지의 주소를 가진 프레임이 들어오지 않으면 브리지 테이블에서 삭제시킵니다.
- 예를들어 어떤 프레임이 브리지에 들어오면 그 프레임의 출발지 주소(AAA)를 브리지 테이블에 저장하고 Aging을 시작합니다. 이때 280초 뒤에 AAA의 프레임이 브리지로 다시 들어오면 브리지는 AAA의 타이머를 리셋하고 처음부터 다시 카운트를 합니다. 이를 `리플래쉬`라 합니다.

<br>

## 4. Looping은 왜 발생할까?

- 루핑은 프레임이 네트워크상에서 무한정으로 뱅뱅 돌기 때문에 이더넷의 특성상 콜리전 도메인에 속한 모든 PC들이 데이터를 전송하지 못하게 되는 현상입니다.
- HostA가 브로드캐스트 패킷을 보냅니다. 그럼 양쪽 스위치에 전달이되는데 그럼 두 스위치는 패킷을 분석합니다. 이 패킷이 브로드캐스트 패킷이라는 걸 알게된 스위치들은 `Flooding`을 하게 됩니다. 즉 목적지의 MAC 주소를 보고 자신의 브리지 테이블에 없거나 멀티캐스트이거나 브로드캐스트인 경우 들어온 포트를 제외한 나머지 포트로 뿌려주는 `Flooding`을 하게 됩니다. 그럼 상대방쪽 세그먼트로 브로드캐스트 패킷이 보내지고, 또 다시 반대편에서는 브로드캐스트 패킷인걸 확인하고 나서 다시 반대편에 보내게 되는데... 이 과정이 반복되어 결국 `Looping`이 발생하게 됩니다. `CSMA/CD`의 특성 상 한 세그먼트 안에서는 어느 한 순간에는 오직 한 PC만이 통신할 수 있다는 규칙 때문에 발생하게 되는 것입니다.

![스크린샷 2025-02-23 오전 12 08 40](https://github.com/user-attachments/assets/ec2e9c7c-98ab-4dc7-b563-432f8c7d18d4)

<br>

## 5. 라우팅이냐 스위칭이냐

#### 스위치

- 4대의 Host PC를 스위치로 연결하면 아래와 같은 그림의 구성이 만들어집니다. 각각의 포트별로 통신이 가능하므로 콜리전 도메인은 각각 나누어지게되고, 브로드캐스트 도메인은 아직 하나인 구성이 됩니다. 하지만 스위치를 N개 두더라도 각각의 콜리전 도메인은 나눌 수 있지만 브로드캐스트 도메인은 점점 커지게 됩니다.

<img width="1032" alt="스크린샷 2025-02-23 오후 12 24 04" src="https://github.com/user-attachments/assets/b220994c-ead9-4090-b81b-b0958be24417" />

<br>

#### 라우터

- 스위치만 사용하면 콜리전 도메인은 작게 유지할 수 있지만 브로드캐스트 도메인은 점차 커지는 문제가 발생하였습니다. 이러한 문제는 `라우터`를 사용하여 문제를 해결할 수 있습니다.
- 아래 그림에서 보이는 것처럼 중간에 `라우터`를 놓게되면 스위치마다의 브로드캐스트 도메인을 가지고 그 중간을 `라우터`가 연결하게 됩니다.

<img width="1032" alt="스크린샷 2025-02-23 오후 12 32 07" src="https://github.com/user-attachments/assets/1506f427-a344-4390-9b45-ac44cea19daa" />


