# 입출력장치

## 장치 컨트롤러와 장치 드라이버
<hr>

### 장치 컨트롤러 

- 모든 입출력장치는 각자의 장치 컨트롤러를 통해 컴퓨터 내부와 통신합니다.
- 장치 컨트롤러는 하나 이상의 입출력장치와 연결되어 있습니다.

#### 장치 컨트롤러의 역할

1. CPU와 입출력장치 사이의 통신 중계
2. 오류 검출
3. 데이터 버퍼링
   - 데이터 버퍼링이란 버퍼링은 전송률이 높은 장치와 전송률이 낮은 장치 사이에서 주고 받는 데이터를 버퍼라는 임시 공간에 저장하여 전송률을 맞추는 방법입니다.
   - 장치 컨트롤러는 일반적으로 전송률이 높은 CPU와 전송률이 낮은 입출력장치와의 전송률 차이를 데이터 버퍼링으로 보완합니다.

#### 장치 컨트롤러의 내부 구조

- 장치 컨트롤러는 데이터 레지스터, 상태 레지스터, 제어 레지스터를 가지고 있습니다.

#### 데이터 레지스터란?

- CPU와 입출력장치 사이에 주고받는 데이터가 저장되는 레지스터입니다.
- 데이터 레지스터가 버퍼 역할을 수행함으로써 전송률 차이를 완화할 수 있습니다.

#### 상태 레지스터란?

- 입출력장치가 입출력 작업을 할 준비가 되었는지, 입출력장치가 작업이 완료되었는지, 오류는 없는지 등의 상태 정보를 저장합니다.

#### 제어 레지스터란?

- 입출력 장치가 수행할 명령어를 저장합니다.

### 장치 드라이버

- 장치 드라이버란 장치 컨트롤러의 동작을 감시하고 제어함으로써 장치 컨트롤러가 컴퓨터 내부와 정보를 주고받을 수 있게 하는 프로그램입니다.
- 장치 컨트롤러가 입출력장치를 연결하는 하드웨어적인 통로라면, 장치 드라이버는 입출력장치를 연결하는 소프트웨어적 통로입니다.

<br>

## 다양한 입출력 방법
<hr>

- 입출력 작업을 수행하려면 CPU와 장치 컨트롤러가 정보를 주고받아야 하는데 어떻게 정보를 주고 받을 수 있을까요? 
  여기에는 프로그램 입출력, 인터럽트 기반 입출력, DMA 입출력 방법이 있습니다.

### 프로그램 입출력

- 프로그램 입출력은 기본적으로 프로그램 속 명령어로 입출력장치를 제어하는 방법입니다.
- CPU가 프로그램 속 명령어를 실행하는 과정에서 입출력 명령어를 만나면 CPU는 입출력장치에 연결된 장치 컨트롤러와 상호작용하며 입출력 작업을 수행합니다.
- 프로그램 입출력방식에서의 입출력 작업은 CPU가 장치 컨트롤러의 레지스터 값을 읽고 씀으로써 이루어집니다.

#### 💡 프로그램 입출력에서 CPU가 장치 레지스터를 아는 방법

1. 메모리 맵 입출력
   - 메모리 맵 입출력은 메모리에 접근하기 위한 주소 공간과 입출력장치에 접근하기 위한 주소 공간을 한 주소 공간에서 같이 사용하는 방법입니다.
   - 메모리 맵 입출력 방식에서 CPU는 메모리의 주소나 장치 컨트롤러의 주소를 구분하지 않고 똑같이 주소를 대하면됩니다. 그래서 메모리에 접근하는 명령어와 입출력장치에 접근하는 명령어는 다를 필요가 없습니다.

2. 고립형 입출력
   - 고립형 입출력은 메모리를 위한 주소 공간과 입출력장치에 접근하기 위한 주소 공간을 분리하는 방법입니다.
   - 제어버스에는 '메모리 읽기/쓰기' 라인 외에 '입출력장치 읽기/쓰기' 라인이 따로 있습니다.

### 인터럽트 기반 입출력

- 입출력장치에 의한 하드웨어 인터럽트는 정확히 말하면 입출력장치가 아닌 장치 컨트롤러에 의해 발생합니다. CPU는 장치 컨트롤러에 작업을 명령하고, 장치 컨트롤러가 입출력장치를 제어하며 입출력을 수행하는 동안 CPU는 다른 작업을 하게됩니다.
- 장치 컨트롤러가 입출력 작업이 끝나면 CPU에게 인터럽트 신호를 보내 작업이 완료되었음을 알립니다.
- 인터럽트를 기반으로 하는 입출력을 인터럽트 기반 입출력이라 합니다.

![스크린샷 2023-12-26 오후 9.38.24.png](..%2F..%2F..%2F..%2F..%2F..%2Fvar%2Ffolders%2F6v%2Fxc5g2yzj3kz4_0m1nmwqz8bc0000gn%2FT%2FTemporaryItems%2FNSIRD_screencaptureui_6mWTyT%2F%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202023-12-26%20%EC%98%A4%ED%9B%84%209.38.24.png)

#### 💡 인터럽트 기반 입출력에서 인터럽트가 동시에 발생한 경우 어떻게 처리할 수 있을까?

1. 순차적으로 처리한다.
2. 비순차적으로 처리한다.
   - 비순차적으로 처리하더라도 플래그 레지스터 속 인터럽트 비트가 활성화되어 있거나, 인터럽트 비트를 비활성화해도 무시할 수 없는 인터럽트인 NMI가 발생한 경우에는 CPU가 우선순위가 높은것부터 처리하게 됩니다.
3. 프로그래머블 인터럽트 컨트롤러 하드웨어를 사용한다.
   1. PIC에 연결된 여러 장치컨트롤러의 인터럽트 신호를 받아들입니다.
   2. PIC는 받아들인 인터럽트 신호 중 우선순위를 매겨 CPU에게 인터럽트 신호를 발생시킵니다.
   3. CPU는 PIC로부터 받아들인 인터럽트 신호에 대한 확인 신호를 보냅니다.
   4. PIC는 확인 신호를 받았으면 인터럽트 서비스 루틴을 실행시킬 수 있도록 인터럽트 백터를 CPU에게 보냅니다.
   5. CPU는 인터럽트 백터를 전달받아 인터럽트 서비스 루틴을 실행시킵니다.
   6. 참고: PIC를 사용하더라도 우선순위가 높은 NMI는 막을 수 없습니다.

### DMA 입출력

- 프로그램 입출력과 인터럽트 기반 입출력은 데이터가 이동할때 반드시 CPU를 거치게 되는데 이렇게 되면 CPU의 자원을 효율적으로 사용할 수 없게됩니다. 
 그래서 입출력장치와 메모리가 CPU를 거치지 않고도 상호작용할 수 있도록 하는 방식을 DMA(Direct Memory Access)라 합니다.
- DMA는 이름에서 알 수 있도록 직접 메모리에 접근할 수 있는 입출력 기능입니다. 
- DMA 입출력이 가능하기 위해서는 시스템 버스에 연결된 DMA 컨트롤러라는 하드웨어가 필요합니다.


#### 💡 DMA 컨트롤러의 문제점

- DMA 컨트롤러는 시스템 버스로 메모리에 직접 접근하지만 시스템 버스는 공유 자원이기 때문에 CPU와 DMA 컨트롤러가 동시에 사용할 수 없습니다. 그렇기 때문에 입출력 버스를 사용하여 DMA 컨트롤러와 장치 컨트롤러를 따로 연결해야 합니다.
- DMA 컨트롤러와 장치 컨트롤러를 입출력 버스라는 별도으 버스에 연결하여 해결합니다. 그렇기 때문에 대부분의 장치 컨트롤러는 시스템 버스가 아닌 입출력 버스와 DMA 컨트롤러가 연결되고, DMA 컨트롤러는 시스템 버스에 연결이 됩니다.

<br>
<br>

### 🤔 생각해볼 수 있는 질문들

1. 장치 컨트롤러가 필요한 이유가 무엇일까?
   - 수 많은 입출력장치에 대한 보편적인 규격이 없고, 전송률이 높은 CPU와 전송률이 낮은 입출력장치간에 전송률 차이를 극복하기 위해 필요합니다.
2. 데이터 버퍼링이란 무엇인가?
   - 데이터 버퍼링이란 전송률이 높은 장치와 전송률이 낮은 장치 사이에 임시 공간을 활용하여 전송률을 맞추는 방법입니다.
3. 장치 컨트롤러는 어떤 레지스터로 구성되어 있는가?
   - 장치 컨트롤러는 데이터 레지스터, 상태 레지스터, 제어 레지스터로 구성되어 있습니다.
   - 데이터 레지스터란 CPU와 입출력장치 사이에 주고받는 데이터가 저장되는 레지스터입니다.
   - 상태 레지스터란 입출력장치가 준비가 되어있는지, 작업이 완료되었는지, 오류가 없는지 등의 상태를 저장하는 레지스터입니다.
   - 제어 레지스터란 입출력장치가 수행해야할 명령어를 저장하는 레지스터입니다.
4. 입출력 작업을 수행하기 위해서는 CPU와 장치 컨트롤러가 상호작용을 해야하는데 어떤 방식으로 할 수 있는가?
   - 프로그램 입출력, 인터럽트 기반 입출력, DMA 입출력 방식을 사용할 수 있습니다.
5. 프로그램 입출력이란 무엇인가?
   - 프로그램 입출력이란 CPU가 프로그램 명령어를 통해 입출력장치를 제어하는 방법입니다.
   - CPU가 프로그램 속 명령어를 실행하다가 입출력 명령어를 만나면 CPU는 입출력장치와 연결된 장치 컨트롤러와 상호작용을 통해 입출력 작업을 수행합니다.
6. 프로그램 입출력에서 CPU는 장치 컨트롤러에 있는 여러 레지스터를 어떻게 아는건가?
   - 메모리 맵 입출력, 고립형 입출력 방식을 통해 장치 컨트롤러에 있는 여러 레지스터를 알 수 있습니다.
7. 메모리 맵 입출력과 고립형 입출력이 무엇인가?
   - 메모리 맵 입출력은 하나의 주소 공간에 메모리에 접근하기 위한 주소 공간과 입출력장치에 접근하기 위한 주소 공간을 같이 사용하는 방식입니다. 명령어를 구분하지 않고 주소 공간에 접근할 수 있습니다.
   - 고립형 입출력은 메모리에 접근하기 위한 주소 공간과 입출력장치에 접근하기 위한 주소 공간을 분리하는 방식입니다.
8. 인터럽트 기반 입출력에서 여러 입출력장치에 의해 인터럽트가 동시에 발생한 경우 어떻게 처리할 수 있는가?
   - 프로그래머블 인터럽트 컨트롤러를 사용하여 처리할 수 있습니다.
9. PIC는 어떻게 작동되는가?
   1. PIC에 연결된 여러 장치 컨트롤러로부터 인터럽트 신호를 받아 들입니다.
   2. PIC는 우선순위를 매겨 CPU에게 인터럽트 신호를 보냅니다.
   3. CPU는 인터럽트 신호를 받고 PIC에게 확인 신호를 보냅니다.
   4. PIC는 인터럽트 백터를 CPU에게 보냅니다.
   5. CPU는 인터럽트 백터를 활용하여 인터럽트 서비스 루틴을 실행시킵니다.
10. DMA 입출력은 무엇인가?
    - DMA는 프로그램 입출력과 인터럽트 기반 입출력이 CPU 자원을 효율적으로 사용하지 못하는 문제점을 해결하기 위해 등장하였으며, 
       DMA라는 하드웨어 장치를 통해 메모리와 직접적으로 데이터를 주고 받을 수 있습니다.
11. DMA 컨트롤러가 가지고 있는 문제를 어떻게 해결할 수 있는가?
    - DMA는 시스템 버스를 사용하는데 이 시스템 버스는 공유 자원이므로 CPU와 동시에 사용할 수 없습니다. 따라서 입출력 버스라는 것을 사용하여 문제를 해결하고 있습니다.
    - 입출력 버스는 DMA 컨트롤러와 입출력장치를 연결하고 DMA 컨트로러와 CPU는 시스템 버스에 연결합니다.













